{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase.ts",
    "awayjs-parsers.js",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/Single2DTextureAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SingleCubeTextureAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBlock.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDProperties.ts",
    "awayjs-parsers/lib/AWD3Parser.ts",
    "awayjs-parsers/lib/AWDParser.ts",
    "awayjs-parsers/lib/MD2Parser.ts",
    "awayjs-parsers/lib/MD5AnimParser.ts",
    "awayjs-parsers/lib/MD5MeshParser.ts",
    "awayjs-parsers/lib/Max3DSParser.ts",
    "awayjs-parsers/lib/OBJParser.ts",
    "awayjs-parsers/lib/Parsers.ts"
  ],
  "names": [
    "require",
    "e",
    "t",
    "n",
    "r",
    "s",
    "o",
    "u",
    "a",
    "i",
    "f",
    "Error",
    "code",
    "l",
    "exports",
    "call",
    "length",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase",
    "module",
    "AbstractMethodError",
    "AWDAssetParserBase",
    "Object",
    "defineProperty",
    "prototype",
    "get",
    "this",
    "_awd_file_data",
    "set",
    "awd_file_data",
    "enumerable",
    "configurable",
    "parseFromBytes",
    "awayjs-core/lib/errors/AbstractMethodError",
    "undefined",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers",
    "GeometryAWDParser",
    "PrefabAWDParser",
    "DisplayObjectContainerAWDParser",
    "MeshAWDParser",
    "BillboardAWDParser",
    "Single2DTextureAWDParser",
    "CameraAWDParser",
    "SingleCubeTextureAWDParser",
    "LightAWDParser",
    "LightPickerAWDParser",
    "MaterialAWDParser",
    "MovieClipAWDParser",
    "ShadowMethodAWDParser",
    "SharedMethodAWDParser",
    "SkeletonAnimClipAWDParser",
    "SkeletonAWDParser",
    "SkeletonPoseAWDParser",
    "SkyboxAWDParser",
    "TesselatedFontAWDParser",
    "TextfieldAWDParser",
    "TextformatAWDParser",
    "VertexAnimationSetAWDParser",
    "VertexAnimClipAWDParser",
    "CommandAWDParser",
    "MetadataAWDParser",
    "BlockNameSpaceAWDParser",
    "AnimatorAWDParser",
    "AudioAWDParser",
    "AWDBlockParsers",
    "_supported_asset_blocks",
    "_all_block_parsers",
    "Array",
    "add_block_parser",
    "block_parser",
    "block_types",
    "push",
    "init_parser",
    "file_data",
    "parseAsset",
    "type",
    "this_parser",
    "awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/Single2DTextureAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SingleCubeTextureAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser",
    "__extends",
    "d",
    "b",
    "p",
    "hasOwnProperty",
    "__",
    "constructor",
    "AWDBlockParserBase",
    "VertexAnimator",
    "SkeletonAnimator",
    "AWD3Utils",
    "_super",
    "animSetBlockAdress",
    "targetAnimationSet",
    "cur_block",
    "name",
    "parseVarStr",
    "newBlockBytes",
    "readUnsignedShort",
    "props",
    "parseProperties",
    1,
    "BADDR",
    "readUnsignedInt",
    "targetMeshLength",
    "meshAdresses",
    "activeState",
    "autoplay",
    "readUnsignedByte",
    "parseUserAttributes",
    "returnedArray",
    "targetMeshes",
    "targetMesh",
    "getAssetByID",
    "thisAnimator",
    "skeleton",
    "animator",
    "data",
    "debug",
    "console",
    "log",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils",
    "awayjs-renderergl/lib/animators/SkeletonAnimator",
    "awayjs-renderergl/lib/animators/VertexAnimator",
    "ByteArray",
    "data_len",
    "url",
    "readUTFBytes",
    "dependencies_urls",
    "readBytes",
    "dependencies_data",
    "state",
    "BLOCKSTATE_LOAD_DEPENDENICES",
    "audioStylesNames",
    "awayjs-core/lib/utils/ByteArray",
    "Billboard",
    "BasicMaterial",
    "data_id",
    "mat",
    "bothSides",
    "billboard",
    "extra",
    "awayjs-display/lib/entities/Billboard",
    "awayjs-display/lib/materials/BasicMaterial",
    "BLOCKSTATE_NO_ASSET",
    "id",
    "nameSpaceString",
    "Camera",
    "PerspectiveProjection",
    "OrthographicProjection",
    "OrthographicOffCenterProjection",
    "Vector3D",
    "CameraAWD3Parser",
    "par_id",
    "mtx",
    "parseMatrix3D",
    "parentName",
    "projection",
    "readShort",
    "projectiontype",
    101,
    "propsNrType",
    102,
    103,
    104,
    "camera",
    "transform",
    "matrix3D",
    "parent",
    "addChild",
    "matrixNrType",
    2,
    3,
    4,
    "UINT8",
    "pivot",
    "awayjs-core/lib/geom/Vector3D",
    "awayjs-core/lib/projections/OrthographicOffCenterProjection",
    "awayjs-core/lib/projections/OrthographicProjection",
    "awayjs-core/lib/projections/PerspectiveProjection",
    "awayjs-display/lib/entities/Camera",
    "hasBlocks",
    "parentObject",
    "targetObject",
    "numCommands",
    "typeCommand",
    "targetID",
    "DisplayObjectContainer",
    "ctr",
    "major_version",
    "minor_version",
    "awayjs-display/lib/containers/DisplayObjectContainer",
    "AttributesBuffer",
    "Geometry",
    "CurveSubGeometry",
    "TriangleSubGeometry",
    "geom",
    "num_subs",
    "geoNrType",
    "geoScaleU",
    "geoScaleV",
    "subs_parsed",
    "is_curve_geom",
    "sm_len",
    "sm_end",
    "w_indices",
    "weights",
    "position",
    "subProps",
    "idx",
    "str_ftype",
    "str_type",
    "str_len",
    "str_end",
    "x",
    "y",
    "z",
    "verts",
    "readNumber",
    "accuracyGeo",
    "indices",
    "uvs",
    "normals",
    "idx_pos",
    "idx_curves",
    "idx_uvs",
    "positions",
    "curveData",
    "curve_sub_geom",
    "setIndices",
    "setPositions",
    "setCurves",
    "setUVs",
    "addSubGeometry",
    "triangle_sub_geom",
    "jointsPerVertex",
    "autoDeriveNormals",
    "autoDeriveUVs",
    "autoDeriveTangents",
    "setNormals",
    "setTangents",
    "setJointWeights",
    "setJointIndices",
    "scaleU",
    "scaleV",
    "setSubUVs",
    "scaleUV",
    "awayjs-core/lib/attributes/AttributesBuffer",
    "awayjs-display/lib/base/CurveSubGeometry",
    "awayjs-display/lib/base/Geometry",
    "awayjs-display/lib/base/TriangleSubGeometry",
    "CubeMapShadowMapper",
    "DirectionalShadowMapper",
    "DirectionalLight",
    "PointLight",
    "light",
    "newShadowMapper",
    "lightType",
    "COLOR",
    5,
    6,
    "BOOL",
    7,
    8,
    9,
    10,
    11,
    12,
    "UINT16",
    21,
    22,
    23,
    "shadowMapperType",
    "lightTypes",
    "shadowMapperTypes",
    "radius",
    "fallOff",
    "color",
    "specular",
    "diffuse",
    "ambientColor",
    "ambient",
    "depthMapSize",
    "getDepthSizeFromEnum",
    "shadowMapper",
    "castsShadows",
    "awayjs-display/lib/entities/DirectionalLight",
    "awayjs-display/lib/entities/PointLight",
    "awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper",
    "awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper",
    "StaticLightPicker",
    "numLights",
    "lightsArray",
    "k",
    "lightID",
    "returnedArrayLight",
    "lightsArrayNames",
    "lightPicker",
    "toString",
    "awayjs-display/lib/materials/lightpickers/StaticLightPicker",
    "MethodMaterialMode",
    "MethodMaterial",
    "DefaultMaterialManager",
    "AmbientEnvMapMethod",
    "DiffuseDepthMethod",
    "DiffuseCelMethod",
    "DiffuseGradientMethod",
    "DiffuseLightMapMethod",
    "DiffuseWrapMethod",
    "NormalSimpleWaterMethod",
    "SpecularFresnelMethod",
    "SpecularAnisotropicMethod",
    "SpecularCelMethod",
    "SpecularPhongMethod",
    "attributes",
    "finalize",
    "num_methods",
    "methods_parsed",
    "normalTexture",
    "specTexture",
    "INT32",
    13,
    "method_type",
    "debugString",
    "tex_addr",
    "texture",
    "getDefaultTexture",
    "alphaThreshold",
    "repeat",
    "UINT32",
    15,
    16,
    17,
    18,
    19,
    20,
    "spezialType",
    "mode",
    "MULTI_PASS",
    "alphaBlending",
    "diftexture",
    "alpha",
    "diffuseTex_addr",
    "diffuseTexture",
    "normalTex_addr",
    "specTex_addr",
    "lightPickerAddr",
    "smooth",
    "mipmap",
    "alphaPremultiplied",
    "blendMode",
    "getBlendModeStringFromEnum",
    "normalMap",
    "specularMap",
    "diffuseColor",
    "gloss",
    "specularColor",
    201,
    202,
    301,
    302,
    401,
    402,
    601,
    602,
    701,
    702,
    801,
    "MTX4x4",
    "fx_method",
    "addEffectMethod",
    "shadow_method",
    "shadowMethod",
    "cubeTex",
    "getDefaultCubeTexture",
    "ambientMethod",
    "diffuseMethod",
    "thisTex",
    "smoothness",
    "specularMethod",
    "fresnelPower",
    "normalReflectance",
    "normalMethod",
    "basic_mat",
    "preserveAlpha",
    "awayjs-display/lib/managers/DefaultMaterialManager",
    "awayjs-methodmaterials/lib/MethodMaterial",
    "awayjs-methodmaterials/lib/MethodMaterialMode",
    "awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseCelMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseDepthMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseGradientMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseWrapMethod",
    "awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod",
    "awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod",
    "awayjs-methodmaterials/lib/methods/SpecularCelMethod",
    "awayjs-methodmaterials/lib/methods/SpecularFresnelMethod",
    "awayjs-methodmaterials/lib/methods/SpecularPhongMethod",
    "Mesh",
    "num_materials",
    "materials_parsed",
    "geoID",
    "materials",
    "materialNames",
    "mat_id",
    "m",
    "mesh",
    "subMeshes",
    "material",
    "Math",
    "min",
    "awayjs-display/lib/entities/Mesh",
    "AWDSTRING",
    "AWDBitFlags",
    "ColorTransform",
    "Matrix3D",
    "Timeline",
    "TextField",
    "AS2SceneGraphFactory",
    "view",
    "factory",
    "j",
    "c",
    "new_timeline",
    "new_mc",
    "createMovieClip",
    "isScene",
    "sceneID",
    "fps",
    "readFloat",
    "ms_per_frame",
    "num_instances",
    "num_all_display_instances",
    "num_potential_childs",
    "resourceID",
    "cmd_asset",
    "registerPotentialChild",
    "num_potential_childs_multi_instanced",
    "num_potential_sounds",
    "numFrames",
    "totalDuration",
    "frameDuration",
    "numLabels",
    "objectID",
    "target_depth",
    "number_of_obj",
    "commandType",
    "hasDepthChanges",
    "sessionCount",
    "remove_depths",
    "potChild",
    "getPotentialChildPrototype",
    "isAsset",
    "props_flag",
    "test",
    "FLAG1",
    "thisMatrix",
    "FLAG2",
    "rawData",
    "FLAG3",
    "thisColorTransform",
    "FLAG4",
    "redMultiplier",
    "greenMultiplier",
    "blueMultiplier",
    "alphaMultiplier",
    "redOffset",
    "greenOffset",
    "blueOffset",
    "alphaOffset",
    "FLAG5",
    "blendmode_int",
    "blendmode_string",
    "FLAG6",
    "FLAG7",
    "instanceName",
    "FLAG8",
    "mask_id_nums",
    "mask_ids",
    "mi_cnt",
    "length_code",
    "awayjs-core/lib/geom/ColorTransform",
    "awayjs-core/lib/geom/Matrix3D",
    "awayjs-display/lib/base/Timeline",
    "awayjs-display/lib/entities/TextField",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags",
    "awayjs-player/lib/factories/AS2SceneGraphFactory",
    "PrefabBase",
    "PrimitiveCapsulePrefab",
    "PrimitiveConePrefab",
    "PrimitiveCubePrefab",
    "PrimitiveCylinderPrefab",
    "PrimitivePlanePrefab",
    "PrimitiveSpherePrefab",
    "PrimitiveTorusPrefab",
    "prefab",
    "primType",
    "bsm",
    110,
    111,
    303,
    703,
    704,
    "primitiveTypes",
    "topClosed",
    "bottomClosed",
    "yUp",
    "awayjs-display/lib/prefabs/PrefabBase",
    "awayjs-display/lib/prefabs/PrimitiveCapsulePrefab",
    "awayjs-display/lib/prefabs/PrimitiveConePrefab",
    "awayjs-display/lib/prefabs/PrimitiveCubePrefab",
    "awayjs-display/lib/prefabs/PrimitiveCylinderPrefab",
    "awayjs-display/lib/prefabs/PrimitivePlanePrefab",
    "awayjs-display/lib/prefabs/PrimitiveSpherePrefab",
    "awayjs-display/lib/prefabs/PrimitiveTorusPrefab",
    "ShadowDitheredMethod",
    "ShadowFilteredMethod",
    "ShadowHardMethod",
    "ShadowNearMethod",
    "ShadowSoftMethod",
    "asset",
    "shadowLightID",
    "parseShadowMethodList",
    "methodType",
    "shadow_meth",
    "epsilon",
    "range",
    "awayjs-methodmaterials/lib/methods/ShadowDitheredMethod",
    "awayjs-methodmaterials/lib/methods/ShadowFilteredMethod",
    "awayjs-methodmaterials/lib/methods/ShadowHardMethod",
    "awayjs-methodmaterials/lib/methods/ShadowNearMethod",
    "awayjs-methodmaterials/lib/methods/ShadowSoftMethod",
    "EffectColorMatrixMethod",
    "EffectColorTransformMethod",
    "EffectFogMethod",
    "EffectRimLightMethod",
    "parseSharedMethodList",
    "effectMethodReturn",
    105,
    106,
    107,
    "offCol",
    "colorTransform",
    "awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod",
    "awayjs-methodmaterials/lib/methods/EffectColorTransformMethod",
    "awayjs-methodmaterials/lib/methods/EffectFogMethod",
    "awayjs-methodmaterials/lib/methods/EffectRimLightMethod",
    "textureStylesNames",
    "Skeleton",
    "SkeletonJoint",
    "num_joints",
    "joints_parsed",
    "joint",
    "ibp",
    "parentIndex",
    "inverseBindPose",
    "joints",
    "awayjs-renderergl/lib/animators/data/Skeleton",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint",
    "SkeletonClipNode",
    "frame_dur",
    "pose_addr",
    "clip",
    "num_frames",
    "frames_parsed",
    "skel_pose",
    "addFrame",
    "frames",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode",
    "SkeletonPose",
    "JointPose",
    "pose",
    "joint_pose",
    "has_transform",
    "mtx_data",
    "parseMatrix43RawData",
    "orientation",
    "fromMatrix",
    "translation",
    "copyFrom",
    "jointPoses",
    "awayjs-renderergl/lib/animators/data/JointPose",
    "awayjs-renderergl/lib/animators/data/SkeletonPose",
    "Skybox",
    "cubeTexAddr",
    "cube_tex",
    "new_skybox",
    "awayjs-display/lib/entities/Skybox",
    "Font",
    "new_font",
    "font_style_cnt",
    "font_style_name",
    "new_font_style",
    "get_font_table",
    "set_font_em_size",
    "font_style_char_cnt",
    "font_style_char",
    "set_subgeo_for_char",
    "awayjs-display/lib/text/Font",
    "TextFormat",
    "newTextField",
    "createTextField",
    "text_field_type",
    "displayAsPassword",
    "width",
    "height",
    "num_paragraphs",
    "complete_text",
    "text_format",
    "paracnt",
    "num_textruns",
    "textrun_cnt",
    "format_id",
    "textFormat",
    "txt_length",
    "this_txt",
    "text",
    "selectable",
    "border",
    "awayjs-display/lib/text/TextFormat",
    "newTextFormat",
    "font_id",
    "font",
    "font_name",
    "font_table",
    "font_style",
    "num_uv_values",
    "uv_values",
    "uvcnt",
    "uv_value",
    "format_props",
    "size",
    "letterSpacing",
    "kerning",
    "indent",
    "leftMargin",
    "rightMargin",
    "VertexClipNode",
    "poseOnly",
    "num_submeshes",
    "subMeshParsed",
    "geometry",
    "subGeom",
    "num_Streams",
    "streamsParsed",
    "streamtypes",
    "thisGeo",
    "geoAdress",
    "getUVForVertexAnimation",
    "looping",
    "stitchFinalFrame",
    "subGeometries",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode",
    "VertexAnimationSet",
    "SkeletonAnimationSet",
    "poseBlockAdress",
    "skeletonFrames",
    "vertexFrames",
    "animNode",
    "newVertexAnimationSet",
    "addAnimation",
    "animations",
    "animationNames",
    "newSkeletonAnimationSet",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet",
    "awayjs-renderergl/lib/animators/VertexAnimationSet",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData",
    "BlendMode",
    "SingleCubeTexture",
    "Single2DTexture",
    "AWDProperties",
    "AWDBlock",
    "AWD3FileData",
    "_debug",
    "_accuracyOnBlocks",
    "_blocks",
    "_cur_block",
    "blendModeDic",
    "NORMAL",
    "ADD",
    "ALPHA",
    "DARKEN",
    "DIFFERENCE",
    "ERASE",
    "HARDLIGHT",
    "INVERT",
    "LAYER",
    "LIGHTEN",
    "MULTIPLY",
    "OVERLAY",
    "SCREEN",
    "SHADER",
    "_depthSizeDic",
    "depthSize",
    "blendmode",
    "dispose",
    "_accuracyMatrix",
    "new_accuracyMatrix",
    "_accuracyProps",
    "new_accuracyProps",
    "_accuracyGeo",
    "new_accuracyGeo",
    "_matrixNrType",
    "newmatrixNrType",
    "_propsNrType",
    "new_props_nr",
    "_geoNrType",
    "new_geoNrType",
    "_newBlockBytes",
    "new_newBlockBytes",
    "create_new_block",
    "new_block",
    "block_cnt",
    "list_len",
    "attibuteCnt",
    "list_end",
    "ns_id",
    "attr_key",
    "attr_type",
    "attr_len",
    "attr_val",
    "INT8",
    "readByte",
    "INT16",
    "readInt",
    "FLOAT32",
    "FLOAT64",
    "readDouble",
    "expected",
    "propertyCnt",
    "len",
    "key",
    "parseAttrValue",
    "elem_len",
    "read_func",
    "VECTOR2x1",
    "VECTOR3x1",
    "VECTOR4x1",
    "MTX3x2",
    "MTX3x3",
    "MTX4x3",
    "list",
    "num_read",
    "num_elems",
    "apply",
    "val",
    "meshID",
    "uvsForVertexAnimation",
    "geoCnt",
    "sub_geom",
    "numVertices",
    "getBlockByID",
    "assetID",
    "getDefaultAsset",
    "assetType",
    "getDefaultMaterial",
    "_defaultCubeTexture",
    "precision",
    "parseMatrix32RawData",
    "mtx_raw",
    "Float32Array",
    "isNaN",
    "awayjs-core/lib/data/BlendMode",
    "awayjs-display/lib/textures/Single2DTexture",
    "awayjs-display/lib/textures/SingleCubeTexture",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBlock",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDProperties",
    "BLOCKSTATE_FINALIZE",
    "BLOCKSTATE_INVALID",
    "COMPRESSIONMODE_LZMA",
    "UNCOMPRESSED",
    "DEFLATE",
    "LZMA",
    "AWDBYTEARRAY",
    "flags",
    "testFlag",
    "FLAG9",
    "FLAG10",
    "FLAG11",
    "FLAG12",
    "FLAG13",
    "FLAG14",
    "FLAG15",
    "FLAG16",
    "this_id",
    "this_type",
    "loaded_dependencies",
    "loaded_dependencies_cnt",
    "bytes",
    "errorMessages",
    "addError",
    "errorMsg",
    "value",
    "fallback",
    "awayjs-parsers/lib/AWD3Parser",
    "BitmapImageCube",
    "URLLoaderDataFormat",
    "URLRequest",
    "ParserBase",
    "ParserUtils",
    "DisplayObject",
    "AWDAssetParsers",
    "AWD3Parser",
    "ARRAY_BUFFER",
    "_startedParsing",
    "_parsed_header",
    "total_time",
    "geom_time",
    "timeline_time",
    "_block_parser",
    "_awd_data",
    "supportsType",
    "extension",
    "toLowerCase",
    "supportsData",
    "_iResolveDependency",
    "resourceDependency",
    "assets",
    "this_block",
    "parseInt",
    "testure_asset",
    "_pFinalizeAsset",
    "sub_id",
    "cube_image_asset",
    "draw",
    "cube_tex_asset",
    "_iResolveDependencyFailure",
    "_iResolveDependencyName",
    "oldName",
    "block",
    "resetAssetPath",
    "newName",
    "_pProceedParsing",
    "_byteData",
    "_pGetByteData",
    "parseHeader",
    "_compression",
    "_pDieWithError",
    "_body",
    "getBytesAvailable",
    "parsingPaused",
    "parseNextBlock",
    "PARSING_DONE",
    "MORE_TO_PARSE",
    "_pStartParsing",
    "frameLimit",
    "_pContent",
    "block_id",
    "ns",
    "block_type",
    "blockCompression",
    "blockCompressionLZMA",
    "accuracyOnBlocks",
    "accuracyMatrix",
    "accuracyProps",
    "blockEndAll",
    "time_start",
    "performance",
    "now",
    "_pAddDependency",
    "byteArrayToImage",
    "_pPauseAndRetrieveDependencies",
    "time_end",
    "thisTime",
    "body_len",
    "_streaming",
    "awayjs-core/lib/data/BitmapImageCube",
    "awayjs-core/lib/net/URLLoaderDataFormat",
    "awayjs-core/lib/net/URLRequest",
    "awayjs-core/lib/parsers/ParserBase",
    "awayjs-core/lib/parsers/ParserUtils",
    "awayjs-display/lib/base/DisplayObject",
    "awayjs-parsers/lib/AWDParser",
    "Float2Attributes",
    "EffectAlphaMaskMethod",
    "EffectEnvMapMethod",
    "EffectFresnelEnvMapMethod",
    "EffectLightMapMethod",
    "AssetLibrary",
    "AWDParser",
    "_debugTimers",
    "_texture_users",
    "_time_all",
    "_time_geom",
    "_time_geom_bytes",
    "_time_timeline",
    "_time_fonts",
    "_time_textfields",
    "_time_sounds",
    "_time_textures",
    "_time_materials",
    "_time_meshes",
    "_num_geom",
    "_num_timeline",
    "_num_fonts",
    "_num_textfields",
    "_num_sounds",
    "_num_textures",
    "_num_materials",
    "_num_meshes",
    "shadowMethodListProperties",
    "PROPERTY_NUMBER",
    "meshPoseAnimationProperties",
    "sharedMethodListProperties",
    "_view",
    "_version",
    "texture_asset",
    "audio_asset",
    "_isParsing",
    "updateTimers",
    "isParsed",
    "start_timeing",
    "_cur_block_id",
    "BitFlags",
    "blockEndBlock",
    "parseMeshLibraryBlock",
    "parseBillBoardLibraryBlock",
    "parseAudioBlock",
    "parseTimeLine",
    "paresTextField",
    "parseTesselatedFont",
    "parseTextFormat",
    "parsePrimitves",
    "parseSkyboxInstance",
    "parseLight",
    "parseCamera",
    "parseLightPicker",
    "parseMaterial_v1",
    "parseCubeTexture",
    "parseSharedMethodBlock",
    "parseShadowMethodBlock",
    "parseMeshPoseAnimation",
    "parseVertexAnimationSet",
    "parseAnimatorSet",
    "parseCommand",
    "parseGeometry",
    "parseContainer",
    "parseMeshInstance",
    "parseMaterial",
    "parseTexture",
    "parseSkeleton",
    "parseSkeletonPose",
    "parseSkeletonAnimation",
    "parseNameSpace",
    "parseMetaData",
    "msgCnt",
    "end_timing",
    "time_delta",
    "blockID",
    "getAsset",
    "newfont",
    "set_whitespace_width",
    "vertexBuffer",
    "bufferView",
    "Uint8Array",
    "arraybytes",
    "textFormatProperties",
    "tf_align_int",
    "align",
    "textFieldTypes",
    "textWidth",
    "abs",
    "textHeight",
    "textFieldProperties",
    "useColorTransform",
    "extras",
    "timeLineContainer",
    "str_cnt",
    "str_data_type",
    "str_counter",
    "keyframes_start_indices_data",
    "new_buffer",
    "Uint16Array",
    "Uint32Array",
    "keyframe_durations",
    "numKeyFrames",
    "frame_command_indices",
    "frame_recipe",
    "command_length_stream",
    "command_index_stream",
    "add_child_stream",
    "remove_child_stream",
    "update_child_stream",
    "update_child_props_indices_stream",
    "update_child_props_length_stream",
    "property_type_stream",
    "property_index_stream",
    "properties_stream_int",
    "lc",
    "float_array_data",
    "properties_stream_f32_mtx_scale_rot",
    "properties_stream_f32_mtx_pos",
    "properties_stream_f32_mtx_all",
    "properties_stream_f32_ct",
    "_labels",
    "string_props_array",
    "properties_stream_strings",
    "frame_index",
    "one_str_len",
    "add_framescript",
    "init",
    "geometryProperties",
    "subGeometryProperties",
    "primitiveProperties",
    "containerProperties",
    "isPrefab",
    "getNewObject",
    "meshInstanceProperties",
    "tex",
    "cubeMap",
    "lightProperties",
    "cameraProperties",
    "cameraPivotProperties",
    "lightPick",
    "materialProperties",
    "materialMode",
    "material_v1Properties",
    "method_v1Properties",
    "effectMethod",
    "shadowMapMethod",
    "cubeTexture",
    "commandProperties",
    "targetProperties",
    "metaDataProperties",
    "pose_id",
    "geo_id",
    "vertexAnimationSetProperties",
    "clipNode",
    "animatorSetProperties",
    "accuracy",
    "GEO_NUMBER",
    "MATRIX_NUMBER",
    "awayjs-core/lib/attributes/Float2Attributes",
    "awayjs-core/lib/library/AssetLibrary",
    "awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod",
    "awayjs-methodmaterials/lib/methods/EffectEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/EffectLightMapMethod",
    "awayjs-parsers/lib/MD2Parser",
    "MD2Parser",
    "textureType",
    "ignoreTexturePath",
    "_clipNodes",
    "_animationSet",
    "materialFinal",
    "geoCreated",
    "_textureType",
    "_ignoreTexturePath",
    "_mesh",
    "_pHasTime",
    "_parsedHeader",
    "_geometry",
    "parseMaterialNames",
    "_parsedUV",
    "parseUV",
    "_parsedFaces",
    "parseFaces",
    "_parsedFrames",
    "parseFrames",
    "_firstSubGeom",
    "clone",
    "_ident",
    "_skinWidth",
    "_skinHeight",
    "_numSkins",
    "_numVertices",
    "_numST",
    "_numTris",
    "_numFrames",
    "_offsetSkins",
    "_offsetST",
    "_offsetTris",
    "_offsetFrames",
    "_offsetEnd",
    "extIndex",
    "slashIndex",
    "_materialNames",
    "regExp",
    "RegExp",
    "replace",
    "lastIndexOf",
    "indexOf",
    "substring",
    "dependencies",
    "_uvs",
    "ta",
    "tb",
    "tc",
    "_vertIndices",
    "_uvIndices",
    "_indices",
    "addIndex",
    "_finalUV",
    "vertexIndex",
    "uvIndex",
    "index",
    "findIndex",
    "sx",
    "sy",
    "sz",
    "tx",
    "ty",
    "tz",
    "vertLen",
    "fvertices",
    "tvertices",
    "prevClip",
    "readFrameName",
    "FPS",
    "ch",
    "floor",
    "String",
    "fromCharCode",
    "awayjs-parsers/lib/MD5AnimParser",
    "Quaternion",
    "MD5AnimParser",
    "additionalRotationAxis",
    "additionalRotationRadians",
    "TEXT",
    "_parseIndex",
    "_line",
    "_charLineIndex",
    "_rotationQuat",
    "t1",
    "t2",
    "fromAxisAngle",
    "X_AXIS",
    "PI",
    "Y_AXIS",
    "multiply",
    "token",
    "_textData",
    "_pGetTextData",
    "getNextToken",
    "COMMENT_TOKEN",
    "ignoreLine",
    "VERSION_TOKEN",
    "getNextInt",
    "COMMAND_LINE_TOKEN",
    "parseCMD",
    "NUM_FRAMES_TOKEN",
    "_bounds",
    "_frameData",
    "NUM_JOINTS_TOKEN",
    "_numJoints",
    "_hierarchy",
    "_baseFrameData",
    "FRAME_RATE_TOKEN",
    "_frameRate",
    "NUM_ANIMATED_COMPONENTS_TOKEN",
    "_numAnimatedComponents",
    "HIERARCHY_TOKEN",
    "parseHierarchy",
    "BOUNDS_TOKEN",
    "parseBounds",
    "BASE_FRAME_TOKEN",
    "parseBaseFrame",
    "FRAME_TOKEN",
    "parseFrame",
    "_reachedEOF",
    "sendUnknownKeywordError",
    "_clip",
    "translateClip",
    "translatePose",
    "frameData",
    "hierarchy",
    "base",
    "translate",
    "components",
    "skelPose",
    "startIndex",
    "w",
    "sqrt",
    "rotatePoint",
    "sendEOFError",
    "HierarchyData",
    "parseLiteralstring",
    "getNextChar",
    "putBack",
    "BoundsData",
    "parseVector3D",
    "max",
    "BaseFrameData",
    "parseQuaternion",
    "frameIndex",
    "FrameData",
    "getNextNumber",
    "skipWhiteSpace",
    "charAt",
    "sendParseError",
    "parseFloat",
    "vec",
    "quat",
    "str",
    "awayjs-core/lib/geom/Quaternion",
    "awayjs-parsers/lib/MD5MeshParser",
    "MD5MeshParser",
    "_bindPoses",
    "NUM_MESHES_TOKEN",
    "_numMeshes",
    "JOINTS_TOKEN",
    "parseJoints",
    "MESH_TOKEN",
    "parseMesh",
    "calculateMaxJointCount",
    "_maxJointCount",
    "_meshData",
    "translateGeom",
    "vertexData",
    "weightData",
    "_skeleton",
    "numMeshData",
    "meshData",
    "numVerts",
    "zeroWeights",
    "countZeroWeightJoints",
    "totalJoints",
    "countWeight",
    "vertex",
    "start",
    "startWeight",
    "end",
    "count",
    "weight",
    "bias",
    "pos",
    "toMatrix3D",
    "appendTranslation",
    "inv",
    "invert",
    "_shaders",
    "MESH_SHADER_TOKEN",
    "MESH_NUM_VERTS_TOKEN",
    "MESH_NUM_TRIS_TOKEN",
    "MESH_NUM_WEIGHTS_TOKEN",
    "MESH_VERT_TOKEN",
    "parseVertex",
    "MESH_TRI_TOKEN",
    "parseTri",
    "MESH_WEIGHT_TOKEN",
    "parseJoint",
    "MeshData",
    "v1",
    "v2",
    "v3",
    "bindPose",
    "vertices",
    "jointIndices",
    "jointWeights",
    "nonZeroWeights",
    "transformVector",
    "JointData",
    "VertexData",
    "rotQuat",
    "awayjs-parsers/lib/Max3DSParser",
    "BitmapImage2D",
    "Max3DSParser",
    "useSmoothingGroups",
    "_useSmoothingGroups",
    "ba",
    "toByteArray",
    "_textures",
    "_materials",
    "_unfinalized_objects",
    "_cur_mat",
    "_cur_mat_end",
    "finalizeCurrentMaterial",
    "_cur_obj",
    "_cur_obj_end",
    "Number",
    "MAX_VALUE",
    "cid",
    "ObjectVO",
    "readNulTermstring",
    "materialFaces",
    "parseVertexList",
    "parseFaceList",
    "parseUVList",
    "parseFaceMaterialList",
    "readTransform",
    "parseObjectAnimation",
    "parseSmoothingGroups",
    "obj",
    "constructObject",
    "MaterialVO",
    "readColor",
    "twoSided",
    "colorMap",
    "TextureVO",
    "i0",
    "i1",
    "i2",
    "smoothingGroups",
    "faces",
    "vo",
    "hier",
    "sub",
    "prepareData",
    "applySmoothGroups",
    "v",
    "mname",
    "scaleBy",
    "applyTransformation",
    "concat",
    "VertexVO",
    "FaceVO",
    "smoothGroup",
    "numFaces",
    "vGroups",
    "face",
    "groups",
    "group",
    "splice",
    "vClones",
    "clones",
    "v0",
    "chr",
    "g",
    "awayjs-core/lib/data/BitmapImage2D",
    "awayjs-parsers/lib/OBJParser",
    "SpecularBasicMethod",
    "OBJParser",
    "scale",
    "_mtlLibLoaded",
    "_activeMaterialID",
    "_scale",
    "content",
    "hasV",
    "hasF",
    "parseMtl",
    "lm",
    "LoadedMaterial",
    "materialID",
    "_materialLoaded",
    "_meshes",
    "applyMaterial",
    "_mtlLib",
    "line",
    "creturn",
    "trunk",
    "_vertices",
    "_vertexNormals",
    "_materialIDs",
    "_stringLength",
    "_charIndex",
    "_oldIndex",
    "_objects",
    "_objectIndex",
    "split",
    "join",
    "parseLine",
    "applyMaterials",
    "loadMtl",
    "createGroup",
    "createObject",
    "_currentGroup",
    "parseVertexNormal",
    "parseFace",
    "objIndex",
    "numGroups",
    "materialGroups",
    "numMaterialGroups",
    "sm",
    "bmMaterial",
    "translateMaterialGroup",
    "_lastMtlID",
    "materialGroup",
    "_realIndices",
    "_vertexIndex",
    "indexIds",
    "translateVertexData",
    "vertexNormal",
    "uv",
    "vertexIndices",
    "normalIndices",
    "uvIndices",
    "_currentMaterialGroup",
    "_currentObject",
    "ObjectGroup",
    "Group",
    "createMaterialGroup",
    "MaterialGroup",
    "nTrunk",
    "Vertex",
    "UV",
    "FaceData",
    "parseIndex",
    "materialDefinitions",
    "lines",
    "basicSpecularMethod",
    "useSpecular",
    "useColor",
    "mapkd",
    "charCodeAt",
    "parseMapKdString",
    "specularData",
    "SpecularData",
    "_materialSpecularData",
    "cm",
    "colorMat",
    "colorMultiMat",
    "breakflag",
    "mtlurl",
    "decomposeID",
    "tm",
    "_u",
    "_v",
    "_x",
    "_y",
    "_z",
    "_index",
    "ind",
    "awayjs-methodmaterials/lib/methods/SpecularBasicMethod",
    "awayjs-parsers/lib/Parsers",
    "LoaderSession",
    "Parsers",
    "enableAllBundled",
    "enableParsers",
    "ALL_BUNDLED",
    "awayjs-core/lib/library/LoaderSession"
  ],
  "mappings": "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",
  "file": "awayjs-parsers.min.js",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3FileData\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\n\r\n\r\nclass AWDAssetParserBase\r\n{\r\n\r\n\tprivate _awd_file_data:AWD3FileData;\r\n\tconstructor()\r\n\t{\r\n\t}\r\n\r\n\r\n\tpublic get awd_file_data():AWD3FileData\r\n\t{\r\n\t\treturn this._awd_file_data;\r\n\t}\r\n\tpublic set awd_file_data(awd_file_data:AWD3FileData)\r\n\t{\r\n\t\tthis._awd_file_data=awd_file_data;\r\n\t}\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AWDAssetParserBase;\r\n\r\n",
    null,
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\n\r\nimport AWDAssetParserBase\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWD3FileData \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\n\r\nimport GeometryAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser\");\r\nimport PrefabAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser\");\r\nimport DisplayObjectContainerAWDParser \t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser\");\r\nimport MeshAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser\");\r\nimport BillboardAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser\");\r\nimport Single2DTextureAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/Single2DTextureAWDParser\");\r\nimport CameraAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser\");\r\nimport SingleCubeTextureAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SingleCubeTextureAWDParser\");\r\nimport LightAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser\");\r\nimport LightPickerAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser\");\r\nimport MaterialAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser\");\r\nimport MovieClipAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser\");\r\nimport ShadowMethodAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser\");\r\nimport SharedMethodAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser\");\r\nimport SkeletonAnimClipAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser\");\r\nimport SkeletonAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser\");\r\nimport SkeletonPoseAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser\");\r\nimport SkyboxAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser\");\r\nimport TesselatedFontAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser\");\r\nimport TextfieldAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser\");\r\nimport TextformatAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser\");\r\nimport VertexAnimationSetAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser\");\r\nimport VertexAnimClipAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser\");\r\nimport CommandAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser\");\r\nimport MetadataAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser\");\r\nimport BlockNameSpaceAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser\");\r\nimport AnimatorAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser\");\r\nimport AudioAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser\");\r\n\r\n\r\n\r\nclass AWDBlockParsers\r\n{\r\n\r\n\tprivate _supported_asset_blocks:Object = {};\r\n\tprivate _all_block_parsers:Array<AWDAssetParserBase>;\r\n\tconstructor()\r\n\t{\r\n\t\tthis._all_block_parsers=new Array<AWDAssetParserBase>();\r\n\r\n\t\tthis.add_block_parser(new GeometryAWDParser(), [1]);\r\n\t\tthis.add_block_parser(new PrefabAWDParser(), [11]);\r\n\t\tthis.add_block_parser(new DisplayObjectContainerAWDParser(), [22]);\r\n\t\tthis.add_block_parser(new MeshAWDParser(), [23, 24]);\r\n\r\n\t\tthis.add_block_parser(new BillboardAWDParser(), [25]);\r\n\t\tthis.add_block_parser(new SkyboxAWDParser(), [31]);\r\n\t\tthis.add_block_parser(new LightAWDParser(), [41]);\r\n\t\tthis.add_block_parser(new CameraAWDParser(), [42]);\r\n\t\t//this.add_block_parser(new TextureprojectorAWDParser(), [43]);\r\n\t\tthis.add_block_parser(new AudioAWDParser(), [44]);\r\n\t\tthis.add_block_parser(new LightPickerAWDParser(), [51]);\r\n\t\tthis.add_block_parser(new MaterialAWDParser(), [81]);\r\n\t\tthis.add_block_parser(new Single2DTextureAWDParser(), [82]);\r\n\t\tthis.add_block_parser(new SingleCubeTextureAWDParser(), [83]);\r\n\t\tthis.add_block_parser(new SharedMethodAWDParser(), [91]);\r\n\t\tthis.add_block_parser(new ShadowMethodAWDParser(), [92]);\r\n\t\tthis.add_block_parser(new SkeletonAWDParser(), [101]);\r\n\t\tthis.add_block_parser(new SkeletonPoseAWDParser(), [102]);\r\n\t\tthis.add_block_parser(new SkeletonAnimClipAWDParser(), [103]);\r\n\t\tthis.add_block_parser(new VertexAnimClipAWDParser(), [111, 112]);\r\n\t\tthis.add_block_parser(new VertexAnimationSetAWDParser(), [113]);\r\n\t\t//this.add_block_parser(new UVAnimationClipAWDParser(), [121]);\r\n\t\tthis.add_block_parser(new AnimatorAWDParser(), [122]);\r\n\t\tthis.add_block_parser(new MovieClipAWDParser(), [133]);\r\n\t\tthis.add_block_parser(new TextfieldAWDParser(), [134]);\r\n\t\tthis.add_block_parser(new TesselatedFontAWDParser(), [135]);\r\n\t\tthis.add_block_parser(new TextformatAWDParser(), [136]);\r\n\r\n\r\n\t\tthis.add_block_parser(new CommandAWDParser(), [253]);\r\n\t\tthis.add_block_parser(new BlockNameSpaceAWDParser(), [254]);\r\n\t\tthis.add_block_parser(new MetadataAWDParser(), [255]);\r\n\r\n\r\n\t}\r\n\r\n\tpublic add_block_parser(block_parser:AWDAssetParserBase, block_types:Array<number>):void\r\n\t{\r\n\t\tfor(var i:number=0; i<block_types.length;i++){\r\n\t\t\tthis._supported_asset_blocks[block_types[i]]  = block_parser;\r\n\t\t}\r\n\t\tthis._all_block_parsers.push(block_parser);\r\n\r\n\t}\r\n\r\n\tpublic init_parser(file_data:AWD3FileData):void\r\n\t{\r\n\t\tfor(var i:number=0; i<this._all_block_parsers.length;i++){\r\n\t\t\tthis._all_block_parsers[i].awd_file_data=file_data;\r\n\t\t}\r\n\r\n\t}\r\n\tpublic parseAsset(type:number):boolean\r\n\t{\r\n\r\n\t\tvar this_parser:AWDAssetParserBase=this._supported_asset_blocks[type];\r\n\t\tif(this_parser!=undefined){\r\n\t\t\tthis_parser.parseFromBytes();\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWDBlockParsers;",
    "/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass AnimatorAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar animSetBlockAdress:number; /*int*/\r\n\t\tvar targetAnimationSet:AnimationSetBase;\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar type:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR});\r\n\r\n\t\tanimSetBlockAdress = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar targetMeshLength:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar meshAdresses:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tfor (var i:number /*int*/ = 0; i < targetMeshLength; i++)\r\n\t\t\tmeshAdresses.push(this.awd_file_data.newBlockBytes.readUnsignedInt());\r\n\r\n\t\tvar activeState:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar autoplay:boolean = ( this.awd_file_data.newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar targetMeshes:Array<Mesh> = new Array<Mesh>();\r\n\r\n\t\tfor (i = 0; i < meshAdresses.length; i++) {\r\n\t\t\tvar targetMesh:Mesh = <Mesh>this.awd_file_data.getAssetByID(meshAdresses[i]);\r\n\t\t\tif (targetMesh!=undefined)\r\n\t\t\t\ttargetMeshes.push(targetMesh);\r\n\t\t}\r\n\t\tvar targetAnimationSet:AnimationSetBase = <AnimationSetBase>this.awd_file_data.getAssetByID(animSetBlockAdress);\r\n\t\tif (targetAnimationSet==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the AnimationSet ( \" + animSetBlockAdress + \" ) for this.awd_file_data Animator\");\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar thisAnimator:AnimatorBase;\r\n\t\tif (type == 1) {\r\n\r\n\t\t\tvar skeleton:Skeleton = <Skeleton>this.awd_file_data.getAssetByID(props.get(1, 0));\r\n\t\t\tif (skeleton==undefined) {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the Skeleton ( \" + props.get(1, 0) + \" ) for this.awd_file_data Animator\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthisAnimator = new SkeletonAnimator(<SkeletonAnimationSet> targetAnimationSet, skeleton);\r\n\r\n\t\t} else if (type == 2)\r\n\t\t\tthisAnimator = new VertexAnimator(<VertexAnimationSet> targetAnimationSet);\r\n\r\n\t\tfor (i = 0; i < targetMeshes.length; i++) {\r\n\t\t\tif (type == 1)\r\n\t\t\t\ttargetMeshes[i].animator = (<SkeletonAnimator> thisAnimator);\r\n\t\t\tif (type == 2)\r\n\t\t\t\ttargetMeshes[i].animator = (<VertexAnimator> thisAnimator);\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.data = thisAnimator;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Animator: Name = \" + this.awd_file_data.cur_block.name);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AnimatorAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass AudioAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t//this.awd_file_data._texture_users[this.awd_file_data._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block.id.toString(), new URLRequest(url), false, null, true);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t//this.awd_file_data._pPauseAndRetrieveDependencies();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar audioStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + audioStylesNames[type] + \" AudioFile\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AudioAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nclass BillboardAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mat:MaterialBase= <MaterialBase> this.awd_file_data.getAssetByID(data_id);\r\n\r\n\t\tif (mat==undefined) {\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\t\tvar billboard:Billboard = new Billboard(mat);\r\n\t\tthis.awd_file_data.cur_block.data = billboard;\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\r\n\t\tbillboard.extra = this.awd_file_data.parseUserAttributes();\r\n\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Library-Billboard: Name = '\" + billboard.name + \"| Material-Name = \" + mat.name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = BillboardAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass BlockNameSpaceAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar id:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar nameSpaceString:string = this.awd_file_data.parseVarStr();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a NameSpaceBlock: ID = \" + id + \" | String = \" + nameSpaceString);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = BlockNameSpaceAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Parser\t\t\t\t= require(\"awayjs-parsers/lib/AWD3Parser\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport ProjectionBase\t\t\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\r\nimport PerspectiveProjection\t\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\r\nimport OrthographicProjection\t\t\t= require(\"awayjs-core/lib/projections/OrthographicProjection\");\r\nimport OrthographicOffCenterProjection\t= require(\"awayjs-core/lib/projections/OrthographicOffCenterProjection\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass CameraAWD3Parser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void {\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar projection:ProjectionBase;\r\n\r\n\t\tthis.awd_file_data.newBlockBytes.readUnsignedByte(); //set as active camera\r\n\t\tthis.awd_file_data.newBlockBytes.readShort(); //lengthof lenses - not used yet\r\n\r\n\t\tvar projectiontype:number = this.awd_file_data.newBlockBytes.readShort();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({\r\n\t\t\t101: this.awd_file_data.propsNrType,\r\n\t\t\t102: this.awd_file_data.propsNrType,\r\n\t\t\t103: this.awd_file_data.propsNrType,\r\n\t\t\t104: this.awd_file_data.propsNrType\r\n\t\t});\r\n\r\n\t\tswitch (projectiontype) {\r\n\t\t\tcase 5001:\r\n\t\t\t\tprojection = new PerspectiveProjection(props.get(101, 60));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5002:\r\n\t\t\t\tprojection = new OrthographicProjection(props.get(101, 500));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5003:\r\n\t\t\t\tprojection = new OrthographicOffCenterProjection(props.get(101, -400), props.get(102, 400), props.get(103, -300), props.get(104, 300));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"unsupportedLenstype\");\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar camera:Camera = new Camera(projection);\r\n\t\tcamera.transform.matrix3D = mtx;\r\n\t\tif (par_id > 0) {\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id);\r\n\t\t\tif (parent != undefined) {\r\n\t\t\t\tparent.addChild(camera);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcamera.name = name;\r\n\t\tprops = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\t\tcamera.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\tcamera.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = camera;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Camera: Name = '\" + camera.name + \"' | Projectiontype = \" + projection + \" | Parent-Name = \" + parentName);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = CameraAWD3Parser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass CommandAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar hasBlocks:boolean = ( this.awd_file_data.newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar parentObject:DisplayObjectContainer;\r\n\t\tvar targetObject:DisplayObject;\r\n\r\n\t\tif(par_id>0)\r\n\t\t\tparentObject = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id); //for no only light is requested!!!!\r\n\r\n\t\tvar numCommands:number = this.awd_file_data.newBlockBytes.readShort();\r\n\t\tvar typeCommand:number = this.awd_file_data.newBlockBytes.readShort();\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR});\r\n\r\n\t\tswitch (typeCommand) {\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tvar targetID:number = props.get(1, 0);\r\n\t\t\t\t//var returnedArrayTarget:Array<any> = this.getAssetByID(targetID, [LightBase.assetType, TextureProjector.assetType]); //for no only light is requested!!!!\r\n\t\t\t\ttargetObject = <DisplayObject>this.awd_file_data.getAssetByID(targetID); //for no only light is requested!!!!\r\n\t\t\t\tif(targetObject==undefined){\r\n\t\t\t\t\t//this._awd_data._blocks[blockID].addError(\"Could not find the light (ID = \" + targetID + \" ( for this CommandBock!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parentObject) {\r\n\t\t\t\t\tparentObject.addChild(targetObject);\r\n\t\t\t\t}\r\n\t\t\t\ttargetObject.transform.matrix3D = mtx;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (targetObject) {\r\n\t\t\tprops = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\r\n\t\t\ttargetObject.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\ttargetObject.extra = this.awd_file_data.parseUserAttributes();\r\n\r\n\t\t}\r\n\t\t//this._awd_data._blocks[blockID].data = targetObject\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a CommandBlock: Name = '\" + name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = CommandAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AWDProperties\t\t\t= require(\"../AWD3ParserUtils/AWDProperties\");\r\n\r\nimport DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass DisplayObjectContainerAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar par_id:number;\r\n\t\tvar mtx:Matrix3D;\r\n\t\tvar ctr:DisplayObjectContainer;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\r\n\t\tctr = new DisplayObjectContainer();\r\n\t\tpar_id = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tmtx = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tctr.transform.matrix3D = mtx;\r\n\r\n\r\n\t\tif (par_id > 0) {\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id);\r\n\t\t\tif (parent != undefined) {\r\n\t\t\t\tparent.addChild(ctr);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// in AWD version 2.1 we read the Container properties\r\n\t\tif ((this.awd_file_data.major_version > 2)||((this.awd_file_data.major_version >= 2) && (this.awd_file_data.minor_version == 1))) {\r\n\t\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\t\t\tctr.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t}\r\n\t\t// in other versions we do not read the Container properties\r\n\t\telse {\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t}\r\n\r\n\t\t// the extraProperties should only be set for AWD2.1-Files, but is read for both versions\r\n\t\tctr.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=ctr;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Container: Name = '\" + ctr.name + \"' | Parent-Name = \" + parentName);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = DisplayObjectContainerAWDParser;",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\n\r\nclass GeometryAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar geom:Geometry = new Geometry();\r\n\r\n\t\t// Read name and sub count\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_subs:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t// Read optional properties\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.geoNrType, 2:this.awd_file_data.geoNrType});\r\n\t\tvar geoScaleU:number = props.get(1, 1);\r\n\t\tvar geoScaleV:number = props.get(2, 1);\r\n\r\n\t\t// Loop through sub meshes\r\n\t\tvar subs_parsed:number = 0;\r\n\t\twhile (subs_parsed < num_subs) {\r\n\t\t\tvar is_curve_geom:boolean=false;\r\n\t\t\tvar i:number;\r\n\t\t\tvar sm_len:number, sm_end:number;\r\n\t\t\tvar w_indices:Array<number>;\r\n\t\t\tvar weights:Array<number>;\r\n\r\n\t\t\tsm_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tsm_end = this.awd_file_data.newBlockBytes.position + sm_len;\r\n\r\n\t\t\tvar subProps:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.geoNrType, 2:this.awd_file_data.geoNrType});\r\n\t\t\t// Loop through data streams\r\n\t\t\twhile (this.awd_file_data.newBlockBytes.position < sm_end) {\r\n\t\t\t\tvar idx:number = 0;\r\n\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t// Type, field type, length\r\n\t\t\t\tstr_type = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_ftype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\r\n\t\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\t\tif (str_type == 1) {//vertex 3d positions\r\n\t\t\t\t\tvar verts:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tx = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\ty = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\tz = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\r\n\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 2) {//face indicies positions\r\n\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tindices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 3) {\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tuvs[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 4) {\r\n\r\n\t\t\t\t\tvar normals:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tnormals[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 6) {\r\n\t\t\t\t\tw_indices = Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tw_indices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort()*3;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 7) {\r\n\r\n\t\t\t\t\tweights = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tweights[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 8) {// 2d-positions - not used yet.\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 9) {// combined vertex3D stream 13 x float32\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\tis_curve_geom=true;\r\n\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// x\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// y\r\n\t\t\t\t\t\tpositions[idx_pos++] =  this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// type\r\n\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.awd_file_data.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\t\t\tif(is_curve_geom){\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(new AttributesBuffer());\r\n\t\t\t\tcurve_sub_geom.setIndices(indices);\r\n\t\t\t\tcurve_sub_geom.setPositions(positions);\r\n\t\t\t\tcurve_sub_geom.setCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.setUVs(uvs);\r\n\t\t\t\tgeom.addSubGeometry(curve_sub_geom);\r\n\t\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a CurveSubGeometry\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar triangle_sub_geom = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\t\tif (weights)\r\n\t\t\t\t\ttriangle_sub_geom.jointsPerVertex = weights.length / (verts.length / 3);\r\n\t\t\t\tif (normals)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (uvs)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveUVs = false;\r\n\t\t\t\t//triangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (true) {\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveTangents = true;\r\n\t\t\t\t}\r\n\t\t\t\ttriangle_sub_geom.setIndices(indices);\r\n\t\t\t\ttriangle_sub_geom.setPositions(verts);\r\n\t\t\t\ttriangle_sub_geom.setNormals(normals);\r\n\t\t\t\ttriangle_sub_geom.setUVs(uvs);\r\n\t\t\t\ttriangle_sub_geom.setTangents(null);\r\n\t\t\t\ttriangle_sub_geom.setJointWeights(weights);\r\n\t\t\t\ttriangle_sub_geom.setJointIndices(w_indices);\r\n\r\n\t\t\t\tvar scaleU:number = subProps.get(1, 1);\r\n\t\t\t\tvar scaleV:number = subProps.get(2, 1);\r\n\t\t\t\tvar setSubUVs:boolean = false; //this should remain false atm, because in AwayBuilder the uv is only scaled by the geometry\r\n\r\n\t\t\t\tif ((geoScaleU != scaleU) || (geoScaleV != scaleV)) {\r\n\t\t\t\t\tsetSubUVs = true;\r\n\t\t\t\t\tscaleU = geoScaleU / scaleU;\r\n\t\t\t\t\tscaleV = geoScaleV / scaleV;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (setSubUVs)\r\n\t\t\t\t\ttriangle_sub_geom.scaleUV(scaleU, scaleV);\r\n\t\t\t\tgeom.addSubGeometry(triangle_sub_geom);\r\n\t\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a TriangleSubGeometry\");\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// TODO: Somehow map in-sub to out-sub indices to enable look-up\r\n\t\t\t// when creating meshes (and their material assignments.)\r\n\r\n\t\t\tsubs_parsed++;\r\n\t\t}\r\n\t\tif ((geoScaleU != 1) || (geoScaleV != 1))\r\n\t\t\tgeom.scaleUV(geoScaleU, geoScaleV);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=geom;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TriangleGeometry: Name = \" + name);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = GeometryAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport CubeMapShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\r\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\r\nimport ShadowMapperBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\n\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass LightAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\t\r\n\t\tvar light:LightBase;\r\n\t\tvar newShadowMapper:ShadowMapperBase;\r\n\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar lightType:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.propsNrType, 2:this.awd_file_data.propsNrType, 3:AWD3Utils.COLOR, 4:this.awd_file_data.propsNrType, 5:this.awd_file_data.propsNrType, 6:AWD3Utils.BOOL, 7:AWD3Utils.COLOR, 8:this.awd_file_data.propsNrType, 9:AWD3Utils.UINT8, 10:AWD3Utils.UINT8, 11:this.awd_file_data.propsNrType, 12:AWD3Utils.UINT16, 21:this.awd_file_data.matrixNrType, 22:this.awd_file_data.matrixNrType, 23:this.awd_file_data.matrixNrType});\r\n\t\tvar shadowMapperType:number = props.get(9, 0);\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar lightTypes:Array<string> = [\"Unsupported LightType\", \"PointLight\", \"DirectionalLight\"];\r\n\t\tvar shadowMapperTypes:Array<string> = [\"No ShadowMapper\", \"DirectionalShadowMapper\", \"NearDirectionalShadowMapper\", \"CascadeShadowMapper\", \"CubeMapShadowMapper\"];\r\n\r\n\t\tif (lightType == 1) {\r\n\t\t\tlight = new PointLight();\r\n\r\n\t\t\t(<PointLight> light).radius = props.get(1, 90000);\r\n\t\t\t(<PointLight> light).fallOff = props.get(2, 100000);\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 4) {\r\n\t\t\t\t\tnewShadowMapper = new CubeMapShadowMapper();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.transform.matrix3D = mtx;\r\n\r\n\t\t}\r\n\r\n\t\tif (lightType == 2) {\r\n\r\n\t\t\tlight = new DirectionalLight(props.get(21, 0), props.get(22, -1), props.get(23, 1));\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 1) {\r\n\t\t\t\t\tnewShadowMapper = new DirectionalShadowMapper();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if (shadowMapperType == 2)\r\n\t\t\t\t//  newShadowMapper = new NearDirectionalShadowMapper(props.get(11, 0.5));\r\n\t\t\t\t//if (shadowMapperType == 3)\r\n\t\t\t\t//   newShadowMapper = new CascadeShadowMapper(props.get(12, 3));\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tlight.name=name;\r\n\t\tlight.color = props.get(3, 0xffffff);\r\n\t\tlight.specular = props.get(4, 1.0);\r\n\t\tlight.diffuse = props.get(5, 1.0);\r\n\t\tlight.ambientColor = props.get(7, 0xffffff);\r\n\t\tlight.ambient = props.get(8, 0.0);\r\n\r\n\t\t// if a shadowMapper has been created, adjust the depthMapSize if needed, assign to light and set castShadows to true\r\n\t\tif (newShadowMapper) {\r\n\t\t\tif (newShadowMapper instanceof CubeMapShadowMapper) {\r\n\t\t\t\tif (props.get(10, 1) != 1) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this.awd_file_data.getDepthSizeFromEnum(props.get(10, 1));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (props.get(10, 2) != 2) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this.awd_file_data.getDepthSizeFromEnum(props.get(10, 2));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.shadowMapper = newShadowMapper;\r\n\t\t\tlight.castsShadows = true;\r\n\t\t}\r\n\r\n\t\tif (par_id != 0) {\r\n\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id)\r\n\r\n\t\t\tif (parent!=undefined){\r\n\t\t\t\tparent.addChild(light);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t} else {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find a parent for this.awd_file_data Light\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t//(<DisplayObjectContainer> this.awd_file_data._pContent).addChild(light);\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = light;\r\n\r\n\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Light: Name = '\" + this.awd_file_data.cur_block.name + \"' | Type = \" + lightTypes[lightType] + \" | Parent-Name = \" + parentName + \" | ShadowMapper-Type = \" + shadowMapperTypes[shadowMapperType]);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = LightAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\n\r\nclass LightPickerAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar numLights:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar lightsArray:Array<LightBase> = new Array<LightBase>();\r\n\t\tvar k:number = 0;\r\n\t\tvar lightID:number = 0;\r\n\r\n\t\tvar returnedArrayLight:Array<any>;\r\n\t\tvar lightsArrayNames:Array<string> = new Array<string>();\r\n\r\n\t\tfor (k = 0; k < numLights; k++) {\r\n\t\t\tlightID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar light:LightBase = <LightBase>this.awd_file_data.getAssetByID(lightID)\r\n\r\n\t\t\tif (light!=undefined) {\r\n\t\t\t\tlightsArray.push(<LightBase> light);\r\n\t\t\t\tlightsArrayNames.push(( <LightBase> light).name);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find a Light Nr \" + k + \" (ID = \" + lightID + \" ) for this.awd_file_data LightPicker\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lightsArray.length == 0) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not create this.awd_file_data LightPicker, cause no Light was found.\");\r\n\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\treturn undefined; //return without any more parsing for this.awd_file_data block\r\n\t\t}\r\n\r\n\t\tvar lightPicker:LightPickerBase = new StaticLightPicker(lightsArray);\r\n\t\tthis.awd_file_data.cur_block.data = lightPicker;\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a StaticLightPicker: Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + lightsArrayNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = LightPickerAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\")\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\n\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport AmbientEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod\");\r\nimport DiffuseDepthMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod\");\r\nimport DiffuseCelMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCelMethod\");\r\nimport DiffuseGradientMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod\");\r\nimport DiffuseLightMapMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod\");\r\nimport DiffuseWrapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod\");\r\nimport NormalSimpleWaterMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod\");\r\nimport SpecularFresnelMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod\");\r\nimport SpecularAnisotropicMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod\");\r\nimport SpecularCelMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCelMethod\");\r\nimport SpecularPhongMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularPhongMethod\");\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MaterialAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\t// version 2.0\r\n\t\t////blockLength = block.len;\r\n\t\tvar name:string;\r\n\t\tvar type:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar attributes:Object;\r\n\t\tvar finalize:boolean;\r\n\t\tvar num_methods:number;\r\n\t\tvar methods_parsed:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar normalTexture:Single2DTexture;\r\n\t\tvar specTexture:Single2DTexture;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\ttype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tnum_methods = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\tif((this.awd_file_data.major_version==2)&&(this.awd_file_data.major_version==0)) {\r\n\r\n\t\t\t// Read material numerical properties\r\n\t\t\t// (1=color, 2=bitmap url, 10=alpha, 11=alpha_blending, 12=alpha_threshold, 13=repeat)\r\n\t\t\tprops = this.awd_file_data.parseProperties({\r\n\t\t\t\t1: AWD3Utils.INT32,\r\n\t\t\t\t2: AWD3Utils.BADDR,\r\n\t\t\t\t10: this.awd_file_data.propsNrType,\r\n\t\t\t\t11: AWD3Utils.BOOL,\r\n\t\t\t\t12: this.awd_file_data.propsNrType,\r\n\t\t\t\t13: AWD3Utils.BOOL\r\n\t\t\t});\r\n\t\t\tmethods_parsed = 0;\r\n\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\tvar method_type:number;\r\n\r\n\t\t\t\tmethod_type = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\t\tmethods_parsed += 1;\r\n\t\t\t}\r\n\t\t\tvar debugString:string = \"\";\r\n\t\t\tattributes = this.awd_file_data.parseUserAttributes();\r\n\t\t\tif (type === 1) { // Color material\r\n\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\tvar color:number;\r\n\t\t\t\tcolor = props.get(1, 0xffffff);\r\n\t\t\t\t/*if (this.awd_file_data.materialMode < 2) {\r\n\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t}*/\r\n\t\t\t} else if (type === 2) {\r\n\t\t\t\tvar tex_addr:number = props.get(2, 0);\r\n\t\t\t\tvar texture:TextureBase=undefined;\r\n\t\t\t\tif (tex_addr > 0) {\r\n\t\t\t\t\tvar texture:TextureBase = <TextureBase> this.awd_file_data.getAssetByID(tex_addr);\r\n\t\t\t\t}\r\n\t\t\t\tif (texture==undefined) {\r\n\t\t\t\t\ttexture= DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat = new MethodMaterial(<Single2DTexture>texture);\r\n\t\t\t\t/*\r\n\t\t\t\tif (this.awd_file_data.materialMode < 2) {\r\n\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\r\n\t\t\tmat.extra = attributes;\r\n\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\tmat.repeat = props.get(13, false);\r\n\t\t\tmat.name=name;\r\n\t\t\tif (this.awd_file_data.debug) {\r\n\t\t\t\tconsole.log(debugString);\r\n\r\n\t\t\t}\r\n\t\t\tthis.awd_file_data.cur_block.data=mat;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// version 2.1+\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT32, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 4:AWD3Utils.UINT8, 5:AWD3Utils.BOOL, 6:AWD3Utils.BOOL, 7:AWD3Utils.BOOL, 8:AWD3Utils.BOOL, 9:AWD3Utils.UINT8, 10:this.awd_file_data.propsNrType, 11:AWD3Utils.BOOL, 12:this.awd_file_data.propsNrType, 13:AWD3Utils.BOOL, 15:this.awd_file_data.propsNrType, 16:AWD3Utils.UINT32, 17:AWD3Utils.BADDR, 18:this.awd_file_data.propsNrType, 19:this.awd_file_data.propsNrType, 20:AWD3Utils.UINT32, 21:AWD3Utils.BADDR, 22:AWD3Utils.BADDR});\r\n\t\tvar spezialType:number = props.get(4, 0);\r\n\t\tvar debugString:string = \"Parsed Material \";\r\n\r\n\t\tif (spezialType >= 2) {//this.awd_file_data is no supported material\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Material-spezialType '\" + spezialType + \"' is not supported, can only be 0:singlePass, 1:MultiPass !\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type <= 2) {// Color material\r\n\t\t\t/*\r\n\t\t\tif (this.awd_file_data.materialMode == 1)\r\n\t\t\t\tspezialType = 0;\r\n\t\t\telse if (this.awd_file_data.materialMode == 2)\r\n\t\t\t\tspezialType = 1;\r\n\t\t\t\t*/\r\n\r\n\t\t\tif (spezialType < 2) {//this.awd_file_data is SinglePass or MultiPass\r\n\r\n\t\t\t\tif (type == 1) {// Color material\r\n\t\t\t\t\tvar color:number = props.get(1, 0xcccccc);//TODO temporarily swapped so that diffuse color goes to ambient\r\n\r\n\t\t\t\t\tif (spezialType == 1) {//\tMultiPassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(MultiPass): Name = '\" + name + \"' | \";\r\n\r\n\t\t\t\t\t} else { //\tSinglePassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (type == 2) {// texture material\r\n\t\t\t\t\tvar tex_addr:number = props.get(2, 0);//TODO temporarily swapped so that diffuse texture goes to ambient\r\n\t\t\t\t\tvar diftexture:TextureBase=undefined;\r\n\t\t\t\t\tif (tex_addr > 0) {\r\n\t\t\t\t\t\tdiftexture = <TextureBase> this.awd_file_data.getAssetByID(tex_addr);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (diftexture==undefined) {\r\n\t\t\t\t\t\tdiftexture= DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmat = new MethodMaterial(<Single2DTexture>diftexture);\r\n\r\n\t\t\t\t\tif (spezialType == 1) {// MultiPassMaterial\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + diftexture.name;\r\n\t\t\t\t\t} else {//\tSinglePassMaterial\r\n\t\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + diftexture.name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tvar diffuseTex_addr:number = props.get(17, 0);\r\n\r\n\t\t\t\tvar diffuseTexture:TextureBase = undefined;\r\n\t\t\t\tif (diffuseTex_addr > 0) {\r\n\t\t\t\t\tdiffuseTexture = <Single2DTexture> this.awd_file_data.getAssetByID(diffuseTex_addr);\r\n\t\t\t\t}\r\n\t\t\t\tif (diffuseTexture) {\r\n\t\t\t\t\tmat.diffuseTexture = <Single2DTexture>diffuseTexture;\r\n\t\t\t\t\tdebugString += \" | DiffuseTexture-Name = \" + diffuseTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar normalTex_addr:number = props.get(3, 0);\r\n\r\n\r\n\t\t\t\tnormalTexture = undefined;\r\n\t\t\t\tif (normalTex_addr > 0) {\r\n\t\t\t\t\tnormalTexture = <Single2DTexture> this.awd_file_data.getAssetByID(normalTex_addr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar specTex_addr:number = props.get(21, 0);\r\n\t\t\t\tspecTexture=undefined;\r\n\t\t\t\tif (specTex_addr > 0) {\r\n\t\t\t\t\tspecTexture = <Single2DTexture> this.awd_file_data.getAssetByID(specTex_addr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar lightPickerAddr:number = props.get(22, 0);\r\n\t\t\t\tif(lightPickerAddr>0) {\r\n\t\t\t\t\tmat.lightPicker = <LightPickerBase> this.awd_file_data.getAssetByID(lightPickerAddr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat.smooth = props.get(5, true);\r\n\t\t\t\tmat.mipmap = props.get(6, true);\r\n\t\t\t\tmat.bothSides = props.get(7, false);\r\n\t\t\t\tmat.alphaPremultiplied = props.get(8, false);\r\n\t\t\t\tmat.blendMode = this.awd_file_data.getBlendModeStringFromEnum(props.get(9, 0));\r\n\t\t\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\t\t\tif (normalTexture)\r\n\t\t\t\t\tmat.normalMap = normalTexture;\r\n\r\n\t\t\t\tif (specTexture)\r\n\t\t\t\t\tmat.specularMap = specTexture;\r\n\r\n\t\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\t\tmat.ambient = props.get(15, 1.0);\r\n\t\t\t\tmat.diffuseColor = props.get(16, 0xffffff);\r\n\t\t\t\tmat.specular = props.get(18, 1.0);\r\n\t\t\t\tmat.gloss = props.get(19, 50);\r\n\t\t\t\tmat.specularColor = props.get(20, 0xffffff);\r\n\r\n\t\t\t\tvar methods_parsed:number = 0;\r\n\t\t\t\tvar targetID:number;\r\n\r\n\t\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\t\tvar method_type:number;\r\n\t\t\t\t\tmethod_type = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t\tprops = this.awd_file_data.parseProperties({\r\n\t\t\t\t\t\t1: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t2: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t3: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t101: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t102: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t103: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t201: AWD3Utils.UINT32,\r\n\t\t\t\t\t\t202: AWD3Utils.UINT32,\r\n\t\t\t\t\t\t301: AWD3Utils.UINT16,\r\n\t\t\t\t\t\t302: AWD3Utils.UINT16,\r\n\t\t\t\t\t\t401: AWD3Utils.UINT8,\r\n\t\t\t\t\t\t402: AWD3Utils.UINT8,\r\n\t\t\t\t\t\t601: AWD3Utils.COLOR,\r\n\t\t\t\t\t\t602: AWD3Utils.COLOR,\r\n\t\t\t\t\t\t701: AWD3Utils.BOOL,\r\n\t\t\t\t\t\t702: AWD3Utils.BOOL,\r\n\t\t\t\t\t\t801: AWD3Utils.MTX4x4\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tswitch (method_type) {\r\n\t\t\t\t\t\tcase 999: //wrapper-Methods that will load a previous parsed EffectMethod\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tvar fx_method:EffectMethodBase = <EffectMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t\tmat.addEffectMethod(fx_method);\r\n\t\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<EffectMethodBase> fx_method).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 998: //wrapper-Methods that will load a previous parsed ShadowMapMethod\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tvar shadow_method:ShadowMethodBase = <ShadowMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t\tmat.shadowMethod=shadow_method;\r\n\t\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<ShadowMethodBase> shadow_method).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 1: //EnvMapAmbientMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar cubeTex:SingleCubeTexture=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tcubeTex = <SingleCubeTexture>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(cubeTex==undefined){\r\n\t\t\t\t\t\t\t\tcubeTex=<SingleCubeTexture>this.awd_file_data.getDefaultCubeTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data EnvMapAmbientMethodMaterial\");\r\n\t\t\t\t\t\t\tmat.ambientMethod = new AmbientEnvMapMethod();\r\n\t\t\t\t\t\t\tmat.texture = cubeTex;\r\n\t\t\t\t\t\t\tdebugString += \" | AmbientEnvMapMethod | EnvMap-Name =\" + (<SingleCubeTexture> cubeTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 51: //DepthDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseDepthMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseDepthMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 52: //GradientDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the GradientDiffuseTexture (ID = \" + targetID + \" ) for this.awd_file_data GradientDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseGradientMethod(<Single2DTexture>thisTex);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseGradientMethod | GradientDiffuseTexture-Name =\" + (<Single2DTexture>thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 53: //WrapDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseWrapMethod(props.get(101, 5));\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseWrapMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 54: //LightMapDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this.awd_file_data LightMapDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseLightMapMethod(<Single2DTexture>thisTex, this.awd_file_data.getBlendModeStringFromEnum(props.get(401, 10)), false, mat.diffuseMethod);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseLightMapMethod | LightMapTexture-Name =\" + (<Single2DTexture> thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 55: //CelDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseCelMethod(props.get(401, 3), mat.diffuseMethod);\r\n\t\t\t\t\t\t\t(<DiffuseCelMethod> mat.diffuseMethod).smoothness = props.get(101, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 56: //SubSurfaceScatteringMethod\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseSubSurfaceMethod(); //depthMapSize and depthMapOffset ?\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scattering = props.get(101, 0.2);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).translucency = props.get(102, 1);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scatterColor = props.get(601, 0xffffff);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tdebugString += \" | DiffuseSubSurfaceMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 101: //AnisotropicSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularAnisotropicMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularAnisotropicMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 102: //SpecularPhongMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularPhongMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularPhongMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 103: //CellSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularCelMethod(props.get(101, 0.5), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularCelMethod> mat.specularMethod).smoothness = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 104: //SpecularFresnelMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularFresnelMethod(props.get(701, true), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).fresnelPower = props.get(101, 5);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).normalReflectance = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularFresnelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 151://HeightMapNormalMethod - thios is not implemented for now, but might appear later\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 152: //SimpleWaterNormalMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the SecoundNormalMap (ID = \" + targetID + \" ) for this.awd_file_data SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\t\t//if (!mat.normalMap)\r\n\t\t\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find a normal Map on this.awd_file_data Material to use with this.awd_file_data SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\t\tif(mat.normalMap==undefined)\r\n\t\t\t\t\t\t\t\tmat.normalMap = <Single2DTexture>thisTex;\r\n\t\t\t\t\t\t\tmat.normalMethod = new NormalSimpleWaterMethod(<Single2DTexture>mat.normalMap, <Single2DTexture>thisTex);\r\n\t\t\t\t\t\t\tdebugString += \" | NormalSimpleWaterMethod | Second-NormalTexture-Name = \" + (<Single2DTexture> thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\t\t\tmethods_parsed += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: we should not need this.awd_file_data anymore (if using texture-atlas)\r\n\t\telse if ((type>=3)&&(type<=7)){\r\n\t\t\t// if this.awd_file_data is a curve material, we create it, finalize it, assign it to block-cache and return and return.\r\n\t\t\tvar color:number = props.get(1, 0xcccccc);\r\n\t\t\tdebugString+=color;\r\n\t\t\r\n\t\t\tvar diffuseTex_addr:number = props.get(2, 0);\r\n\t\t\r\n\t\t\tvar diffuseTexture:TextureBase=undefined;\r\n\t\t\tif (diffuseTex_addr>0) {\r\n\t\t\t\tdiffuseTexture = <TextureBase>this.awd_file_data.getAssetByID(diffuseTex_addr);\r\n\t\t\t}\r\n\t\t\tif(diffuseTex_addr==undefined){\r\n\t\t\t\tdiffuseTexture=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t}\r\n\t\t\r\n\t\t\tvar basic_mat:BasicMaterial = new BasicMaterial(<Single2DTexture>diffuseTexture);\r\n\t\t\t//debugString+= \" alpha = \"+props.get(10, 1.0)+\" \";\r\n\t\t\tdebugString+= \" texture = \"+diffuseTex_addr+\" \";\r\n\t\t\tbasic_mat.bothSides = true;\r\n\t\t\tbasic_mat.preserveAlpha = true;\r\n\t\t\tbasic_mat.alphaBlending = true;\r\n\t\t\tbasic_mat.extra = this.awd_file_data.parseUserAttributes();\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(debugString);\r\n\t\t\tthis.awd_file_data.cur_block.data=basic_mat;\r\n\t\t\treturn;\r\n\t\t\r\n\t\t}\r\n\t\tmat.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=mat;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(debugString);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = MaterialAWDParser;",
    "/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AWD3Utils\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MeshAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar num_materials:number;\r\n\t\tvar materials_parsed:number;\r\n\t\tif(this.awd_file_data.cur_block.type==23) {\r\n\t\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry = <Geometry>this.awd_file_data.getAssetByID(data_id)\r\n\r\n\t\tif (geom==undefined) {\r\n\t\t\tgeom = new Geometry();\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.cur_block.geoID = data_id;\r\n\t\tvar materials:Array<MaterialBase> = new Array<MaterialBase>();\r\n\t\tnum_materials = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tmaterials_parsed = 0;\r\n\r\n\r\n\t\twhile (materials_parsed < num_materials) {\r\n\t\t\tvar mat_id:number;\r\n\t\t\tmat_id = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar m:MaterialBase = <MaterialBase> this.awd_file_data.getAssetByID(mat_id);\r\n\t\t\tif(m!=undefined) {\r\n\t\t\t\tmaterials.push(m);\r\n\t\t\t\tmaterialNames.push(m.name);\r\n\t\t\t}\r\n\t\t\tmaterials_parsed++;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\r\n\t\tif(this.awd_file_data.cur_block.type==23) {\r\n\r\n\t\t\tmesh.transform.matrix3D = mtx;\r\n\t\t\tif(par_id>0) {\r\n\t\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id)\r\n\r\n\t\t\t\tif (parent != undefined) {\r\n\t\t\t\t\tparent.addChild(mesh);\r\n\t\t\t\t\tparentName = parent.name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\tvar i:number;\r\n\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((this.awd_file_data.major_version > 2)||((this.awd_file_data.major_version >= 2) && (this.awd_file_data.minor_version == 1))) {\r\n\t\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8, 5:AWD3Utils.BOOL});\r\n\t\t\tmesh.pivot = new Vector3D(<number>props.get(1, 0), <number>props.get(2, 0), <number> props.get(3, 0));\r\n\t\t\tmesh.castsShadows = props.get(5, true);\r\n\t\t} else {\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t}\r\n\r\n\t\tmesh.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = mesh;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Mesh: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MeshAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MetadataAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT32, 2:AWD3Utils.AWDSTRING, 3:AWD3Utils.AWDSTRING, 4:AWD3Utils.AWDSTRING, 5:AWD3Utils.AWDSTRING});\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a MetaDataBlock: TimeStamp         = \" + props.get(1, 0));\r\n\t\t\tconsole.log(\"                        EncoderName       = \" + props.get(2, \"unknown\"));\r\n\t\t\tconsole.log(\"                        EncoderVersion    = \" + props.get(3, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorName     = \" + props.get(4, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorVersion  = \" + props.get(5, \"unknown\"));\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MetadataAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDBitFlags\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\n\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport MovieClip \t\t\t\t\t= require(\"awayjs-display/lib/entities/MovieClip\");\r\nimport Timeline\t\t\t \t\t\t= require(\"awayjs-display/lib/base/Timeline\");\r\n\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport TextField\t\t\t\t\t= require(\"awayjs-display/lib/entities/TextField\");\r\nimport View\t\t\t= require(\"awayjs-display/lib/containers/View\");\r\n\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\n\r\nclass MovieClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tprivate factory:AS2SceneGraphFactory;\r\n\tconstructor(view:View = null)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.factory = new AS2SceneGraphFactory(view);\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar i:number;\r\n\t\tvar j:number;\r\n\t\tvar c:number;\r\n\t\tvar new_timeline:Timeline = new Timeline();\r\n\t\tvar new_mc = this.factory.createMovieClip(new_timeline)\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar isScene = !!this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar sceneID = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar fps:number = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t//console.log(\"fps = \"+fps);\r\n\t\t//new_mc.fps=fps;\r\n\t\tvar ms_per_frame = 1000 / fps;\r\n\t\tvar num_instances:number=0;\r\n\t\tvar num_all_display_instances:number=0;\r\n\r\n\r\n\t\t// register list of potential childs\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\t// However, for each potential child, we need to register the max-number of instances that a frame contains\r\n\t\t// we parse 2 lists of potential-childs:\r\n\t\t// -\tthe first list contains potential-childs that are only ever instanced once per frame.\r\n\t\t// -\tthe second list contains potential-childs that are instanced multiple times on some frames.\r\n\r\n\t\t// on registering a child, the child gets a incremental-id assigned. This is the id, that the commands are using to access the childs.\r\n\t\t// hence we need to be careful to register all objects in correct order.\r\n\r\n\t\tvar num_potential_childs:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_childs; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tnew_timeline.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tnum_all_display_instances+=num_potential_childs;\r\n\t\tvar num_potential_childs_multi_instanced = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tnum_potential_childs+=num_potential_childs_multi_instanced;\r\n\t\tfor (i = 0; i < num_potential_childs_multi_instanced; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tnum_instances = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tnum_all_display_instances+=num_instances;\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\tnew_timeline.registerPotentialChild(cmd_asset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_childs+\" potential childs. They will be used by \"+num_all_display_instances+\" instances.\");\r\n\r\n\t\t// register list of potential sounds\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\tvar num_potential_sounds = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_sounds; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\t//todo: register sound objects on movieclip\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: this.awd_file_data is a error that might break complete timeline, because all sound obj-id shift\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_sounds+\" potential sounds\");\r\n\r\n\t\tvar numFrames = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t//console.log(\"numFrames \"+numFrames);\r\n\r\n\t\tvar totalDuration:number = 0;\r\n\t\tvar frameDuration:number;\r\n\t\tvar numLabels:number;\r\n\t\tvar numCommands:number;\r\n\t\tvar objectID:number;\r\n\t\tvar target_depth:number;\r\n\t\tvar resourceID:number;\r\n\t\tvar number_of_obj:number;\r\n\t\tvar commandType:number;\r\n\t\t//var frame:TimelineKeyFrame;\r\n\t\tvar hasDepthChanges:boolean;\r\n\t\tvar sessionCount:number=0;\r\n\t\tfor (i = 0; i < numFrames; i++) {\r\n\t\t\t// todo: remove the ms_per_frame to set the duration in frames\r\n\t\t\tframeDuration = this.awd_file_data.newBlockBytes.readUnsignedInt()*ms_per_frame;\r\n\t\t\t//frame = new TimelineKeyFrame(totalDuration, frameDuration);\r\n\t\t\ttotalDuration += frameDuration;\r\n\r\n\t\t\tnumLabels = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t//for (j = 0; j < numLabels; j++)\r\n\t\t\t//\tnew_timeline._labels[this.awd_file_data.parseVarStr()]=new_timeline.numKeyFrames();\r\n\r\n\t\t\tnumCommands = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t//console.log(\"numCommands \"+numCommands);\r\n\t\t\t//traceString += \"\\n      Commands \" + numCommands;\r\n\t\t\thasDepthChanges = false;\r\n\t\t\tfor (j = 0; j < numCommands; j++) {\r\n\t\t\t\tcommandType = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\t\t\t// 1 = remove a number of objects by depth\r\n\t\t\t\t// 2 = add a object by child-id at specific depth\r\n\t\t\t\t// 3 = update a object by child-id\r\n\t\t\t\t// 4 = add / update sound - (not finished)\r\n\r\n\t\t\t\tswitch (commandType) {\r\n\r\n\t\t\t\t\tcase 1:// remove a number of objects at specific depth\r\n\t\t\t\t\t\tnumber_of_obj = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"number_of_obj \", number_of_obj);\r\n\t\t\t\t\t\tvar remove_depths:Array<number>=new Array<number>();\r\n\t\t\t\t\t\tfor (c = 0; c < number_of_obj; c++) {\r\n\t\t\t\t\t\t\t// Remove Object Command\r\n\t\t\t\t\t\t\ttarget_depth = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\tremove_depths.push(target_depth);\r\n\t\t\t\t\t\t\t//console.log(\"\\n       - Remove object at depth: \" + target_depth);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//frame.frameConstructCommands.push(new RemoveChildrenAtDepthCommand(remove_depths));\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 2:// add a of object by child-id at specific depth\r\n\t\t\t\t\tcase 3:// update a object by child-id\r\n\t\t\t\t\t\tobjectID = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"add / update objectID \", objectID);\r\n\t\t\t\t\t\tif (commandType == 2) {\r\n\t\t\t\t\t\t\thasDepthChanges=true;\r\n\t\t\t\t\t\t\ttarget_depth = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t//console.log(\"target_depth \", target_depth);\r\n\t\t\t\t\t\t\tvar potChild = new_timeline.getPotentialChildPrototype(objectID);\r\n\t\t\t\t\t\t\tif (potChild != undefined) {\r\n\t\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new AddChildAtDepthCommand(objectID, target_depth, sessionCount));\r\n\t\t\t\t\t\t\t\tsessionCount++;\r\n\t\t\t\t\t\t\t\t// if the object is a tetfield, we set the textfield-name as instancename\r\n\t\t\t\t\t\t\t\tif(potChild.isAsset(TextField)) {\r\n\t\t\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new SetInstanceNameCommand(objectID, potChild.name));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tconsole.log(\"ERROR: could not find the objectID \", objectID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar props_flag = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t/*\tProps_flags\r\n\t\t\t\t\t\t 1: read display matrix - 6 x float,\r\n\t\t\t\t\t\t 2: read display matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 3: read color matrix - 4 x float, 4 x uint16\r\n\t\t\t\t\t\t 4: read color matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 5: blendmode - uint8\r\n\t\t\t\t\t\t 6: visible - boolean\r\n\t\t\t\t\t\t 7: AWD3Parser.UINT8\r\n\t\t\t\t\t\t });*/\r\n\t\t\t\t\t\t// read display matrix\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG1)) {\r\n\t\t\t\t\t\t\tvar thisMatrix = new Matrix3D();\r\n\t\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG2)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[0] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[1] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[4] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[5] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.position = new Vector3D(this.awd_file_data.newBlockBytes.readFloat(), this.awd_file_data.newBlockBytes.readFloat(), 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new UpdatePropertyCommand(objectID, \"_iMatrix3D\", thisMatrix));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// read colortransforms\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG3)) {\r\n\t\t\t\t\t\t\tvar thisColorTransform = new ColorTransform();\r\n\t\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG4)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisColorTransform.redMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.redOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG5)) {\r\n\t\t\t\t\t\t\tvar blendmode_int = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\t\tvar blendmode_string = this.awd_file_data.getBlendModeStringFromEnum(blendmode_int);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG6)) {\r\n\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new UpdatePropertyCommand(objectID, \"visible\", this.awd_file_data.newBlockBytes.readByte()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG7)) {\r\n\t\t\t\t\t\t\tvar instanceName = this.awd_file_data.parseVarStr();\r\n\t\t\t\t\t\t\tif (instanceName.length) {\r\n\t\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new SetInstanceNameCommand(objectID, instanceName));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG8)) {\r\n\t\t\t\t\t\t\tvar mask_id_nums = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t\tvar mask_ids = new Array();\r\n\t\t\t\t\t\t\tfor (var mi_cnt = 0; mi_cnt < mask_id_nums; mi_cnt++) {\r\n\t\t\t\t\t\t\t\tmask_ids.push(this.awd_file_data.newBlockBytes.readShort());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (mask_ids.length > 0) {\r\n\t\t\t\t\t\t\t\tif ((mask_ids.length == 1) && (mask_ids[0] == -1)) {\r\n\t\t\t\t\t\t\t\t\t// TODO: this.awd_file_data object is used as mask\r\n\t\t\t\t\t\t\t\t\t//frame.frameConstructCommands.push(new UpdatePropertyCommand(objectID, \"_iMaskID\", objectID));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//else\r\n\t\t\t\t\t\t\t\t//\tframe.frameConstructCommands.push(new SetMaskCommand(objectID, mask_ids));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 4:\r\n\r\n\t\t\t\t\t\t// Add Sound Command\r\n\t\t\t\t\t\t// TODO: create CommandPropsSound and check which asset to use\r\n\t\t\t\t\t\tobjectID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t// TODO: implement sound in timeline\r\n\t\t\t\t\t\t//commandString += \"\\n      - Add new Sound AWD-ID = \" + resourceID.toString() + \" as object_id = \" + objectID.toString();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t//commandString += \"\\n       - Unknown Command Type = \" + commandType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDepthChanges) {\r\n\t\t\t\t// only want to do this.awd_file_data once after all children's depth values are updated\r\n\t\t\t\t//frame.frameConstructCommands.push(new ApplyAS2DepthsCommand());\r\n\t\t\t\thasDepthChanges = false;\r\n\t\t\t}\r\n\r\n\t\t\tvar length_code = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tif (length_code > 0) {\r\n\t\t\t\t// TODO: Script should probably not be attached to keyframes?\r\n\t\t\t\t//var frame_code = this.awd_file_data.newBlockBytes.readUTFBytes(length_code);\r\n\t\t\t\t//frame.framePostConstructCommands.push(new ExecuteScriptCommand(frame_code));\r\n\t\t\t\t//traceString += \"\\nframe-code = \" + frame_code;\r\n\t\t\t}\r\n\t\t\t//traceString += commandString;\r\n\t\t\t//trace(\"length_code = \"+length_code+\" frame_code = \"+frame_code);\r\n\t\t\tthis.awd_file_data.newBlockBytes.readUnsignedInt();// user attributes - skip for now\r\n\t\t\t//console.log(traceString);\r\n\t\t\t//new_timeline.addFrame(frame);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = new_mc;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a TIMELINE: Name = \" + name + \"| isScene = \" + isScene + \"| sceneID = \" + sceneID + \"| numFrames = \" + numFrames);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MovieClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport PrefabBase\t\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\r\nimport PrimitiveCapsulePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab\");\r\nimport PrimitiveConePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveConePrefab\");\r\nimport PrimitiveCubePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\r\nimport PrimitiveCylinderPrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\r\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nimport PrimitiveSpherePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\r\nimport PrimitiveTorusPrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveTorusPrefab\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass PrefabAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar primType:number;\r\n\t\tvar subs_parsed:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar bsm:Matrix3D;\r\n\r\n\t\t// Read name and sub count\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tprimType = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tprops = this.awd_file_data.parseProperties({101:this.awd_file_data.geoNrType, 102:this.awd_file_data.geoNrType, 103:this.awd_file_data.geoNrType, 110:this.awd_file_data.geoNrType, 111:this.awd_file_data.geoNrType, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 303:AWD3Utils.UINT16, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL, 703:AWD3Utils.BOOL, 704:AWD3Utils.BOOL});\r\n\r\n\t\tvar primitiveTypes:Array<string> = [\"Unsupported Type-ID\", \"PrimitivePlanePrefab\", \"PrimitiveCubePrefab\", \"PrimitiveSpherePrefab\", \"PrimitiveCylinderPrefab\", \"PrimitivesConePrefab\", \"PrimitivesCapsulePrefab\", \"PrimitivesTorusPrefab\"]\r\n\r\n\t\tswitch (primType) {\r\n\t\t\t// to do, not all properties are set on all primitives\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tprefab = new PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tprefab = new PrimitiveCubePrefab(props.get(101, 100), props.get(102, 100), props.get(103, 100), props.get(301, 1), props.get(302, 1), props.get(303, 1), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tprefab = new PrimitiveSpherePrefab(props.get(101, 50), props.get(301, 16), props.get(302, 12), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tprefab = new PrimitiveCylinderPrefab(props.get(101, 50), props.get(102, 50), props.get(103, 100), props.get(301, 16), props.get(302, 1), true, true, true); // bool701, bool702, bool703, bool704);\r\n\t\t\t\tif (!props.get(701, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).topClosed = false;\r\n\t\t\t\tif (!props.get(702, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).bottomClosed = false;\r\n\t\t\t\tif (!props.get(703, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).yUp = false;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tprefab = new PrimitiveConePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 1), props.get(701, true), props.get(702, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tprefab = new PrimitiveCapsulePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 15), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tprefab = new PrimitiveTorusPrefab(props.get(101, 50), props.get(102, 50), props.get(301, 16), props.get(302, 8), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tprefab = new PrefabBase();\r\n\t\t\t\tconsole.log(\"ERROR: UNSUPPORTED PREFAB_TYPE\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif ((props.get(110, 1) != 1) || (props.get(111, 1) != 1)) {\r\n\t\t\t//geom.subGeometries;\r\n\t\t\t//geom.scaleUV(props.get(110, 1), props.get(111, 1)); //TODO add back scaling to prefabs\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = prefab;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tif ((primType < 0) || (primType > 7)) {\r\n\t\t\t\tprimType = 0;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Parsed a Primivite: Name = \" + this.awd_file_data.cur_block.name + \"| type = \" + primitiveTypes[primType]);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = PrefabAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\n\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport ShadowDitheredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod\");\r\nimport ShadowFilteredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod\");\r\nimport ShadowHardMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowHardMethod\");\r\nimport ShadowNearMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowNearMethod\");\r\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\n\r\nclass ShadowMethodAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar type:number;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:ShadowMethodBase;\r\n\t\tvar shadowLightID:number;\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tshadowLightID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar light:LightBase=<LightBase> this.awd_file_data.getAssetByID(shadowLightID);\r\n\r\n\t\tif (light==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the TargetLight (ID = \" + shadowLightID + \" ) for this.awd_file_data ShadowMethod - ShadowMethod not created\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tasset = this.parseShadowMethodList(light);\r\n\r\n\t\tif (!asset)\r\n\t\t\treturn;\r\n\t\tthis.awd_file_data.parseUserAttributes(); // Ignore for now\r\n\t\tthis.awd_file_data.cur_block.data = asset;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a ShadowMapMethodMethod: Name = \" + asset.name + \" | Type = \" + asset + \" | Light-Name = \", light.name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// this.awd_file_data functions reads and creates a ShadowMethodMethod\r\n\tprivate parseShadowMethodList(light:LightBase):ShadowMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar shadowMethod:ShadowMethodBase;\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 101:this.awd_file_data.propsNrType, 102:this.awd_file_data.propsNrType, 103:this.awd_file_data.propsNrType, 201:AWD3Utils.UINT32, 202:AWD3Utils.UINT32, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 401:AWD3Utils.UINT8, 402:AWD3Utils.UINT8, 601:AWD3Utils.COLOR, 602:AWD3Utils.COLOR, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL, 801:AWD3Utils.MTX4x4});\r\n\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>\r\n\t\tswitch (methodType) {\r\n\t\t\t//\t\t\t\tcase 1001: //CascadeShadowMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this.awd_file_data CascadeShadowMapMethod - ShadowMethod not created\");\r\n\t\t\t//\t\t\t\t\t\treturn shadowMethod;\r\n\t\t\t//\t\t\t\t\t}\r\n\t\t\t//\t\t\t\t\tshadowMethod = new CascadeShadowMapMethod(returnedArray[1]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 1002: //ShadowNearMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tvar shadow_meth:ShadowMapMethodBase = <ShadowMapMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\tif (shadow_meth==undefined) {\r\n\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this.awd_file_data ShadowNearMethod - ShadowMethod not created\");\r\n\t\t\t\t\treturn shadowMethod;\r\n\t\t\t\t}\r\n\t\t\t\tshadowMethod = new ShadowNearMethod(<ShadowMethodBase> shadow_meth);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1101: //ShadowFilteredMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowFilteredMethod(<DirectionalLight> light);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1102: //ShadowDitheredMethod\r\n\r\n\r\n\t\t\t\tshadowMethod = new ShadowDitheredMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1103: //ShadowSoftMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowSoftMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1104: //ShadowHardMethod\r\n\t\t\t\tshadowMethod = new ShadowHardMethod(light);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\treturn shadowMethod;\r\n\t}\r\n}\r\n\r\nexport = ShadowMethodAWDParser;",
    "import EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\n\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport EffectColorMatrixMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod\");\r\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\r\nimport EffectEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod\");\r\nimport EffectAlphaMaskMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod\");\r\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nimport EffectFresnelEnvMapMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod\");\r\nimport EffectLightMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectLightMapMethod\");\r\nimport EffectRimLightMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectRimLightMethod\");\r\n\r\nclass SharedMethodAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar asset:EffectMethodBase;\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tasset = this.parseSharedMethodList();\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = asset;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a EffectMethod: Name = \" + asset.name + \" Type = \" + asset);\r\n\t\t}\r\n\t}\r\n\r\n\t// this.awd_file_data functions reads and creates a EffectMethod\r\n\tprivate parseSharedMethodList():EffectMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar effectMethodReturn:EffectMethodBase;\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 101:this.awd_file_data.propsNrType, 102:this.awd_file_data.propsNrType, 103:this.awd_file_data.propsNrType, 104:this.awd_file_data.propsNrType, 105:this.awd_file_data.propsNrType, 106:this.awd_file_data.propsNrType, 107:this.awd_file_data.propsNrType, 201:AWD3Utils.UINT32, 202:AWD3Utils.UINT32, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 401:AWD3Utils.UINT8, 402:AWD3Utils.UINT8, 601:AWD3Utils.COLOR, 602:AWD3Utils.COLOR, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL});\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tswitch (methodType) {\r\n\t\t\t// Effect Methods\r\n\t\t\tcase 401: //ColorMatrix\r\n\t\t\t\teffectMethodReturn = new EffectColorMatrixMethod(props.get(101, new Array(0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 402: //ColorTransform\r\n\t\t\t\teffectMethodReturn = new EffectColorTransformMethod();\r\n\t\t\t\tvar offCol:number /*uint*/ = props.get(601, 0x00000000);\r\n\t\t\t\t(<EffectColorTransformMethod> effectMethodReturn).colorTransform = new ColorTransform(props.get(102, 1), props.get(103, 1), props.get(104, 1), props.get(101, 1), ((offCol >> 16) & 0xFF), ((offCol >> 8) & 0xFF), (offCol & 0xFF), ((offCol >> 24) & 0xFF));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 403: //EnvMap\r\n\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tconsole.log('ENV MAP', targetID);\r\n\r\n\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [ TextureBase.assetType ], \"CubeTexture\");\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data EnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectEnvMapMethod(<SingleCubeTexture> returnedArray[1], <number> props.get(101, 1));\r\n\t\t\t\ttargetID = props.get(2, 0);\r\n\t\t\t\tif (targetID > 0) {\r\n\t\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the Mask-texture (ID = \" + targetID + \" ) for this.awd_file_data EnvMapMethod\");\r\n\r\n\t\t\t\t\t// Todo: test mask with EnvMapMethod\r\n\t\t\t\t\t//(<EnvMapMethod> effectMethodReturn).mask = <Texture2DBase> returnedArray[1];\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\tcase 404: //LightMapMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this.awd_file_data LightMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectLightMapMethod(returnedArray[1], this.awd_file_data.getBlendModeStringFromEnum(props.get(401, 10))); //usesecondaryUV not set\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 405: //ProjectiveTextureMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureProjector.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the TextureProjector (ID = \" + targetID + \" ) for this.awd_file_data ProjectiveTextureMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new ProjectiveTextureMethod(returnedArray[1], blendModeDic[props.get(401, 10)]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 406: //RimLightMethod\r\n\t\t\t\teffectMethodReturn = new EffectRimLightMethod(props.get(601, 0xffffff), props.get(101, 0.4), props.get(101, 2)); //blendMode\r\n\t\t\t\tbreak;\r\n\t\t\tcase 407: //AlphaMaskMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the Alpha-texture (ID = \" + targetID + \" ) for this.awd_file_data AlphaMaskMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectAlphaMaskMethod(returnedArray[1], props.get(701, false));\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 408: //RefractionEnvMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data RefractionEnvMapMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new RefractionEnvMapMethod(returnedArray[1], props.get(101, 0.1), props.get(102, 0.01), props.get(103, 0.01), props.get(104, 0.01));\r\n\t\t\t//\t\t\t\t\tRefractionEnvMapMethod(effectMethodReturn).alpha = props.get(104, 1);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 409: //OutlineMethod\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new OutlineMethod(props.get(601, 0x00000000), props.get(101, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 410: //FresnelEnvMapMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data FresnelEnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectFresnelEnvMapMethod(returnedArray[1], props.get(101, 1));\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\tcase 411: //FogMethod\r\n\t\t\t\teffectMethodReturn = new EffectFogMethod(props.get(101, 0), props.get(102, 1000), props.get(601, 0x808080));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\treturn effectMethodReturn;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = SharedMethodAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Single2DTexture\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nclass Single2DTextureAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar asset:Single2DTexture;\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t//this.awd_file_data._texture_users[this.awd_file_data._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + textureStylesNames[type] + \" Bitmap for Texture\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = Single2DTextureAWDParser;",
    "import EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\n\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\n\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass SingleCubeTextureAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar data_len:number;\r\n\t\tvar i:number;\r\n\r\n\t\t//this.awd_file_data._cubeTextures = new Array<any>();\r\n\t\t//this.awd_file_data._texture_users[ this.awd_file_data._cur_block_id.toString() ] = [];\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\t//this.awd_file_data._blocks[blockID].name =\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\t//this.awd_file_data.texture_users[this.awd_file_data.cur_block_id.toString()] = [];\r\n\t\t\t//this.awd_file_data.cubeTextures.push(null);\r\n\r\n\t\t\t// External\r\n\t\t\tif (type == 0) {\r\n\t\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar url:string;\r\n\t\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\r\n\t\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\t\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block_id.toString() + \"#\" + i, new URLRequest(url), false, null, true);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar data:ByteArray;\r\n\t\t\t\tdata = new ByteArray();\r\n\r\n\t\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\t\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block_id.toString() + \"#\" + i, null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t//this.awd_file_data._pPauseAndRetrieveDependencies();\r\n\t\t//this.awd_file_data._blocks[blockID].data = asset;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing 6 \" + textureStylesNames[type] + \" Bitmaps for CubeTexture\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SingleCubeTextureAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass SkeletonAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar skeleton:Skeleton = new Skeleton();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Discard properties for now\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint:SkeletonJoint;\r\n\t\t\tvar ibp:Matrix3D;\r\n\t\t\t// Ignore joint id\r\n\t\t\tthis.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.parentIndex = this.awd_file_data.newBlockBytes.readUnsignedShort() - 1; // 0=null in AWD\r\n\t\t\tjoint.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\t\tibp = this.awd_file_data.parseMatrix3D();\r\n\t\t\tjoint.inverseBindPose = ibp.rawData;\r\n\t\t\t// Ignore joint props/attributes for now\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\tskeleton.joints.push(joint);\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\r\n\t\t// Discard attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = skeleton;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Skeleton: Name = \" + this.awd_file_data.cur_block.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\n\r\nclass SkeletonAnimClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar frame_dur:number;\r\n\t\tvar pose_addr:number /*uint*/;\r\n\t\tvar clip:SkeletonClipNode = new SkeletonClipNode();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tpose_addr = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tframe_dur = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tvar skel_pose:SkeletonPose = <SkeletonPose>this.awd_file_data.getAssetByID(pose_addr);\r\n\t\t\tif (skel_pose!=undefined) {\r\n\t\t\t\tclip.addFrame(skel_pose, frame_dur);\r\n\t\t\t}\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\t// Ignore attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = clip;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonClipNode: Name = \" + this.awd_file_data.cur_block.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonAnimClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass SkeletonPoseAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar pose:SkeletonPose = new SkeletonPose();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Ignore properties for now\r\n\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint_pose:JointPose;\r\n\t\t\tvar has_transform:number /*uint*/;\r\n\t\t\tjoint_pose = new JointPose();\r\n\t\t\thas_transform = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\tif (has_transform == 1) {\r\n\t\t\t\tvar mtx_data:Float32Array = this.awd_file_data.parseMatrix43RawData();\r\n\r\n\t\t\t\tvar mtx:Matrix3D = new Matrix3D(mtx_data);\r\n\t\t\t\tjoint_pose.orientation.fromMatrix(mtx);\r\n\t\t\t\tjoint_pose.translation.copyFrom(mtx.position);\r\n\r\n\t\t\t\tpose.jointPoses[joints_parsed] = joint_pose;\r\n\t\t\t}\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\t\t// Skip attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = pose;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonPose: Name = \" + this.awd_file_data.cur_block.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonPoseAWDParser;",
    "import EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\n\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\n\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass SkyboxAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar cubeTexAddr:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\tvar cube_tex:SingleCubeTexture = undefined;\r\n\t\tif(cubeTexAddr>0) {\r\n\t\t\tcube_tex = <SingleCubeTexture> this.awd_file_data.getAssetByID(cubeTexAddr);\r\n\t\t}\r\n\t\tif(cube_tex==undefined){\r\n\t\t\tcube_tex=<SingleCubeTexture>this.awd_file_data.getDefaultCubeTexture();\r\n\t\t}\r\n\t\t//if ((!returnedArrayCubeTex[0]) && (cubeTexAddr != 0))\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the Cubetexture (ID = \" + cubeTexAddr + \" ) for this.awd_file_data Skybox\");\r\n\t\tvar new_skybox:Skybox = new Skybox(<SingleCubeTexture> cube_tex);\r\n\r\n\t\tthis.awd_file_data.parseProperties(null)\r\n\t\tnew_skybox.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = new_skybox;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Skybox: Name = '\" + this.awd_file_data.cur_block.name + \"' | CubeTexture-Name = \" + cube_tex.name);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkyboxAWDParser;",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Font\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport TesselatedFontTable\t\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\n\r\nclass TesselatedFontAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar new_font:Font=new Font();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar font_style_cnt:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"Font font_style_cnt = \"+font_style_cnt);\r\n\t\tfor (var i:number = 0; i < font_style_cnt; ++i) {\r\n\t\t\tvar font_style_name:string = this.awd_file_data.parseVarStr();\r\n\t\t\t//console.log(\"Font font_style_name = \"+font_style_name);\r\n\t\t\tvar new_font_style:TesselatedFontTable=new_font.get_font_table(font_style_name);\r\n\t\t\tnew_font_style.set_font_em_size(this.awd_file_data.newBlockBytes.readUnsignedInt());\r\n\t\t\t//console.log(\"Font new_font_style.font_em_size = \"+new_font_style.get_font_em_size);\r\n\t\t\tvar font_style_char_cnt:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"Font font_style_char_cnt = \"+font_style_char_cnt);\r\n\t\t\tfor (var i:number = 0; i < font_style_char_cnt; ++i) {\r\n\r\n\t\t\t\tvar font_style_char:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"Font font_style_char = \"+font_style_char);\r\n\t\t\t\t// todo: this.awd_file_data is basically a simplified version of the subgeom-parsing done in parseTriangleGeometry. Make a parseSubGeom() instead (?)\r\n\t\t\t\tvar sm_len:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar sm_end:number = this.awd_file_data.newBlockBytes.position + sm_len;\r\n\t\t\t\t//console.log(\"Font sm_len = \"+sm_len);\r\n\r\n\t\t\t\t//this.awd_file_data.parseProperties(null); // no properties for font-table subgeos\r\n\t\t\t\t// Loop through data streams\r\n\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < sm_end) {\r\n\t\t\t\t\tvar idx:number = 0;\r\n\t\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t\t// Type, field type, length\r\n\t\t\t\t\tstr_type = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_ftype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\r\n\t\t\t\t\tif (str_type == 2) {//face indicies positions\r\n\t\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tindices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// x\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// y\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// type\r\n\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//this.awd_file_data.parseProperties(null);// no attributes for font-table subgeos\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(new AttributesBuffer());\r\n\t\t\t\tcurve_sub_geom.setIndices(indices);\r\n\t\t\t\tcurve_sub_geom.setPositions(positions);\r\n\t\t\t\tcurve_sub_geom.setCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.setUVs(uvs);\r\n\t\t\t\tnew_font_style.set_subgeo_for_char(font_style_char.toString(), curve_sub_geom);\r\n\t\t\t}\r\n\t\t\t//console.log(\"Parsed a font-table\");\r\n\r\n\t\t}\r\n\t\t//console.log(\"Parsed a font\");\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = new_font;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a font: Name = '\" + this.awd_file_data.cur_block.name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = TesselatedFontAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nimport TextFormat\t\t\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TextFieldType\t\t\t\t= require(\"awayjs-display/lib/text/TextFieldType\");\r\nimport View\t\t\t= require(\"awayjs-display/lib/containers/View\");\r\n\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\n\r\nclass TextfieldAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tprivate factory:AS2SceneGraphFactory;\r\n\tconstructor(view:View = null)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.factory = new AS2SceneGraphFactory(view);\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar newTextField = this.factory.createTextField();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar text_field_type:number=this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tif(text_field_type==0) {\r\n\t\t\tnewTextField.type = \"static\";\r\n\t\t}\r\n\t\telse if(text_field_type==1) {\r\n\t\t\tnewTextField.type = \"dynamic\";\r\n\t\t}\r\n\t\telse if(text_field_type==2) {\r\n\t\t\tnewTextField.type = \"input\";\r\n\t\t}\r\n\t\telse if(text_field_type==3) {\r\n\t\t\tnewTextField.type =\"input\";\r\n\t\t\tnewTextField.displayAsPassword=true;\r\n\t\t}\r\n\r\n\t\tnewTextField.width=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\tnewTextField.height=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\tvar num_paragraphs:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar complete_text:string = \"\";\r\n\t\t//console.log(\"num_paragraphs  '\" + num_paragraphs);\r\n\t\tvar text_format:TextFormat;\r\n\t\tfor(var paracnt:number=0; paracnt<num_paragraphs; paracnt++){\r\n\r\n\t\t\tvar num_textruns:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"num_textruns  '\" + num_textruns);\r\n\t\t\tfor(var textrun_cnt:number=0; textrun_cnt<num_textruns; textrun_cnt++) {\r\n\r\n\t\t\t\tvar format_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"format_id  '\" + format_id);\r\n\t\t\t\tvar textFormat:TextFormat = <TextFormat>this.awd_file_data.getAssetByID(format_id);\r\n\t\t\t\tif (textFormat==undefined) {\r\n\t\t\t\t\ttext_format = new TextFormat();\r\n\t\t\t\t}\r\n\t\t\t\t//console.log(\"text_format  '\" + text_format.name);\r\n\t\t\t\tvar txt_length = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"txt_length  '\" + txt_length);\r\n\t\t\t\tif (txt_length > 0) {\r\n\t\t\t\t\tvar this_txt:string = this.awd_file_data.newBlockBytes.readUTFBytes(txt_length);\r\n\t\t\t\t\t//newTextField.appendText(this_txt, text_format);\r\n\t\t\t\t\tcomplete_text+=this_txt;\r\n\t\t\t\t\t//console.log(\"this_txt  '\" + this_txt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//newTextField.closeParagraph();\r\n\t\t}\r\n\t\tnewTextField.textFormat=text_format;\r\n\t\tnewTextField.text=complete_text;\r\n\r\n\t\t//newTextField.construct_geometry();\r\n\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BOOL, 3:AWD3Utils.BOOL, 4:AWD3Utils.BOOL, 5:AWD3Utils.BOOL, 7:AWD3Utils.UINT8, 8:AWD3Utils.UINT8, 9:AWD3Utils.UINT8});\r\n\t\tnewTextField.selectable = props.get(1, false);\r\n\t\tnewTextField.border =  props.get(3, false);\r\n\t\t//newTextField.renderHTML =  props.get(4, false);\r\n\t\t//newTextField.scrollable =  props.get(5, false);\r\n\t\t//newTextField.text_flow =  props.get(7, 0);\r\n\t\t//newTextField.orientationMode =  props.get(8, 0);\r\n\t\t//newTextField.line_mode =  props.get(9, 0);\r\n\r\n\t\tnewTextField.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = newTextField;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TextField: Name = '\" + newTextField.name + \"| text  = \" + complete_text);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = TextfieldAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport TextFormat\t\t\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TesselatedFontTable\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport Font\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nclass TextformatAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar newTextFormat:TextFormat = new TextFormat();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\t//console.log(\"this.awd_file_data._blocks[blockID].name  '\" + this.awd_file_data._blocks[blockID].name );\r\n\t\tvar font_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"font_id  '\" + font_id);\r\n\t\tvar font_style_name:string = this.awd_file_data.parseVarStr();\r\n\t\t//console.log(\"font_style_name  '\" + font_style_name);\r\n\t\tvar font:Font = <Font>this.awd_file_data.getAssetByID(font_id);\r\n\t\tif (font==undefined) {\r\n\t\t\tfont = new Font();\r\n\t\t}\r\n\t\tnewTextFormat.font_name = font.name;\r\n\t\tvar font_table:TesselatedFontTable = font.get_font_table(font_style_name);\r\n\t\tif(font_table!=null){\r\n\t\t\tnewTextFormat.font_style = font_style_name;\r\n\t\t\tnewTextFormat.font_table = font_table;\r\n\t\t}\r\n\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"mat  '\" + data_id);\r\n\t\tvar mat:BasicMaterial = <BasicMaterial> this.awd_file_data.getAssetByID(data_id);\r\n\r\n\t\tif (mat==undefined) {\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\r\n\t\tvar num_uv_values:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t//console.log(\"num_uv_values  '\" + num_uv_values);\r\n\t\tvar uv_values:Array<number>=[];\r\n\t\tfor(var uvcnt:number=0; uvcnt<num_uv_values; uvcnt++){\r\n\t\t\tvar uv_value:number=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\tuv_values.push(uv_value);\r\n\t\t\t//console.log(\"uv_value  '\" + uv_value);\r\n\t\t}\r\n\t\tnewTextFormat.uv_values=uv_values;\r\n\t\tvar format_props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT16, 2:AWD3Utils.UINT16, 3:AWD3Utils.UINT8,4:AWD3Utils.UINT8,5:AWD3Utils.UINT8,6:AWD3Utils.UINT8, 7:AWD3Utils.UINT16, 8:AWD3Utils.UINT16, 9:AWD3Utils.UINT16, 10:AWD3Utils.UINT16});\r\n\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\t//newTextFormat.align = format_props.get(6,0);\r\n\t\tnewTextFormat.indent = format_props.get(7,0);\r\n\t\tnewTextFormat.leftMargin = format_props.get(8,0);\r\n\t\tnewTextFormat.rightMargin = format_props.get(9,0);\r\n\t\t//newTextFormat.linespacing = format_props.get(10,0);\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\tnewTextFormat.material = mat;\r\n\t\tthis.awd_file_data.parseUserAttributes();// textformat has no extra-properties\r\n\t\t//newTextFormat.extra =\r\n\r\n\t\tthis.awd_file_data.cur_block.data = newTextFormat;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TextFormat: Name = '\" + name + \" font: \"+font.name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = TextformatAWDParser;/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Short3Attributes\t\t\t\t\t= require(\"awayjs-core/lib/attributes/Short3Attributes\");\r\nimport EventDispatcher\t\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nclass VertexAnimClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar poseOnly:boolean=false;\r\n\t\tif(this.awd_file_data.cur_block.type==111){\r\n\t\t\tposeOnly=true\r\n\t\t}\r\n\t\tvar num_frames:number /*uint*/ = 1;\r\n\t\tvar num_submeshes:number /*uint*/;\r\n\t\tvar frames_parsed:number /*uint*/;\r\n\t\tvar subMeshParsed:number /*uint*/;\r\n\t\tvar frame_dur:number;\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\t\tvar z:number;\r\n\t\tvar str_len:number;\r\n\t\tvar str_end:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar idx:number /*int*/ = 0;\r\n\t\tvar indices:Short3Attributes;\r\n\t\tvar verts:Array<number>;\r\n\t\tvar num_Streams:number /*int*/ = 0;\r\n\t\tvar streamsParsed:number /*int*/ = 0;\r\n\t\tvar streamtypes:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar thisGeo:Geometry;\r\n\t\tvar clip:VertexClipNode = new VertexClipNode();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar geoAdress:number /*int*/ = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry = <Geometry>this.awd_file_data.getAssetByID(geoAdress);\r\n\t\tif (geom==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the target-Geometry-Object \" + geoAdress + \" ) for this.awd_file_data VertexClipNode\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar uvs:Array<Float32Array> = this.awd_file_data.getUVForVertexAnimation(geoAdress);\r\n\t\tif (!poseOnly)\r\n\t\t\tnum_frames = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tnum_submeshes = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tnum_Streams = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tstreamsParsed = 0;\r\n\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\tstreamtypes.push(this.awd_file_data.newBlockBytes.readUnsignedShort());\r\n\t\t\tstreamsParsed++;\r\n\t\t}\r\n\t\tprops = this.awd_file_data.parseProperties({1:AWD3Utils.BOOL, 2:AWD3Utils.BOOL});\r\n\r\n\t\tclip.looping = props.get(1, true);\r\n\t\tclip.stitchFinalFrame = props.get(2, false);\r\n\r\n\t\tframes_parsed = 0;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tframe_dur = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tsubMeshParsed = 0;\r\n\t\t\twhile (subMeshParsed < num_submeshes) {\r\n\t\t\t\tstreamsParsed = 0;\r\n\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\t\t\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\t\t\tif (streamtypes[streamsParsed] == 1) {\r\n\t\t\t\t\t\tindices = geom.subGeometries[subMeshParsed].indices;\r\n\t\t\t\t\t\tverts = new Array<number>();\r\n\t\t\t\t\t\tidx = 0;\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tx = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\t\ty = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\t\tz = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubGeom = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\t\t\t\tsubGeom.setIndices(indices);\r\n\t\t\t\t\t\tsubGeom.setPositions(verts);\r\n\t\t\t\t\t\tsubGeom.setUVs(uvs[subMeshParsed]);\r\n\t\t\t\t\t\tsubGeom.setNormals(null);\r\n\t\t\t\t\t\tsubGeom.setTangents(null);\r\n\t\t\t\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\t\t\t\tsubGeom.autoDeriveTangents = false;\r\n\t\t\t\t\t\tsubMeshParsed++;\r\n\t\t\t\t\t\tgeometry.addSubGeometry(subGeom)\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t\tstreamsParsed++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=clip;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a VertexClipNode: Name = \" + clip.name + \" | Target-Geometry-Name = \" + geom.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = VertexAnimClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\n\r\nclass VertexAnimationSetAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar poseBlockAdress:number /*int*/\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT16});\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar skeletonFrames:Array<SkeletonClipNode> = new Array<SkeletonClipNode>();\r\n\t\tvar vertexFrames:Array<VertexClipNode> = new Array<VertexClipNode>();\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tposeBlockAdress = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar animNode:AnimationNodeBase = <AnimationNodeBase>this.awd_file_data.getAssetByID(poseBlockAdress);\r\n\t\t\tif (animNode==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the AnimationClipNode Nr \" + frames_parsed + \" ( \" + poseBlockAdress + \" ) for this.awd_file_data AnimationSet\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (animNode instanceof VertexClipNode)\r\n\t\t\t\t\tvertexFrames.push(<VertexClipNode>animNode)\r\n\t\t\t\tif (animNode instanceof SkeletonClipNode)\r\n\t\t\t\t\tskeletonFrames.push(<SkeletonClipNode>animNode)\r\n\t\t\t}\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif ((vertexFrames.length == 0) && (skeletonFrames.length == 0)) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not create this.awd_file_data AnimationSet, because it contains no animations\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (vertexFrames.length > 0) {\r\n\t\t\tvar newVertexAnimationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\t\t\tfor (var i:number /*int*/ = 0; i < vertexFrames.length; i++)\r\n\t\t\t\tnewVertexAnimationSet.addAnimation(vertexFrames[i]);\r\n\t\t\tthis.awd_file_data.cur_block.data = newVertexAnimationSet;\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(\"Parsed a VertexAnimationSet: Name = \" + newVertexAnimationSet.name + \" | Animations = \" + newVertexAnimationSet.animations.length + \" | Animation-Names = \" + newVertexAnimationSet.animationNames.toString());\r\n\t\t\treturn;\r\n\t\t} else if (skeletonFrames.length > 0) {\r\n\t\t\tvar newSkeletonAnimationSet:SkeletonAnimationSet = new SkeletonAnimationSet(props.get(1, 4)); //props.get(1,4));\r\n\t\t\tfor (var i:number /*int*/ = 0; i < skeletonFrames.length; i++)\r\n\t\t\t\tnewSkeletonAnimationSet.addAnimation(skeletonFrames[i]);\r\n\t\t\tthis.awd_file_data.cur_block.data = newSkeletonAnimationSet;\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(\"Parsed a SkeletonAnimationSet: Name = \" + newSkeletonAnimationSet.name + \" | Animations = \" + newSkeletonAnimationSet.animations.length + \" | Animation-Names = \" + newSkeletonAnimationSet.animationNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = VertexAnimationSetAWDParser;",
    "import BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport BitmapImageCube\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImageCube\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\n\r\nimport AWDBitFlags\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWDBlock\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\n\r\n/**\r\n * AWD3FileData stores the data loaded for a AWD-file. It also gives access to some helper functions.\r\n */\r\nclass AWD3FileData\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\r\n\tprivate _cur_block:AWDBlock;\r\n\tprivate _blocks:Array<AWDBlock>;\r\n\tprivate _newBlockBytes:ByteArray;\r\n\r\n\tpublic  major_version:number;\r\n\tpublic  minor_version:number;\r\n\r\n\tprivate _accuracyOnBlocks:boolean = false;\r\n\r\n\tprivate _accuracyMatrix:boolean;\r\n\tprivate _accuracyGeo:boolean;\r\n\tprivate _accuracyProps:boolean;\r\n\tprivate _matrixNrType:number;\r\n\tprivate _geoNrType:number;\r\n\tprivate _propsNrType:number;\r\n\r\n\tprivate blendModeDic:Array<string>;\r\n\tprivate _depthSizeDic:Array<number>;\r\n\r\n\tprivate _defaultCubeTexture:SingleCubeTexture;\r\n\t/**\r\n\t * Creates a new AWD3FileData object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tthis.major_version=0;\r\n\t\tthis.minor_version=0;\r\n\r\n\t\tthis._blocks = new Array<AWDBlock>();\r\n\t\tthis._blocks.push(new AWDBlock(255, 0));\r\n\t\tthis._cur_block=this._blocks[0];\r\n\t\tthis.blendModeDic = new Array<string>(); // used to translate ints to blendMode-strings\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.ADD);\r\n\t\tthis.blendModeDic.push(BlendMode.ALPHA);\r\n\t\tthis.blendModeDic.push(BlendMode.DARKEN);\r\n\t\tthis.blendModeDic.push(BlendMode.DIFFERENCE);\r\n\t\tthis.blendModeDic.push(BlendMode.ERASE);\r\n\t\tthis.blendModeDic.push(BlendMode.HARDLIGHT);\r\n\t\tthis.blendModeDic.push(BlendMode.INVERT);\r\n\t\tthis.blendModeDic.push(BlendMode.LAYER);\r\n\t\tthis.blendModeDic.push(BlendMode.LIGHTEN);\r\n\t\tthis.blendModeDic.push(BlendMode.MULTIPLY);\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\t\tthis.blendModeDic.push(BlendMode.SCREEN);\r\n\t\tthis.blendModeDic.push(BlendMode.SHADER);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\r\n\t\tthis._depthSizeDic = new Array<number>(); // used to translate ints to depthSize-values\r\n\t\tthis._depthSizeDic.push(256);\r\n\t\tthis._depthSizeDic.push(512);\r\n\t\tthis._depthSizeDic.push(2048);\r\n\t\tthis._depthSizeDic.push(1024);\r\n\t}\r\n\r\n\tpublic getDepthSizeFromEnum(depthSize:number):number\r\n\t{\r\n\t\treturn this._depthSizeDic[depthSize];\r\n\t}\r\n\tpublic getBlendModeStringFromEnum(blendmode:number):string\r\n\t{\r\n\t\treturn this.blendModeDic[blendmode];\r\n\t}\r\n\r\n\tpublic dispose():void\r\n\t{\r\n\r\n\t\tfor (var c in this._blocks) {\r\n\r\n\t\t\tvar b:AWDBlock = <AWDBlock> this._blocks[ c ];\r\n\t\t\tb.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tpublic get accuracyOnBlocks():boolean\r\n\t{\r\n\t\treturn this._accuracyOnBlocks;\r\n\t}\r\n\tpublic get accuracyMatrix():boolean\r\n\t{\r\n\t\treturn this._accuracyMatrix;\r\n\t}\r\n\tpublic set accuracyMatrix(new_accuracyMatrix:boolean)\r\n\t{\r\n\t\tthis._accuracyMatrix = new_accuracyMatrix;\r\n\t}\r\n\tpublic get accuracyProps():boolean\r\n\t{\r\n\t\treturn this._accuracyProps;\r\n\t}\r\n\tpublic set accuracyProps(new_accuracyProps:boolean)\r\n\t{\r\n\t\tthis._accuracyProps = new_accuracyProps;\r\n\t}\r\n\tpublic set accuracyGeo(new_accuracyGeo:boolean)\r\n\t{\r\n\t\tthis._accuracyGeo = new_accuracyGeo;\r\n\t}\r\n\tpublic get accuracyGeo():boolean\r\n\t{\r\n\t\treturn this._accuracyGeo;\r\n\t}\r\n\tpublic get debug():boolean\r\n\t{\r\n\t\treturn this._debug;\r\n\t}\r\n\r\n\tpublic get matrixNrType():number\r\n\t{\r\n\t\treturn this._matrixNrType;\r\n\t}\r\n\tpublic set matrixNrType(newmatrixNrType:number)\r\n\t{\r\n\t\tthis._matrixNrType = newmatrixNrType;\r\n\t}\r\n\r\n\tpublic get propsNrType():number\r\n\t{\r\n\t\treturn this._propsNrType;\r\n\t}\r\n\tpublic set propsNrType(new_props_nr:number)\r\n\t{\r\n\t\tthis._propsNrType = new_props_nr;\r\n\t}\r\n\r\n\tpublic get geoNrType():number\r\n\t{\r\n\t\treturn this._geoNrType;\r\n\t}\r\n\tpublic set geoNrType(new_geoNrType:number)\r\n\t{\r\n\t\tthis._geoNrType = new_geoNrType;\r\n\t}\r\n\r\n\r\n\tpublic set newBlockBytes(new_newBlockBytes:ByteArray)\r\n\t{\r\n\t\tthis._newBlockBytes = new_newBlockBytes;\r\n\t}\r\n\tpublic get newBlockBytes():ByteArray\r\n\t{\r\n\t\treturn this._newBlockBytes;\r\n\t}\r\n\tpublic create_new_block(type:number, id:number)\r\n\t{\r\n\t\tvar new_block:AWDBlock= new AWDBlock(this._blocks.length, type);\r\n\t\tthis._cur_block=new_block;\r\n\t\tthis._blocks[id]=new_block;\r\n\t}\r\n\tpublic get cur_block():AWDBlock\r\n\t{\r\n\t\treturn this._cur_block;\r\n\t}\r\n\tpublic block_cnt():number\r\n\t{\r\n\t\treturn this._blocks.length;\r\n\t}\r\n\r\n\t//--Parser UTILS---------------------------------------------------------------------------\r\n\r\n\tpublic parseUserAttributes():Object\r\n\t{\r\n\t\tvar attributes:Object;\r\n\t\tvar list_len:number;\r\n\t\tvar attibuteCnt:number;\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tif (list_len > 0) {\r\n\r\n\t\t\tvar list_end:number;\r\n\r\n\t\t\tattributes = {};\r\n\r\n\t\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar ns_id:number;\r\n\t\t\t\tvar attr_key:string;\r\n\t\t\t\tvar attr_type:number;\r\n\t\t\t\tvar attr_len:number;\r\n\t\t\t\tvar attr_val:any;\r\n\r\n\t\t\t\t// TODO: Properly tend to namespaces in attributes\r\n\t\t\t\tns_id = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_key = this.parseVarStr();\r\n\t\t\t\tattr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + attr_len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading attribute # \" + attibuteCnt + \" = skipped to end of attribute-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (attr_type) {\r\n\t\t\t\t\tcase AWD3Utils.AWDSTRING:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUTFBytes(attr_len);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.BOOL:\r\n\t\t\t\t\tcase AWD3Utils.UINT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.UINT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.UINT32:\r\n\t\t\t\t\tcase AWD3Utils.BADDR:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.FLOAT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.FLOAT64:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readDouble();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tattr_val = 'unimplemented attribute type ' + attr_type;\r\n\t\t\t\t\t\tthis._newBlockBytes.position += attr_len;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"attribute = name: \" + attr_key + \"  / value = \" + attr_val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes[attr_key] = attr_val;\r\n\t\t\t\tattibuteCnt += 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\tpublic parseProperties(expected:Object):AWDProperties\r\n\t{\r\n\t\tvar list_end:number;\r\n\t\tvar list_len:number;\r\n\t\tvar propertyCnt:number = 0;\r\n\t\tvar props:AWDProperties = new AWDProperties();\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\tif (expected) {\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar len:number;\r\n\t\t\t\tvar key:number;\r\n\t\t\t\tvar type:number;\r\n\r\n\t\t\t\tkey = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\tlen = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading property # \" + propertyCnt + \" = skipped to end of propertie-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn props;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (expected.hasOwnProperty(key.toString())) {\r\n\t\t\t\t\ttype = expected[key];\r\n\t\t\t\t\tprops.set(key, this.parseAttrValue(type, len));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpropertyCnt += 1;\r\n\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\r\n\t}\r\n\r\n\tprivate parseAttrValue(type:number, len:number):any\r\n\t{\r\n\t\tvar elem_len:number;\r\n\t\tvar read_func:Function;\r\n\r\n\t\tswitch (type) {\r\n\r\n\t\t\tcase AWD3Utils.BOOL:\r\n\t\t\tcase AWD3Utils.INT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.INT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.INT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT32:\r\n\t\t\tcase AWD3Utils.COLOR:\r\n\t\t\tcase AWD3Utils.BADDR:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.FLOAT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.FLOAT64:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.AWDSTRING:\r\n\t\t\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\r\n\t\t\tcase AWD3Utils.VECTOR2x1:\r\n\t\t\tcase AWD3Utils.VECTOR3x1:\r\n\t\t\tcase AWD3Utils.VECTOR4x1:\r\n\t\t\tcase AWD3Utils.MTX3x2:\r\n\t\t\tcase AWD3Utils.MTX3x3:\r\n\t\t\tcase AWD3Utils.MTX4x3:\r\n\t\t\tcase AWD3Utils.MTX4x4:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif (elem_len < len) {\r\n\t\t\tvar list:Array<any> = [];\r\n\t\t\tvar num_read:number = 0;\r\n\t\t\tvar num_elems:number = len/elem_len;\r\n\r\n\t\t\twhile (num_read < num_elems) {\r\n\t\t\t\tlist.push(read_func.apply(this._newBlockBytes)); // list.push(read_func());\r\n\t\t\t\tnum_read++;\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t} else {\r\n\r\n\t\t\tvar val:any = read_func.apply(this._newBlockBytes);//read_func();\r\n\t\t\treturn val;\r\n\t\t}\r\n\t}\r\n\r\n\t// Helper - functions\r\n\tpublic getUVForVertexAnimation(meshID:number /*uint*/):Array<Float32Array>\r\n\t{\r\n\t\tif (this._blocks[meshID].data instanceof Mesh)\r\n\t\t\tmeshID = this._blocks[meshID].geoID;\r\n\t\tif (this._blocks[meshID].uvsForVertexAnimation)\r\n\t\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t\tvar geometry:Geometry = (<Geometry> this._blocks[meshID].data);\r\n\t\tvar geoCnt:number /*int*/ = 0;\r\n\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\tthis._blocks[meshID].uvsForVertexAnimation = new Array<Float32Array>();\r\n\t\twhile (geoCnt < geometry.subGeometries.length) {\r\n\t\t\tsub_geom = <TriangleSubGeometry> geometry.subGeometries[geoCnt];\r\n\t\t\tthis._blocks[meshID].uvsForVertexAnimation.push(sub_geom.uvs.get(sub_geom.numVertices));\r\n\t\t\tgeoCnt++;\r\n\t\t}\r\n\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t}\r\n\r\n\tpublic parseVarStr():string\r\n\t{\r\n\r\n\t\tvar len:number = this._newBlockBytes.readUnsignedShort();\r\n\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\t}\r\n\r\n\tpublic getBlockByID(assetID:number):AWDBlock\r\n\t{\r\n\t\treturn this._blocks[assetID];\r\n\t}\r\n\tpublic getAssetByID(assetID:number):IAsset\r\n\t{\r\n\t\treturn this._blocks[assetID].data;\r\n\t}\r\n\tprivate getDefaultAsset(assetType:string):IAsset\r\n\t{\r\n\t\tswitch (true) {\r\n\t\t\tcase (assetType == SingleCubeTexture.assetType):\r\n\t\t\t\treturn this.getDefaultCubeTexture();\r\n\t\t\t\tbreak;\r\n\t\t\tcase (assetType == Single2DTexture.assetType):\r\n\t\t\t\treturn DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\tbreak;\r\n\t\t\tcase (assetType == MethodMaterial.assetType):\r\n\t\t\t\treturn DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tpublic getDefaultCubeTexture():IAsset\r\n\t{\r\n\t\t/*\r\n\t\tif (!this._defaultCubeTexture) {\r\n\t\t\tvar defaultBitmap:BitmapImage2D = DefaultMaterialManager.createCheckeredBitmapImage2D();\r\n\r\n\t\t\tvar bitmapImageCube = new BitmapImageCube(defaultBitmap.width);\r\n\r\n\t\t\tfor (var i:number = 0; i < 6; i++)\r\n\t\t\t\tbitmapImageCube.draw(i, defaultBitmap);\r\n\r\n\r\n\t\t\tthis._defaultCubeTexture = new SingleCubeTexture(bitmapImageCube);\r\n\t\t\tthis._defaultCubeTexture.name = \"defaultCubeTexture\";\r\n\t\t}\r\n\t\t*/\r\n\t\treturn <IAsset> this._defaultCubeTexture;\r\n\t}\r\n\r\n\tpublic  readNumber(precision:boolean = false):number\r\n\t{\r\n\t\tif (precision)\r\n\t\t\treturn this._newBlockBytes.readDouble();\r\n\t\treturn this._newBlockBytes.readFloat();\r\n\r\n\t}\r\n\r\n\tpublic parseMatrix3D():Matrix3D\r\n\t{\r\n\t\treturn new Matrix3D(this.parseMatrix43RawData());\r\n\t}\r\n\r\n\tprivate parseMatrix32RawData():Array<number>\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(6);\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tmtx_raw[i] = this._newBlockBytes.readFloat();\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n\tpublic parseMatrix43RawData():Float32Array\r\n\t{\r\n\t\tvar mtx_raw:Float32Array = new Float32Array(16);\r\n\r\n\t\tmtx_raw[0] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[1] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[2] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[3] = 0.0;\r\n\t\tmtx_raw[4] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[5] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[6] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[7] = 0.0;\r\n\t\tmtx_raw[8] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[9] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[10] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[11] = 0.0;\r\n\t\tmtx_raw[12] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[13] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[14] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[15] = 1.0;\r\n\r\n\t\t//TODO: fix max exporter to remove NaN values in joint 0 inverse bind pose\r\n\r\n\t\tif (isNaN(mtx_raw[0])) {\r\n\t\t\tmtx_raw[0] = 1;\r\n\t\t\tmtx_raw[1] = 0;\r\n\t\t\tmtx_raw[2] = 0;\r\n\t\t\tmtx_raw[4] = 0;\r\n\t\t\tmtx_raw[5] = 1;\r\n\t\t\tmtx_raw[6] = 0;\r\n\t\t\tmtx_raw[8] = 0;\r\n\t\t\tmtx_raw[9] = 0;\r\n\t\t\tmtx_raw[10] = 1;\r\n\t\t\tmtx_raw[12] = 0;\r\n\t\t\tmtx_raw[13] = 0;\r\n\t\t\tmtx_raw[14] = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWD3FileData;\r\n\r\n\r\n\r\n",
    "\r\nclass AWD3Utils {\r\n\tpublic static BLOCKSTATE_FINALIZE:number = 0;\r\n\tpublic static BLOCKSTATE_INVALID:number = 1;\r\n\tpublic static BLOCKSTATE_LOAD_DEPENDENICES:number = 2;\r\n\tpublic static BLOCKSTATE_NO_ASSET:number = 3;\r\n\tpublic static COMPRESSIONMODE_LZMA:string = \"lzma\";\r\n\tpublic static UNCOMPRESSED:number = 0;\r\n\tpublic static DEFLATE:number = 1;\r\n\tpublic static LZMA:number = 2;\r\n\tpublic static INT8:number = 1;\r\n\tpublic static INT16:number = 2;\r\n\tpublic static INT32:number = 3;\r\n\tpublic static UINT8:number = 4;\r\n\tpublic static UINT16:number = 5;\r\n\tpublic static UINT32:number = 6;\r\n\tpublic static FLOAT32:number = 7;\r\n\tpublic static FLOAT64:number = 8;\r\n\tpublic static BOOL:number = 21;\r\n\tpublic static COLOR:number = 22;\r\n\tpublic static BADDR:number = 23;\r\n\tpublic static AWDSTRING:number = 31;\r\n\tpublic static AWDBYTEARRAY:number = 32;\r\n\tpublic static VECTOR2x1:number = 41;\r\n\tpublic static VECTOR3x1:number = 42;\r\n\tpublic static VECTOR4x1:number = 43;\r\n\tpublic static MTX3x2:number = 44;\r\n\tpublic static MTX3x3:number = 45;\r\n\tpublic static MTX4x3:number = 46;\r\n\tpublic static MTX4x4:number = 47;\r\n}\r\nexport = AWD3Utils;",
    "\r\n/**\r\n *\r\n */\r\nclass AWDBitFlags\r\n{\r\n\tpublic static FLAG1:number = 1;\r\n\tpublic static FLAG2:number = 2;\r\n\tpublic static FLAG3:number = 4;\r\n\tpublic static FLAG4:number = 8;\r\n\tpublic static FLAG5:number = 16;\r\n\tpublic static FLAG6:number = 32;\r\n\tpublic static FLAG7:number = 64;\r\n\tpublic static FLAG8:number = 128;\r\n\tpublic static FLAG9:number = 256;\r\n\tpublic static FLAG10:number = 512;\r\n\tpublic static FLAG11:number = 1024;\r\n\tpublic static FLAG12:number = 2048;\r\n\tpublic static FLAG13:number = 4096;\r\n\tpublic static FLAG14:number = 8192;\r\n\tpublic static FLAG15:number = 16384;\r\n\tpublic static FLAG16:number = 32768;\r\n\r\n\tpublic static test(flags:number, testFlag:number):boolean\r\n\t{\r\n\t\treturn (flags & testFlag) == testFlag;\r\n\t}\r\n}\r\nexport = AWDBitFlags;",
    "import ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass AWDBlock\r\n{\r\n\tpublic id:number;\r\n\tpublic name:string;\r\n\tpublic type:number;\r\n\tpublic data:any;\r\n\tpublic dependencies_data:Array<ByteArray>;\r\n\tpublic dependencies_urls:Array<string>;\r\n\tpublic loaded_dependencies:Array<any>;\r\n\tpublic loaded_dependencies_cnt:number;\r\n\tpublic len:number;\r\n\tpublic geoID:number;\r\n\tpublic state:number;\r\n\tpublic extras:Object;\r\n\tpublic bytes:ByteArray;\r\n\tpublic errorMessages:Array<string>;\r\n\tpublic uvsForVertexAnimation:Array<Float32Array>;\r\n\r\n\tconstructor(this_id:number, this_type:number)\r\n\t{\r\n\t\tthis.type=this_type;\r\n\t\tthis.id=this_id;\r\n\t\tthis.state = AWD3Utils.BLOCKSTATE_FINALIZE;\r\n\t\tthis.dependencies_data=Array<any>();\r\n\t\tthis.dependencies_urls=Array<string>();\r\n\t\tif(this_type==83){\r\n\t\t\tthis.loaded_dependencies=Array<any>(6);\r\n\t\t}\r\n\t\tthis.loaded_dependencies_cnt=0;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\r\n\t\tthis.id = null;\r\n\t\tthis.bytes = null;\r\n\t\tthis.errorMessages = null;\r\n\t\tthis.uvsForVertexAnimation = null;\r\n\r\n\t}\r\n\r\n\tpublic addError(errorMsg:string):void\r\n\t{\r\n\t\tif (!this.errorMessages)\r\n\t\t\tthis.errorMessages = new Array<string>();\r\n\r\n\t\tthis.errorMessages.push(errorMsg);\r\n\t}\r\n}\r\nexport = AWDBlock;",
    "\r\nclass AWDProperties\r\n{\r\n\tpublic set(key:number, value:any):void\r\n\t{\r\n\t\tthis[ key.toString() ] = value;\r\n\t}\r\n\r\n\tpublic get(key:number, fallback:any):any\r\n\t{\r\n\t\tif (this.hasOwnProperty(key.toString())) {\r\n\t\t\treturn this[key.toString()];\r\n\t\t} else {\r\n\t\t\treturn fallback;\r\n\t\t}\r\n\t}\r\n}\r\nexport = AWDProperties;",
    "import BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport BitmapImageCube\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImageCube\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\n\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\n\r\n\r\n\r\nimport AWDBitFlags\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport AWDAssetParsers\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers\");\r\nimport AWDBlock\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock\");\r\nimport AWD3FileData\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\n\r\n/**\r\n * AWD3Utils provides a parser for the AWD data type.\r\n */\r\nclass AWD3Parser extends ParserBase\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean = false;\r\n\tprivate _compression:number;\r\n\tprivate _streaming:boolean;\r\n\tprivate _parsed_header:boolean = false;\r\n\tprivate _body:ByteArray;\r\n\tprivate _awd_data:AWD3FileData;\r\n\tprivate _block_parser:AWDAssetParsers;\r\n\r\n\t// temp for checking stats\r\n\tpublic total_time:number = 0;\r\n\tpublic geom_time:number = 0;\r\n\tpublic timeline_time:number = 0;\r\n\r\n\t/**\r\n\t * Creates a new AWD3Utils object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(block_parser:AWDAssetParsers = undefined)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._block_parser=block_parser;\r\n\t\tif(this._block_parser==undefined){\r\n\t\t\tthis._block_parser=new AWDAssetParsers();\r\n\t\t}\r\n\t\tthis._awd_data=new AWD3FileData();\r\n\t\tthis._block_parser.init_parser(this._awd_data);\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"awd\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 3) == 'AWD');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// this will be called when Dependency has finished loading.\r\n\t\t// the ressource dependecniy has a id that point to the awd_block waiting for it.\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar this_block:AWDBlock = this._awd_data.getBlockByID(parseInt(resourceDependency.id));\r\n\t\t\tif(this_block.type==82){\r\n\t\t\t\tvar testure_asset:Single2DTexture = new Single2DTexture(<BitmapImage2D> resourceDependency.assets[0]);\r\n\t\t\t\tthis_block.data = testure_asset; // Store finished asset\r\n\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> testure_asset, this_block.name);\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap for texture\");\r\n\t\t\t\t\tconsole.log(\"Parsed texture: Name = \" + this_block.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==44){\r\n\t\t\t\t// todo: implement parsing of Audio block data\r\n\t\t\t\t/*\r\n\t\t\t\t var audio_asset:AudioAsset = <AudioAsset> resourceDependency.assets[0];\r\n\t\t\t\t this_block.data = audio_asset; // Store finished asset\r\n\t\t\t\t // Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t // previously suppressed while the dependency was loaded.\r\n\t\t\t\t this._pFinalizeAsset(<IAsset> audio_asset, this_block.name);\r\n\t\t\t\t */\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Sound into AudioAsset\");\r\n\t\t\t\t\tconsole.log(\"Loaded Sound: Name = \" + this_block.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==83){\r\n\t\t\t\tthis_block.loaded_dependencies[resourceDependency.sub_id]= resourceDependency.assets[0];\r\n\t\t\t\tthis_block.loaded_dependencies_cnt++;\r\n\t\t\t\tif(this_block.loaded_dependencies_cnt==6){\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap \" + resourceDependency.sub_id + \" / 6 for Cubetexture\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar cube_image_asset = new BitmapImageCube(this_block.loaded_dependencies[0].width);\r\n\r\n\t\t\t\t\tfor (var i:number = 0; i < 6; i++)\r\n\t\t\t\t\t\tcube_image_asset.draw(i, this_block.loaded_dependencies[i]);\r\n\r\n\r\n\t\t\t\t\tvar cube_tex_asset = new SingleCubeTexture(cube_image_asset);\r\n\t\t\t\t\tthis_block.data = cube_tex_asset; // Store finished asset\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> cube_tex_asset, this_block.name);\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Parsed CubeTexture: Name = \" + this_block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t//\tnot used - if a dependcy fails, the awaiting Texture or CubeTexture will never be finalized, and the default-bitmaps will be used.\r\n\t\t// \tthis means, that if one Bitmap of a CubeTexture fails, the CubeTexture will have the DefaultTexture applied for all six Bitmaps.\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a dependency name\r\n\t *\r\n\t * @param resourceDependency The dependency to be resolved.\r\n\t */\r\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\r\n\t{\r\n\t\tvar oldName:string = asset.name;\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar block:AWDBlock = this._awd_data.getBlockByID(parseInt(resourceDependency.id));\r\n\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t}\r\n\r\n\t\tvar newName:string = asset.name;\r\n\r\n\t\tasset.name = oldName;\r\n\r\n\t\treturn newName;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();//getByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\tif (!this._parsed_header) {\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Parse header and decompress body if needed\r\n\t\t\tthis.parseHeader();\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWD3Utils.DEFLATE:\r\n\t\t\t\tcase AWD3Utils.LZMA:\r\n\t\t\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase AWD3Utils.UNCOMPRESSED:\r\n\t\t\t\t\tthis._body = this._byteData;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// Compressed AWD Formats not yet supported\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t case AWD3Parserutils.DEFLATE:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress();\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t case AWD3Parserutils.LZMA:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress(COMPRESSIONMODE_LZMA);\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t //*/\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._parsed_header = true;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._body.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t}\r\n\r\n\t\tif (this._body) {\r\n\r\n\t\t\twhile (this._body.getBytesAvailable() > 0 && !this.parsingPaused) //&& this._pHasTime() )\r\n\t\t\t{\r\n\t\t\t\tthis.parseNextBlock();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Return complete status\r\n\t\t\tif (this._body.getBytesAvailable() == 0) {\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t\t} else {\r\n\t\t\t\treturn  ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWD3Utils.DEFLATE:\r\n\t\t\t\tcase AWD3Utils.LZMA:\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"(!) AWD3Utils Error: Compressed AWD formats not yet supported (!)\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\t// Error - most likely _body not set because we do not support compression.\r\n\t\t\treturn  ParserBase.PARSING_DONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate dispose():void\r\n\t{\r\n\t\tthis._awd_data.dispose();\r\n\t}\r\n\r\n\tprivate parseNextBlock():void\r\n\t{\r\n\t\tvar block_id:number = this._body.readUnsignedInt();\r\n\r\n\t\tvar ns:number = this._body.readUnsignedByte();\r\n\t\tvar block_type:number = this._body.readUnsignedByte();\r\n\t\tvar flags:number = this._body.readUnsignedByte();\r\n\t\tvar len:number = this._body.readUnsignedInt();\r\n\r\n\t\tvar blockCompression:boolean = AWDBitFlags.test(flags, AWDBitFlags.FLAG4);\r\n\t\tvar blockCompressionLZMA:boolean = AWDBitFlags.test(flags, AWDBitFlags.FLAG5);\r\n\r\n\t\tif (this._awd_data.accuracyOnBlocks) {\r\n\t\t\tthis._awd_data.accuracyMatrix = AWDBitFlags.test(flags, AWDBitFlags.FLAG1);\r\n\t\t\tthis._awd_data.accuracyGeo = AWDBitFlags.test(flags, AWDBitFlags.FLAG2);\r\n\t\t\tthis._awd_data.accuracyProps = AWDBitFlags.test(flags, AWDBitFlags.FLAG3);\r\n\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyGeo) {\r\n\t\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyMatrix) {\r\n\t\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyProps) {\r\n\t\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar blockEndAll:number = this._body.position + len;\r\n\r\n\t\tif (len > this._body.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 block length is bigger than the bytes that are available!');\r\n\t\t\tthis._body.position += this._body.getBytesAvailable();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar newBlockBytes:ByteArray = new ByteArray();\r\n\t\tthis._body.readBytes(newBlockBytes, 0, len);\r\n\t\tthis._awd_data.newBlockBytes = newBlockBytes;\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// Compressed AWD Formats not yet supported\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\r\n\t\t\t/*\r\n\t\t\t if (blockCompressionLZMA)\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress(AWD3Parserutils.COMPRESSIONMODE_LZMA);\r\n\t\t\t }\r\n\t\t\t else\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress();\r\n\t\t\t }\r\n\t\t\t */\r\n\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t//this._newBlockBytes.endian = Endian.LITTLE_ENDIAN;\r\n\t\t//----------------------------------------------------------------------------\r\n\r\n\t\tthis._awd_data.newBlockBytes.position = 0;\r\n\r\n\t\t// we create AWDBlock for all exept the metadata. the metadata block has is the first awdblock in the list by default.\r\n\t\t//if(block_type!=255)\r\n\t\tthis._awd_data.create_new_block(block_type, block_id);\r\n\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t//blockEndBlock   = this._newBlockBytes.position + this._newBlockBytes.length;\r\n\t\t\t//block.len       = blockEndBlock;\r\n\t\t}\r\n\r\n\t\t//if (this._debug) {\r\n\t\t\tconsole.log(\"AWDBlock:  ID = \" + block_id + \" | TypeID = \" + block_type + \" | Compression = \" + blockCompression + \" | Matrix-Precision = \" + this._awd_data.accuracyMatrix + \" | Geometry-Precision = \" + this._awd_data.accuracyGeo + \" | Properties-Precision = \" + this._awd_data.accuracyProps);\r\n\t\t//}\r\n\r\n\t\tvar time_start = performance.now();\r\n\r\n\t\t// first check if the block is any of the 3 blocks that does not produce a asset.\r\n\t\t\t// this block contains a asset.\r\n\t\tif(this._block_parser.parseAsset(block_type)){\r\n\t\t\tif(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_FINALIZE){\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset>this._awd_data.cur_block.data, this._awd_data.cur_block.name);\r\n\t\t\t\tif(this._awd_data.cur_block.data instanceof DisplayObject){\r\n\t\t\t\t\tif((<DisplayObjectContainer> this._awd_data.cur_block.data).parent==undefined){\r\n\t\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild((<DisplayObjectContainer> this._awd_data.cur_block.data));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_INVALID){\r\n\t\t\t\tconsole.log(\"ERROR while parsing block - type = \", block_type, \" id = \", block_id);\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES){\r\n\t\t\t\t// trigger No asset created yet, because the block has dependencies. load the dependencies:.\r\n\t\t\t\tfor(var r:number=0; r<this._awd_data.cur_block.dependencies_urls.length;r++){\r\n\t\t\t\t\t// load dependencies by url. let the parser system decide how to parse it\r\n\t\t\t\t\tthis._pAddDependency(this._awd_data.cur_block.id.toString(), new URLRequest(this._awd_data.cur_block.dependencies_urls[r]), false, null, true, r);\r\n\t\t\t\t}\r\n\t\t\t\tfor(var r:number=0; r<this._awd_data.cur_block.dependencies_data.length;r++) {\r\n\t\t\t\t\t// load dependencies from data. need to prepare the data based on block_type (image vs audio).\r\n\t\t\t\t\tif ((block_type == 82) || (block_type == 83)) {\r\n\t\t\t\t\t\tthis._pAddDependency(this._awd_data.cur_block.id.toString(), null, false, ParserUtils.byteArrayToImage(this._awd_data.cur_block.dependencies_data[r]), true, r);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (block_type == 44) {\r\n\t\t\t\t\t\t// todo: parse audio data\r\n\t\t\t\t\t\t// this._pAddDependency(this._awd_data.cur_block.id.toString(), null, false, this._awd_data.cur_block.dependencies_data[r], true, r);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_NO_ASSET){\r\n\t\t\t\t// this block does not produce any asset (metadata, namespace, command)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"Encountered unknown blocktype - type = \", block_type, \" id = \", block_id);\r\n\t\t}\r\n\r\n\t\tvar time_end = performance.now();\r\n\t\tvar thisTime:number=time_end-time_start;\r\n\t\tthis.total_time+=thisTime;\r\n\t\tif(block_type==1){\r\n\t\t\tthis.geom_time+=thisTime;\r\n\t\t}\r\n\t\telse if(block_type==133){\r\n\t\t\tthis.timeline_time+=thisTime;\r\n\t\t}\r\n\t\tconsole.log(\"'parsed '\"+block_type+\"'  block in \"+thisTime+ \" ms\", \" total: \",this.total_time,\" geom: \",this.geom_time,\"timelines:\",this.timeline_time);\r\n\r\n\t\tthis._body.position = blockEndAll;\r\n\t\tthis._awd_data.newBlockBytes = null;\r\n\r\n\t}\r\n\r\n\r\n\r\n\r\n\tprivate parseHeader():void\r\n\t{\r\n\t\tvar flags:number;\r\n\t\tvar body_len:number;\r\n\r\n\t\tthis._byteData.position = 3; // Skip magic string and parse version\r\n\r\n\t\tthis._awd_data.major_version = this._byteData.readUnsignedByte();\r\n\t\tthis._awd_data.minor_version = this._byteData.readUnsignedByte();\r\n\r\n\t\tflags = this._byteData.readUnsignedShort(); // Parse bit flags\r\n\r\n\t\tthis._streaming = AWDBitFlags.test(flags, AWDBitFlags.FLAG1);\r\n\r\n\t\tif ((this._awd_data.major_version == 2) && (this._awd_data.minor_version == 1)) {\r\n\t\t\tthis._awd_data.accuracyMatrix = AWDBitFlags.test(flags, AWDBitFlags.FLAG2);\r\n\t\t\tthis._awd_data.accuracyGeo = AWDBitFlags.test(flags, AWDBitFlags.FLAG3);\r\n\t\t\tthis._awd_data.accuracyProps = AWDBitFlags.test(flags, AWDBitFlags.FLAG4);\r\n\t\t}\r\n\r\n\t\t// if we set _accuracyOnBlocks, the precision-values are read from each block-header.\r\n\r\n\t\t// set storagePrecision types\r\n\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyGeo) {\r\n\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyMatrix) {\r\n\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyProps) {\r\n\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._compression = this._byteData.readUnsignedByte(); // compression\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Import AWDFile of version = \" + this._awd_data.major_version + \" - \" + this._awd_data.minor_version );\r\n\t\t\tconsole.log(\"Global Settings = Compression = \" + this._compression + \" | Streaming = \" + this._streaming + \" | Matrix-Precision = \" + this._awd_data.accuracyMatrix + \" | Geometry-Precision = \" + this._awd_data.accuracyGeo + \" | Properties-Precision = \" + this._awd_data.accuracyProps);\r\n\t\t}\r\n\r\n\t\t// Check file integrity\r\n\t\tbody_len = this._byteData.readUnsignedInt();\r\n\t\tif (!this._streaming && body_len != this._byteData.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 body length does not match header integrity field');\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = AWD3Parser;\r\n\r\n",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Short3Attributes\t\t\t\t\t= require(\"awayjs-core/lib/attributes/Short3Attributes\");\r\nimport Float3Attributes\t\t\t\t\t= require(\"awayjs-core/lib/attributes/Float3Attributes\");\r\nimport Float2Attributes\t\t\t\t\t= require(\"awayjs-core/lib/attributes/Float2Attributes\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport BitmapImageCube\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImageCube\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport WaveAudio\t\t\t\t\t\t= require(\"awayjs-core/lib/data/WaveAudio\");\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ProjectionBase\t\t\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\r\nimport PerspectiveProjection\t\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\r\nimport OrthographicProjection\t\t\t= require(\"awayjs-core/lib/projections/OrthographicProjection\");\r\nimport OrthographicOffCenterProjection\t= require(\"awayjs-core/lib/projections/OrthographicOffCenterProjection\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport View\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport TextField\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/TextField\");\r\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nimport CubeMapShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\r\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\r\nimport ShadowMapperBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\n\r\nimport PrefabBase\t\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\r\nimport PrimitivePrefabBase\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePrefabBase\");\r\nimport PrimitiveCapsulePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab\");\r\nimport PrimitiveConePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveConePrefab\");\r\nimport PrimitiveCubePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\r\nimport PrimitiveCylinderPrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\r\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nimport PrimitiveSpherePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\r\nimport PrimitiveTorusPrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveTorusPrefab\");\r\nimport SingleCubeTexture\t\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\n\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport AmbientEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod\");\r\nimport DiffuseDepthMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod\");\r\nimport DiffuseCelMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCelMethod\");\r\nimport DiffuseGradientMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod\");\r\nimport DiffuseLightMapMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod\");\r\nimport DiffuseWrapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod\");\r\nimport EffectAlphaMaskMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod\");\r\nimport EffectColorMatrixMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod\");\r\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\r\nimport EffectEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod\");\r\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nimport EffectFresnelEnvMapMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod\");\r\nimport EffectLightMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectLightMapMethod\");\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport EffectRimLightMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectRimLightMethod\");\r\nimport NormalSimpleWaterMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod\");\r\nimport ShadowDitheredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod\");\r\nimport ShadowFilteredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod\");\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport SpecularFresnelMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod\");\r\nimport ShadowHardMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowHardMethod\");\r\nimport SpecularAnisotropicMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod\");\r\nimport SpecularCelMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCelMethod\");\r\nimport SpecularPhongMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularPhongMethod\");\r\nimport ShadowNearMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowNearMethod\");\r\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\n\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport ITimelineSceneGraphFactory \t= require(\"awayjs-display/lib/factories/ITimelineSceneGraphFactory\");\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\nimport MovieClip \t\t\t\t\t= require(\"awayjs-display/lib/entities/MovieClip\");\r\nimport Timeline\t\t\t \t\t\t= require(\"awayjs-display/lib/base/Timeline\");\r\n\r\n\r\nimport AssetLibrary\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetLibrary\");\r\n\r\nimport Font\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport TesselatedFontTable\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport TextFormat\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TextFieldType\t\t\t= require(\"awayjs-display/lib/text/TextFieldType\");\r\n\r\nimport AWDBlock\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock\");\r\n/**\r\n * AWDParser provides a parser for the AWD data type.\r\n */\r\nclass AWDParser extends ParserBase\r\n{\r\n\tprivate _view:View;\r\n\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\tprivate _debugTimers:boolean = true;\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean = false;\r\n\tprivate _cur_block_id:number;\r\n\tprivate _blocks:Array<AWDBlock>;\r\n\tprivate _newBlockBytes:ByteArray;\r\n\tprivate _version:Array<number>;\r\n\tprivate _compression:number;\r\n\tprivate _accuracyOnBlocks:boolean;\r\n\tprivate _accuracyMatrix:boolean;\r\n\tprivate _accuracyGeo:boolean;\r\n\tprivate _accuracyProps:boolean;\r\n\tprivate _streaming:boolean;\r\n\tprivate _texture_users:Object = {};\r\n\tprivate _parsed_header:boolean = false;\r\n\tprivate _body:ByteArray;\r\n\r\n\r\n\tpublic static COMPRESSIONMODE_LZMA:string = \"lzma\";\r\n\tpublic static UNCOMPRESSED:number = 0;\r\n\tpublic static DEFLATE:number = 1;\r\n\tpublic static LZMA:number = 2;\r\n\tpublic static INT8:number = 1;\r\n\tpublic static INT16:number = 2;\r\n\tpublic static INT32:number = 3;\r\n\tpublic static UINT8:number = 4;\r\n\tpublic static UINT16:number = 5;\r\n\tpublic static UINT32:number = 6;\r\n\tpublic static FLOAT32:number = 7;\r\n\tpublic static FLOAT64:number = 8;\r\n\tpublic static BOOL:number = 21;\r\n\tpublic static COLOR:number = 22;\r\n\tpublic static BADDR:number = 23;\r\n\tpublic static AWDSTRING:number = 31;\r\n\tpublic static AWDBYTEARRAY:number = 32;\r\n\tpublic static VECTOR2x1:number = 41;\r\n\tpublic static VECTOR3x1:number = 42;\r\n\tpublic static VECTOR4x1:number = 43;\r\n\tpublic static MTX3x2:number = 44;\r\n\tpublic static MTX3x3:number = 45;\r\n\tpublic static MTX4x3:number = 46;\r\n\tpublic static MTX4x4:number = 47;\r\n\tpublic static GEO_NUMBER:number = 48;\r\n\tpublic static MATRIX_NUMBER:number = 49;\r\n\tpublic static PROPERTY_NUMBER:number = 50;\r\n\t\r\n\r\n\tprivate blendModeDic:Array<string>;\r\n\tprivate _depthSizeDic:Array<number>;\r\n\r\n\tprivate start_timeing:number;\r\n\tprivate _time_all:number=0;\r\n\tprivate _time_geom:number=0;\r\n\tprivate _time_geom_bytes:number=0;\r\n\tprivate _time_timeline:number=0;\r\n\tprivate _time_fonts:number=0;\r\n\tprivate _time_textfields:number=0;\r\n\tprivate _time_sounds:number=0;\r\n\tprivate _time_textures:number=0;\r\n\tprivate _time_materials:number=0;\r\n\tprivate _time_meshes:number=0;\r\n\tprivate _num_geom:number=0;\r\n\tprivate _num_timeline:number=0;\r\n\tprivate _num_fonts:number=0;\r\n\tprivate _num_textfields:number=0;\r\n\tprivate _num_sounds:number=0;\r\n\tprivate _num_textures:number=0;\r\n\tprivate _num_materials:number=0;\r\n\tprivate _num_meshes:number=0;\r\n\r\n\r\n\t/**\r\n\t * Creates a new AWD3Parserutils object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(view:View = null)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._view = view;\r\n\t\tthis._blocks = new Array<AWDBlock>();\r\n\t\tthis._blocks[0] = new AWDBlock(0,255);\r\n\t\tthis._blocks[0].data = null; // Zero address means null in AWD\r\n\r\n\t\tthis.blendModeDic = new Array<string>(); // used to translate ints to blendMode-strings\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.ADD);\r\n\t\tthis.blendModeDic.push(BlendMode.ALPHA);\r\n\t\tthis.blendModeDic.push(BlendMode.DARKEN);\r\n\t\tthis.blendModeDic.push(BlendMode.DIFFERENCE);\r\n\t\tthis.blendModeDic.push(BlendMode.ERASE);\r\n\t\tthis.blendModeDic.push(BlendMode.HARDLIGHT);\r\n\t\tthis.blendModeDic.push(BlendMode.INVERT);\r\n\t\tthis.blendModeDic.push(BlendMode.LAYER);\r\n\t\tthis.blendModeDic.push(BlendMode.LIGHTEN);\r\n\t\tthis.blendModeDic.push(BlendMode.MULTIPLY);\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\t\tthis.blendModeDic.push(BlendMode.SCREEN);\r\n\t\tthis.blendModeDic.push(BlendMode.SHADER);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\r\n\t\tthis._depthSizeDic = new Array<number>(); // used to translate ints to depthSize-values\r\n\t\tthis._depthSizeDic.push(256);\r\n\t\tthis._depthSizeDic.push(512);\r\n\t\tthis._depthSizeDic.push(2048);\r\n\t\tthis._depthSizeDic.push(1024);\r\n\t\tthis._version = Array<number>(); // will contain 2 int (major-version, minor-version) for awd-version-check\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"awd\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 3) == 'AWD');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// this will be called when Dependency has finished loading.\r\n\t\t// the ressource dependecniy has a id that point to the awd_block waiting for it.\r\n\t\t//console.log(\"AWDParser resolve dependencies\");\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar this_block:AWDBlock = this._blocks[parseInt(resourceDependency.id)];\r\n\t\t\tif(this_block.type==82){\r\n\t\t\t\tvar texture_asset:Single2DTexture = new Single2DTexture(<BitmapImage2D> resourceDependency.assets[0]);\r\n\t\t\t\tthis_block.data = texture_asset; // Store finished asset\r\n\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> texture_asset, this_block.name);\r\n\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed Texture: Name = \" + this_block.name);\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==44){\r\n\t\t\t\tvar audio_asset:WaveAudio = <WaveAudio> resourceDependency.assets[0];\r\n\t\t\t\tthis_block.data = audio_asset; // Store finished asset\r\n\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\t//console.log(\"Parsing audio \" + this_block.name);\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> audio_asset, this_block.name);\r\n\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed WaveAudio: Name = \" + this_block.name);\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==83){\r\n\t\t\t\tthis_block.loaded_dependencies[resourceDependency.sub_id]= resourceDependency.assets[0];\r\n\t\t\t\tthis_block.loaded_dependencies_cnt++;\r\n\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap \" + resourceDependency.sub_id + \" / 6 for Cubetexture\");\r\n\r\n\t\t\t\tif(this_block.loaded_dependencies_cnt==6){\r\n\t\t\t\t\tvar cube_image_asset = new BitmapImageCube(this_block.loaded_dependencies[0].width);\r\n\r\n\t\t\t\t\tfor (var i:number = 0; i < 6; i++)\r\n\t\t\t\t\t\tcube_image_asset.draw(i, this_block.loaded_dependencies[i]);\r\n\r\n\t\t\t\t\tvar cube_tex_asset = new SingleCubeTexture(cube_image_asset);\r\n\t\t\t\t\tthis_block.data = cube_tex_asset; // Store finished asset\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> cube_tex_asset, this_block.name);\r\n\r\n\t\t\t\t\tif (this._debug)\r\n\t\t\t\t\t\tconsole.log(\"Parsed CubeTexture: Name = \" + this_block.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._debugTimers && !this._isParsing)\r\n\t\t\t\tthis.updateTimers(this_block.type);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t//not used - if a dependcy fails, the awaiting Texture or CubeTexture will never be finalized, and the default-bitmaps will be used.\r\n\t\t// this means, that if one Bitmap of a CubeTexture fails, the CubeTexture will have the DefaultTexture applied for all six Bitmaps.\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a dependency name\r\n\t *\r\n\t * @param resourceDependency The dependency to be resolved.\r\n\t */\r\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\r\n\t{\r\n\t\tvar oldName:string = asset.name;\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar block:AWDBlock = this._blocks[parseInt(resourceDependency.id)];\r\n\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t}\r\n\r\n\t\tvar newName:string = asset.name;\r\n\r\n\t\tasset.name = oldName;\r\n\r\n\t\treturn newName;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();//getByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\tif (!this._parsed_header) {\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Parse header and decompress body if needed\r\n\t\t\tthis.parseHeader();\r\n\r\n\t\t\tswitch (this._compression) {\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\t\t\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase AWDParser.UNCOMPRESSED:\r\n\t\t\t\t\tthis._body = this._byteData;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// Compressed AWD Formats not yet supported\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t case AWD3Parserutils.DEFLATE:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress();\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t case AWD3Parserutils.LZMA:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress(COMPRESSIONMODE_LZMA);\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t //*/\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._parsed_header = true;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._body.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t}\r\n\r\n\t\tif (this._body) {\r\n\t\t\twhile (this._body.getBytesAvailable() > 0 && !this.parsingPaused) //&& this._pHasTime() )\r\n\t\t\t\tthis.parseNextBlock();\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Return complete status\r\n\t\t\tif (this._body.getBytesAvailable() == 0) {\r\n\t\t\t\tthis.dispose();\r\n\r\n\t\t\t\tif (this._debugTimers)\r\n\t\t\t\t\tconsole.log(\"Parsing total: \"+(this._time_all | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | geoms: \"+this._num_geom+\", \"+(this._time_geom | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | geoms bytes: \"+this._num_geom+\", \"+(this._time_geom_bytes | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | timelines: \"+this._num_timeline+\", \"+(this._time_timeline | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | fonts: \"+this._num_fonts+\", \"+(this._time_fonts | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | sounds: \"+this._num_sounds+\", \"+(this._time_sounds | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | mats: \"+this._num_materials+\", \"+(this._time_materials | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | textures: \"+this._num_textures+\", \"+(this._time_textures | 0)+\"ms\",\r\n\t\t\t\t\t\t\" | meshes: \"+this._num_meshes+\", \"+(this._time_meshes | 0)+\"ms\");\r\n\r\n\t\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t\t} else {\r\n\t\t\t\treturn  ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tswitch (this._compression) {\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\t\t\t\t\tif (this._debug)\r\n\t\t\t\t\t\tconsole.log(\"(!) AWDParser Error: Compressed AWD formats not yet supported (!)\");\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// Error - most likely _body not set because we do not support compression.\r\n\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\t}\r\n\r\n\tprivate dispose()\r\n\t{\r\n\t\tfor (var c in this._blocks) {\r\n\t\t\tvar b:AWDBlock = <AWDBlock> this._blocks[c];\r\n\t\t\tb.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseNextBlock()\r\n\t{\r\n\t\tvar block:AWDBlock;\r\n\t\tvar isParsed:boolean = false;\r\n\t\tvar ns:number;\r\n\t\tvar type:number;\r\n\t\tvar flags:number;\r\n\t\tvar len:number;\r\n//*\r\n\t\tif (this._debugTimers)\r\n\t\t\tthis.start_timeing = performance.now();\r\n//*/\r\n\t\tthis._cur_block_id = this._body.readUnsignedInt();\r\n\r\n\t\tns = this._body.readUnsignedByte();\r\n\t\ttype = this._body.readUnsignedByte();\r\n\t\tflags = this._body.readUnsignedByte();\r\n\t\tlen = this._body.readUnsignedInt();\r\n\r\n\t\tvar blockCompression:boolean = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\tvar blockCompressionLZMA:boolean = BitFlags.test(flags, BitFlags.FLAG5);\r\n\r\n\t\tif (this._accuracyOnBlocks) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG1);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t}\r\n\r\n\t\tvar blockEndAll:number = this._body.position + len;\r\n\r\n\t\tif (len > this._body.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 block length is bigger than the bytes that are available!');\r\n\t\t\tthis._body.position += this._body.getBytesAvailable();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// Compressed AWD Formats not yet supported\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\tthis._newBlockBytes = new ByteArray();\r\n\t\t\tthis._body.readBytes(this._newBlockBytes, 0, len);\r\n\t\t\tthis._newBlockBytes.position = 0;\r\n\t\t\t/*\r\n\t\t\t if (blockCompressionLZMA)\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress(AWD3Parserutils.COMPRESSIONMODE_LZMA);\r\n\t\t\t }\r\n\t\t\t else\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress();\r\n\t\t\t }\r\n\t\t\t */\r\n\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes = this._body;\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t//this._newBlockBytes.endian = Endian.LITTLE_ENDIAN;\r\n\t\t//----------------------------------------------------------------------------\r\n\r\n\t\tblock = new AWDBlock(this._cur_block_id, type);\r\n\t\tblock.len = len;\r\n\t\tvar blockEndBlock:number = this._newBlockBytes.position + len;\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t//blockEndBlock   = this._newBlockBytes.position + this._newBlockBytes.length;\r\n\t\t\t//block.len       = blockEndBlock;\r\n\t\t}\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"AWDBlock:  ID = \" + this._cur_block_id + \" | TypeID = \" + type + \" | Compression = \" + blockCompression + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\r\n\t\tthis._blocks[this._cur_block_id] = block;\r\n\r\n\t\tif ((this._version[0] == 3) && (this._version[1] == 0)) {\r\n\t\t\t// probably should contain some info about the type of animation\r\n\t\t\tvar factory = new AS2SceneGraphFactory(this._view);\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 24:\r\n\t\t\t\t\tthis.parseMeshLibraryBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 25:\r\n\t\t\t\t\tthis.parseBillBoardLibraryBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4444:\r\n\t\t\t\t\tthis.parseAudioBlock(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 133:\r\n\t\t\t\t\tthis.parseTimeLine(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 134:\r\n\t\t\t\t\tthis.paresTextField(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 135:\r\n\t\t\t\t\tthis.parseTesselatedFont(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 136:\r\n\t\t\t\t\tthis.parseTextFormat(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((this._version[0] > 2)||((this._version[0] >= 2) && (this._version[1] >= 1))) {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\tthis.parsePrimitves(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 31:\r\n\t\t\t\t\tthis.parseSkyboxInstance(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 41:\r\n\t\t\t\t\tthis.parseLight(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 42:\r\n\t\t\t\t\tthis.parseCamera(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//  case 43:\r\n\t\t\t\t//      parseTextureProjector(_cur_block_id);\r\n\t\t\t\t//      isParsed = true;\r\n\t\t\t\t//      break;\r\n\r\n\t\t\t\tcase 51:\r\n\t\t\t\t\tthis.parseLightPicker(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial_v1(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 83:\r\n\t\t\t\t\tthis.parseCubeTexture(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 91:\r\n\t\t\t\t\tthis.parseSharedMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 92:\r\n\t\t\t\t\tthis.parseShadowMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 111:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id, true);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 112:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 113:\r\n\t\t\t\t\tthis.parseVertexAnimationSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 122:\r\n\t\t\t\t\tthis.parseAnimatorSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 253:\r\n\t\t\t\t\tthis.parseCommand(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isParsed == false) {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.parseGeometry(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 22:\r\n\t\t\t\t\tthis.parseContainer(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 23:\r\n\t\t\t\t\tthis.parseMeshInstance(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 82:\r\n\t\t\t\t\tthis.parseTexture(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 101:\r\n\t\t\t\t\tthis.parseSkeleton(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 102:\r\n\t\t\t\t\tthis.parseSkeletonPose(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 103:\r\n\t\t\t\t\tthis.parseSkeletonAnimation(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 121:\r\n\t\t\t\t//this.parseUVAnimation(this._cur_block_id);\r\n\t\t\t\t//break;\r\n\t\t\t\tcase 254:\r\n\t\t\t\t\tthis.parseNameSpace(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 255:\r\n\t\t\t\t\tthis.parseMetaData(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (this._debug)\r\n\t\t\t\t\t\tconsole.log(\"AWDBlock:   Unknown BlockType  (BlockID = \" + this._cur_block_id + \") - Skip \" + len + \" bytes\");\r\n\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tif (this._newBlockBytes.position != blockEndBlock)\r\n\t\t\t\tconsole.log(\"  (!)(!)(!) Error while reading AWDBlock ID \" + this._cur_block_id + \" = skip to next block\");\r\n\r\n\t\t\tif (block.errorMessages) {\r\n\t\t\t\tvar len:number = block.errorMessages.length;\r\n\t\t\t\tfor (var msgCnt:number = 0; msgCnt < len; msgCnt++)\r\n\t\t\t\t\tconsole.log(\"        (!) Error: \" + block.errorMessages[msgCnt] + \" (!)\");\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"\\n\");\r\n\t\t}\r\n\r\n\t\tif (this._debugTimers && !this.parsingPaused)\r\n\t\t\tthis.updateTimers(type);\r\n\r\n\t\tthis._body.position = blockEndAll;\r\n\t\tthis._newBlockBytes = null;\r\n\t}\r\n\r\n\tprivate updateTimers(type:number)\r\n\t{\r\n\t\tvar end_timing = performance.now();\r\n\t\tvar time_delta = end_timing - this.start_timeing;\r\n\t\tthis._time_all += time_delta;\r\n\r\n\t\tif (type == 1) {\r\n\t\t\tthis._time_geom += time_delta;\r\n\t\t\tthis._num_geom++;\r\n\t\t} else if (type == 133) {\r\n\t\t\tthis._time_timeline += time_delta;\r\n\t\t\tthis._num_timeline++;\r\n\t\t} else if (type == 135) {\r\n\t\t\tthis._time_fonts += time_delta;\r\n\t\t\tthis._num_fonts++;\r\n\t\t} else if (type == 134) {\r\n\t\t\tthis._time_textfields += time_delta;\r\n\t\t\tthis._num_textfields++;\r\n\t\t} else if (type == 44) {\r\n\t\t\tthis._time_sounds += time_delta;\r\n\t\t\tthis._num_sounds++;\r\n\t\t} else if (type == 82) {\r\n\t\t\tthis._time_textures += time_delta;\r\n\t\t\tthis._num_textures++;\r\n\t\t} else if (type == 81) {\r\n\t\t\tthis._time_materials += time_delta;\r\n\t\t\tthis._num_materials++;\r\n\t\t} else if(type==24) {\r\n\t\t\tthis._time_meshes += time_delta;\r\n\t\t\tthis._num_meshes++;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//--Parser Blocks---------------------------------------------------------------------------\r\n\r\n\r\n\tprivate parseTesselatedFont(blockID:number)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n\t\tvar new_font:Font=<Font>AssetLibrary.getAsset(this._blocks[blockID].name);\r\n\t\tvar newfont:Boolean = false;\r\n\t\tif(new_font==undefined){\r\n\t\t\tnew_font = new Font();\r\n\t\t\tnewfont=true;\r\n\t\t}\r\n\t\tvar font_style_cnt:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar font_style_char_cnt:number;\r\n\t\tvar font_style_name:string;\r\n\t\tvar new_font_style:TesselatedFontTable;\r\n\t\tvar font_style_char:number;\r\n\t\tvar sm_len:number;\r\n\t\tvar sm_end:number;\r\n\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\t\tfor (var i:number = 0; i < font_style_cnt; ++i) {\r\n\t\t\tfont_style_name = this.parseVarStr();\r\n\r\n\t\t\t// dirty hack for icycle\r\n\t\t\t// we use bold chars for non-latin chars, but we use regular for  sign,\r\n\t\t\t// so the dirty hack is to merge the regular and the bold style\r\n\t\t\tif((this._blocks[blockID].name==\"Tahoma\") && (font_style_name==\"RegularStyle\")){\r\n\t\t\t\tfont_style_name=\"BoldStyle\";\r\n\t\t\t}\r\n\r\n\t\t\tnew_font_style = new_font.get_font_table(font_style_name);\r\n\t\t\tnew_font_style.set_font_em_size(this._newBlockBytes.readUnsignedInt());\r\n\t\t\tnew_font_style.set_whitespace_width(this._newBlockBytes.readUnsignedInt());\r\n\t\t\t//console.log(new_font_style.get_whitespace_width());\r\n\t\t\tfont_style_char_cnt = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tfor (var j:number = 0; j < font_style_char_cnt; ++j) {\r\n\t\t\t\t// todo: this is basically a simplified version of the subgeom-parsing done in parseGeometry. Make a parseSubGeom() instead (?)\r\n\t\t\t\tfont_style_char = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tsm_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tsm_end = this._newBlockBytes.position + sm_len;\r\n\r\n\t\t\t\t// Loop through data streams\r\n\t\t\t\twhile (this._newBlockBytes.position < sm_end) {\r\n\t\t\t\t\t// Type, field type, length\r\n\t\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_ftype = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\r\n\t\t\t\t\tif (str_type == 2) {//face indices positions\r\n\t\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tfor(var idx:number = 0; this._newBlockBytes.position < str_end; idx++)\r\n\t\t\t\t\t\t\tindices[idx] = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 7 x float32\r\n\t\t\t\t\t\tvar curveData:ByteArray = new ByteArray(str_len);\r\n\t\t\t\t\t\tthis._newBlockBytes.readBytes(curveData, 0, str_len);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(curveData) {\r\n\t\t\t\t\tvar vertexBuffer:AttributesBuffer = new AttributesBuffer(20, str_len / 20);\r\n\t\t\t\t\tvertexBuffer.bufferView = new Uint8Array(<ArrayBuffer> curveData.arraybytes);\r\n\r\n\t\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(vertexBuffer);\r\n\t\t\t\t\t//curve_sub_geom.setUVs(new Float2Attributes(vertexBuffer));\r\n\t\t\t\t\tcurve_sub_geom.autoDeriveUVs=false;\r\n\t\t\t\t\tnew_font_style.set_subgeo_for_char(font_style_char.toString(), curve_sub_geom);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.parseProperties(null);\r\n\t\tthis.parseUserAttributes();\r\n\t\tif(newfont) {\r\n\t\t\tthis._pFinalizeAsset(<IAsset>new_font, name);\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].data = new_font;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a font: Name = '\" + name);\r\n\t}\r\n\r\n\tprivate static textFormatProperties:Object = {\r\n\t\t1:AWDParser.UINT16,\r\n\t\t2:AWDParser.UINT16,\r\n\t\t3:AWDParser.UINT8,\r\n\t\t4:AWDParser.UINT8,\r\n\t\t5:AWDParser.UINT8,\r\n\t\t6:AWDParser.UINT8,\r\n\t\t7:AWDParser.UINT16,\r\n\t\t8:AWDParser.UINT16,\r\n\t\t9:AWDParser.UINT16,\r\n\t\t10:AWDParser.UINT16};\r\n\r\n\tprivate parseTextFormat(blockID:number)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n\r\n\t\tvar font:Font = <Font> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar font_style_name:string = this.parseVarStr();\r\n\r\n\t\tvar newTextFormat:TextFormat = new TextFormat();\r\n\t\tnewTextFormat.font_name = font.name;\r\n\r\n\t\tvar font_table:TesselatedFontTable = font.get_font_table(font_style_name);\r\n\t\tif (font_table!=null) {\r\n\t\t\tnewTextFormat.font_style = font_style_name;\r\n\t\t\tnewTextFormat.font_table = font_table;\r\n\t\t}\r\n\r\n\t\tvar mat:BasicMaterial = <BasicMaterial> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tmat.bothSides = true;\r\n\r\n\t\tvar num_uv_values:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar uv_values:Array<number> = [];\r\n\t\tfor(var uvcnt:number = 0; uvcnt < num_uv_values; uvcnt++)\r\n\t\t\tuv_values[uvcnt] = this._newBlockBytes.readFloat();\r\n\r\n\t\tnewTextFormat.uv_values = uv_values;\r\n\t\tvar format_props:AWDProperties = this.parseProperties(AWDParser.textFormatProperties);\r\n\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\tvar tf_align_int:number = format_props.get(6,0);\r\n\t\tif(tf_align_int==1){\r\n\t\t\tnewTextFormat.align=\"right\";\r\n\t\t}\r\n\t\telse if(tf_align_int==2){\r\n\t\t\tnewTextFormat.align=\"center\";\r\n\t\t}\r\n\t\tnewTextFormat.indent = format_props.get(7,0);\r\n\t\tnewTextFormat.leftMargin = format_props.get(8,0);\r\n\t\tnewTextFormat.rightMargin = format_props.get(9,0);\r\n\t\t//newTextFormat.linespacing = format_props.get(10,0);\r\n\t\tnewTextFormat.material = mat;\r\n\t\tthis.parseUserAttributes();// textformat has no extra-properties\r\n\t\t//newTextFormat.extra =\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> newTextFormat, name);\r\n\t\tthis._blocks[blockID].data = newTextFormat;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TextFormat: Name = '\" + name + \" font: \"+font.name);\r\n\t}\r\n\r\n\tprivate static textFieldProperties:Object = {\r\n\t\t1:AWDParser.BOOL,\r\n\t\t3:AWDParser.BOOL,\r\n\t\t4:AWDParser.BOOL,\r\n\t\t5:AWDParser.BOOL,\r\n\t\t7:AWDParser.UINT8,\r\n\t\t8:AWDParser.UINT8,\r\n\t\t9:AWDParser.UINT8};\r\n\r\n\tprivate static textFieldTypes:Array<string> = [\"static\", \"dynamic\", \"input\", \"input\"];\r\n\r\n\r\n\tprivate paresTextField(blockID:number, factory:ITimelineSceneGraphFactory)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n        var newTextField = factory.createTextField();\r\n\t\tvar text_field_type:number=this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\tnewTextField.type = AWDParser.textFieldTypes[text_field_type];\r\n\r\n\t\tif(text_field_type == 3)\r\n\t\t\tnewTextField.displayAsPassword = true;\r\n\r\n\t\t//\r\n\t\tnewTextField.textWidth = Math.abs(this._newBlockBytes.readFloat());\r\n\t\tnewTextField.textHeight = Math.abs(this._newBlockBytes.readFloat());\r\n\t\tvar num_paragraphs:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar complete_text:string = \"\";\r\n\t\t//console.log(\"num_paragraphs  '\" + num_paragraphs);\r\n\t\tfor(var paracnt:number=0; paracnt<num_paragraphs; paracnt++){\r\n\r\n\t\t\tvar num_textruns:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"num_textruns  '\" + num_textruns);\r\n\t\t\tfor(var textrun_cnt:number=0; textrun_cnt<num_textruns; textrun_cnt++) {\r\n\t\t\t\tvar text_format:TextFormat = <TextFormat> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\t\t\tvar txt_length = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"txt_length  '\" + txt_length);\r\n\t\t\t\tif (txt_length > 0) {\r\n\t\t\t\t\tvar this_txt:string = this._newBlockBytes.readUTFBytes(txt_length);\r\n\t\t\t\t\t//newTextField.appendText(this_txt, text_format);\r\n\t\t\t\t\tcomplete_text += this_txt;\r\n\t\t\t\t\t//console.log(\"this_txt  '\" + this_txt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//newTextField.closeParagraph();\r\n\t\t}\r\n\t\tnewTextField.textFormat=text_format;\r\n\t\tnewTextField.text=complete_text;\r\n\t\t//newTextField.construct_geometry();\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.textFieldProperties);\r\n\t\tnewTextField.selectable = props.get(1, false);\r\n\t\tnewTextField.border =  props.get(3, false);\r\n\t\t//newTextField.renderHTML =  props.get(4, false);\r\n\t\t//newTextField.scrollable =  props.get(5, false);\r\n\t\t//newTextField.text_flow =  props.get(7, 0);\r\n\t\t//newTextField.orientationMode =  props.get(8, 0);\r\n\t\t//newTextField.line_mode =  props.get(9, 0);\r\n\t\tnewTextField.extra = this.parseUserAttributes();\r\n\r\n\t\t//console.log(\"Parsed a TextField: Name = '\" + name + \"| text  = \" + complete_text);\r\n\t\tthis._pFinalizeAsset(<IAsset> newTextField, name);\r\n\t\tthis._blocks[blockID].data = newTextField;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TextField: Name = '\" + name + \"| text  = \" + complete_text);\r\n\t}\r\n\r\n\t// Block ID = 25\r\n\tprivate parseBillBoardLibraryBlock(blockID:number)\r\n\t{\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar mat:BasicMaterial = <BasicMaterial> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tmat.bothSides=true;\r\n\t\tvar billboard:Billboard = new Billboard(mat);\r\n\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tthis.parseProperties(null);\r\n\r\n\t\tbillboard.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> billboard, name);\r\n\r\n\t\tthis._blocks[blockID].data = billboard;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Library-Billboard: Name = '\" + name + \"| Material-Name = \" + mat.name);\r\n\t}\r\n\t// Block ID = 24\r\n\tprivate parseMeshLibraryBlock(blockID:number)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry = <Geometry> this._blocks[data_id].data;\r\n\t\tthis._blocks[blockID].geoID = data_id;\r\n\r\n\t\tvar num_materials:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar materials:Array<MethodMaterial> = new Array<MethodMaterial>();\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tvar mat:MethodMaterial;\r\n\t\tfor (var materials_parsed:number = 0; materials_parsed < num_materials; materials_parsed++) {\r\n\t\t\tmat = <MethodMaterial> (this._blocks[this._newBlockBytes.readUnsignedInt()].data || DefaultMaterialManager.getDefaultMaterial());\r\n\t\t\t//mat.preserveAlpha = true;\r\n\t\t\tmat.alphaBlending = true;\r\n\t\t\tmat.useColorTransform = true;\r\n\t\t\tmaterials[materials_parsed] = mat;\r\n\t\t\tmaterialNames[materials_parsed] = mat.name;\r\n\t\t}\r\n\r\n\t\tvar start_timeing = performance.now();\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\t\tvar end_timing = performance.now();\r\n\t\tvar time_delta = end_timing - start_timeing;\r\n\t\tthis._time_geom_bytes += time_delta;\r\n\r\n\t\t/*\r\n\t\tvar num_subgeoms:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tif(num_subgeoms!=mesh.subMeshes.length){\r\n\t\t\t//error\r\n\t\t}\r\n\t\tfor (var i:number = 0; i < num_subgeoms; i++) {\r\n\r\n\t\t\t// uv that descripes top left corner of area in textureatlas\r\n\t\t\tnew Point (this._newBlockBytes.readFloat(), this._newBlockBytes.readFloat());\r\n\t\t\t// uv that descripes bottom right corner of area in textureatlas\r\n\t\t\tnew Point (this._newBlockBytes.readFloat(), this._newBlockBytes.readFloat());\r\n\t\t\t// optional: transform matrix\r\n\t\t\tvar hasUVTransform:Boolean=!!this._newBlockBytes.readUnsignedByte();\r\n\t\t\tif(hasUVTransform){\r\n\t\t\t\tthis.parseMatrix32RawData();\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (var i:number = 0; i < mesh.subMeshes.length; i++)\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t}\r\n\r\n\t\tthis.parseProperties(null);\r\n\t\tmesh.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mesh, name);\r\n\r\n\t\tthis._blocks[blockID].data = mesh;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Library-Mesh: Name = '\" + name + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames);\r\n\t}\r\n\r\n\tprivate parseAudioBlock(blockID:number, factory:ITimelineSceneGraphFactory)\r\n\t{\r\n\t\t//var asset:Audio;todo create asset for audio\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\t\t\t// todo parser needs to be able to handle mp3 and wav files if we trigger the loading of external ressource\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true);\r\n\t\t} else {\r\n\t\t\t// todo: exporter does not export embed sounds yet\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray = new ByteArray(data_len);\r\n\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t// todo parse sound from bytes\r\n\t\t\t// this._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.by(data), true);\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), null, false, data, true);\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t//this._blocks[blockID].data = asset;todo\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Start parsing a \" + [\"external\", \"embed\"][type] + \" Audio file\");\r\n\t}\r\n\r\n\t//Block ID = 4\r\n\tprivate parseTimeLine(blockID:number, factory:ITimelineSceneGraphFactory)\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar j:number;\r\n\t\tvar cmd_asset:DisplayObject;\r\n\t\tvar new_timeline:Timeline = new Timeline();\r\n\t\tvar timeLineContainer = factory.createMovieClip(new_timeline);\r\n\t\tvar name = this.parseVarStr();\r\n\t\tvar isScene = !!this._newBlockBytes.readUnsignedByte();\r\n\t\tvar sceneID = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar fps = this._newBlockBytes.readFloat();\r\n\r\n\t\t// register list of potential childs\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\t// However, for each potential child, we need to register the max-number of instances that a frame contains\r\n\t\t// we parse 2 lists of potential-childs:\r\n\t\t// -\tthe first list contains potential-childs that are only ever instanced once per frame.\r\n\t\t// -\tthe second list contains potential-childs that are instanced multiple times on some frames.\r\n\r\n\t\t// on registering a child, the child gets a incremental-id assigned. This is the id, that the commands are using to access the childs.\r\n\t\t// hence we need to be careful to register all objects in correct order.\r\n\r\n\t\tvar num_potential_childs:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_childs; i++) {\r\n\t\t\tcmd_asset = <DisplayObject> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tnew_timeline.registerPotentialChild(cmd_asset);\r\n\t\t\t} else {\r\n\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t//timeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar num_all_display_instances:number = num_potential_childs;\r\n\r\n\t\tvar num_potential_childs_multi_instanced = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_childs_multi_instanced; i++) {\r\n\t\t\tcmd_asset = <DisplayObject> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\t\tvar num_instances:number = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tnum_all_display_instances += num_instances;\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tfor (j = 0; j < num_instances; j++)\r\n\t\t\t\t\tnew_timeline.registerPotentialChild(cmd_asset);\r\n\t\t\t} else {\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t\t//timeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed \" + (num_potential_childs + num_potential_childs_multi_instanced) + \" potential childs. They will be used by \" + num_all_display_instances + \" instances.\");\r\n\r\n\t\t// register list of potential sounds - for now we always have 0 sounds\r\n\t\tvar num_potential_sounds = this._newBlockBytes.readUnsignedShort();\r\n\r\n\r\n\t\tvar str_cnt = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar str_len = 0;\r\n\t\tvar str_data_type = 0;\r\n\t\tvar str_type=0;\r\n\t\tvar str_counter=0;\r\n\t\tfor(i=0; i<str_cnt;i++){\r\n\t\t\t// the first 6 lists are not optional and always in same order\r\n\t\t\t// hence we can get type by incremental counter instead of stored uint8\r\n\t\t\tif(str_counter<6)\r\n\t\t\t\tstr_type=str_counter;\r\n\t\t\telse\r\n\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t// get the data type for this stream (1:UINT8 - 2:UINT16 - 3:UINT32)\r\n\t\t\tstr_data_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t// size of this stream in byte\r\n\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tif(str_len>0) {\r\n\t\t\t\tvar keyframes_start_indices_data:ByteArray = new ByteArray(str_len);\r\n\t\t\t\tthis._newBlockBytes.readBytes(keyframes_start_indices_data, 0, str_len);\r\n\t\t\t\tvar new_buffer:ArrayBufferView;\r\n\t\t\t\t//console.log(\"str_data_type = \"+str_type);\r\n\t\t\t\tswitch (str_data_type) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tnew_buffer = new Uint8Array(<ArrayBuffer> keyframes_start_indices_data.arraybytes);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tnew_buffer = new Uint16Array(<ArrayBuffer> keyframes_start_indices_data.arraybytes);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tnew_buffer = new Uint32Array(<ArrayBuffer> keyframes_start_indices_data.arraybytes);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tswitch (str_type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tnew_timeline.keyframe_durations = new_buffer;\r\n\t\t\t\t\t\tnew_timeline.numKeyFrames=str_len / str_data_type;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tnew_timeline.frame_command_indices = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tnew_timeline.frame_recipe = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tnew_timeline.command_length_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tnew_timeline.command_index_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\tnew_timeline.add_child_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\tnew_timeline.remove_child_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\tnew_timeline.update_child_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\tnew_timeline.update_child_props_indices_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 9:\r\n\t\t\t\t\t\tnew_timeline.update_child_props_length_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 10:\r\n\t\t\t\t\t\tnew_timeline.property_type_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 11:\r\n\t\t\t\t\t\tnew_timeline.property_index_stream = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 12:\r\n\t\t\t\t\t\tnew_timeline.properties_stream_int = new_buffer;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstr_counter++;\r\n\t\t}\r\n\t\tvar lc:number=0;\r\n\t\tvar float_array_data:ByteArray;\r\n\t\tstr_cnt = this._newBlockBytes.readUnsignedByte();\r\n\t\tfor(i=0; i<str_cnt;i++){\r\n\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\tswitch(str_type) {\r\n\t\t\t\tcase 0://mtx_scale\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tfloat_array_data = new ByteArray(str_len);\r\n\t\t\t\t\tthis._newBlockBytes.readBytes(float_array_data, 0, str_len);\r\n\t\t\t\t\tnew_timeline.properties_stream_f32_mtx_scale_rot=new Float32Array(<ArrayBuffer> float_array_data.arraybytes);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1://mtx_pos\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tfloat_array_data = new ByteArray(str_len);\r\n\t\t\t\t\tthis._newBlockBytes.readBytes(float_array_data, 0, str_len);\r\n\t\t\t\t\tnew_timeline.properties_stream_f32_mtx_pos=new Float32Array(<ArrayBuffer> float_array_data.arraybytes);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2://mtx_all\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tfloat_array_data = new ByteArray(str_len);\r\n\t\t\t\t\tthis._newBlockBytes.readBytes(float_array_data, 0, str_len);\r\n\t\t\t\t\tnew_timeline.properties_stream_f32_mtx_all=new Float32Array(<ArrayBuffer> float_array_data.arraybytes);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3://ct\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tfloat_array_data = new ByteArray(str_len);\r\n\t\t\t\t\tthis._newBlockBytes.readBytes(float_array_data, 0, str_len);\r\n\t\t\t\t\tnew_timeline.properties_stream_f32_ct=new Float32Array(<ArrayBuffer> float_array_data.arraybytes);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4://labels\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t//console.log(\"start reading labels \"+str_len);\r\n\t\t\t\t\tfor (lc = 0; lc < str_len; lc++) {\r\n\t\t\t\t\t\tnew_timeline._labels[this.parseVarStr()] = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5://name_stream\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\tvar string_props_array:Array<string>=[];\r\n\t\t\t\t\tfor (lc = 0; lc < str_len; lc++) {\r\n\t\t\t\t\t\tstring_props_array.push(this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort()));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnew_timeline.properties_stream_strings = string_props_array;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 6://script_stream\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\tfor (lc = 0; lc < str_len; lc++) {\r\n\t\t\t\t\t\tvar frame_index=this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tvar one_str_len=this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t//this._newBlockBytes.readUTFBytes(one_str_len);\r\n\t\t\t\t\t\tnew_timeline.add_framescript(this._newBlockBytes.readUTFBytes(one_str_len), frame_index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tnew_timeline.init();\r\n\t\tthis.parseProperties(null);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset>timeLineContainer, name);\r\n\r\n\t\tthis._blocks[blockID].data = timeLineContainer;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TIMELINE: Name = \" + name + \"| isScene = \" + isScene + \"| sceneID = \" + sceneID + \"| numFrames = \");\r\n\t}\r\n\r\n\tprivate static geometryProperties:Object = {\r\n\t\t1:AWDParser.GEO_NUMBER,\r\n\t\t2:AWDParser.GEO_NUMBER};\r\n\r\n\tprivate static subGeometryProperties:Object = {\r\n\t\t1:AWDParser.GEO_NUMBER,\r\n\t\t2:AWDParser.GEO_NUMBER};\r\n\r\n\t//Block ID = 1\r\n\tprivate parseGeometry(blockID:number)\r\n\t{\r\n\t\tvar geom:Geometry = new Geometry();\r\n\r\n\t\t// Read name and sub count\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_subs:number = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t// Read optional properties\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.geometryProperties);\r\n\t\tvar geoScaleU:number = props.get(1, 1);\r\n\t\tvar geoScaleV:number = props.get(2, 1);\r\n\r\n\t\t// Loop through sub meshes\r\n\t\tfor (var subs_parsed:number = 0;  subs_parsed < num_subs; subs_parsed++) {\r\n\t\t\tvar is_curve_geom:boolean=false;\r\n\t\t\tvar sm_len:number, sm_end:number;\r\n\t\t\tvar w_indices:Array<number>;\r\n\t\t\tvar weights:Array<number>;\r\n\r\n\t\t\tsm_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tsm_end = this._newBlockBytes.position + sm_len;\r\n\r\n\t\t\tvar subProps:AWDProperties = this.parseProperties(AWDParser.subGeometryProperties);\r\n\t\t\t// Loop through data streams\r\n\t\t\twhile (this._newBlockBytes.position < sm_end) {\r\n\t\t\t\tvar idx:number = 0;\r\n\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t// Type, field type, length\r\n\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_ftype = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\r\n\t\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\t\tif (str_type == 1) {//vertex 3d positions\r\n\t\t\t\t\tvar verts:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tz = this.readNumber(this._accuracyGeo);\r\n\r\n\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 2) {//face indicies positions\r\n\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end)\r\n\t\t\t\t\t\tindices[idx++] = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t} else if (str_type == 3) {\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end)\r\n\t\t\t\t\t\tuvs[idx++] = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t} else if (str_type == 4) {\r\n\t\t\t\t\tvar normals:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end)\r\n\t\t\t\t\t\tnormals[idx++] = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t} else if (str_type == 6) {\r\n\t\t\t\t\tw_indices = Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end)\r\n\t\t\t\t\t\tw_indices[idx++] = this._newBlockBytes.readUnsignedShort()*3;\r\n\t\t\t\t} else if (str_type == 7) {\r\n\t\t\t\t\tweights = new Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end)\r\n\t\t\t\t\t\tweights[idx++] = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t} else if (str_type == 8) {// 2d-positions - not used yet.\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 9) {// combined vertex3D stream 13 x float32\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\tis_curve_geom = true;\r\n\t\t\t\t\tvar curveData:ByteArray = new ByteArray(str_len);\r\n\t\t\t\t\tthis._newBlockBytes.readBytes(curveData, 0, str_len);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\r\n\t\t\tif(is_curve_geom){\r\n\t\t\t\tvar vertexBuffer:AttributesBuffer = new AttributesBuffer(28, str_len/28);\r\n\t\t\t\tvertexBuffer.bufferView = new Uint8Array(<ArrayBuffer> curveData.arraybytes);\r\n\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(vertexBuffer);\r\n\t\t\t\tcurve_sub_geom.setUVs(new Float2Attributes(vertexBuffer));\r\n\t\t\t\tgeom.addSubGeometry(curve_sub_geom);\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a CurveSubGeometry\");\r\n\t\t\t} else {\r\n\t\t\t\tvar triangle_sub_geom = new TriangleSubGeometry(new AttributesBuffer());\r\n\r\n\t\t\t\tif (weights)\r\n\t\t\t\t\ttriangle_sub_geom.jointsPerVertex = weights.length / (verts.length / 3);\r\n\r\n\t\t\t\tif (normals)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveNormals = false;\r\n\r\n\t\t\t\tif (uvs)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveUVs = false;\r\n\r\n\t\t\t\ttriangle_sub_geom.autoDeriveTangents = true;\r\n\r\n\t\t\t\ttriangle_sub_geom.setIndices(indices);\r\n\t\t\t\ttriangle_sub_geom.setPositions(verts);\r\n\t\t\t\ttriangle_sub_geom.setNormals(normals);\r\n\t\t\t\ttriangle_sub_geom.setUVs(uvs);\r\n\t\t\t\ttriangle_sub_geom.setTangents(null);\r\n\t\t\t\ttriangle_sub_geom.setJointWeights(weights);\r\n\t\t\t\ttriangle_sub_geom.setJointIndices(w_indices);\r\n\r\n\t\t\t\tvar scaleU:number = subProps.get(1, 1);\r\n\t\t\t\tvar scaleV:number = subProps.get(2, 1);\r\n\t\t\t\tvar setSubUVs:boolean = false; //this should remain false atm, because in AwayBuilder the uv is only scaled by the geometry\r\n\r\n\t\t\t\tif ((geoScaleU != scaleU) || (geoScaleV != scaleV)) {\r\n\t\t\t\t\tsetSubUVs = true;\r\n\t\t\t\t\tscaleU = geoScaleU / scaleU;\r\n\t\t\t\t\tscaleV = geoScaleV / scaleV;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (setSubUVs)\r\n\t\t\t\t\ttriangle_sub_geom.scaleUV(scaleU, scaleV);\r\n\r\n\t\t\t\tgeom.addSubGeometry(triangle_sub_geom);\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a TriangleSubGeometry\");\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// TODO: Somehow map in-sub to out-sub indices to enable look-up\r\n\t\t\t// when creating meshes (and their material assignments.)\r\n\t\t}\r\n\r\n\t\tif ((geoScaleU != 1) || (geoScaleV != 1))\r\n\t\t\tgeom.scaleUV(geoScaleU, geoScaleV);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> geom, name);\r\n\t\tthis._blocks[blockID].data = geom;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TriangleGeometry: Name = \" + name);\r\n\t}\r\n\r\n\tprivate static primitiveProperties:Object = {\r\n\t\t101:AWDParser.GEO_NUMBER,\r\n\t\t102:AWDParser.GEO_NUMBER,\r\n\t\t103:AWDParser.GEO_NUMBER,\r\n\t\t110:AWDParser.GEO_NUMBER,\r\n\t\t111:AWDParser.GEO_NUMBER,\r\n\t\t301:AWDParser.UINT16,\r\n\t\t302:AWDParser.UINT16,\r\n\t\t303:AWDParser.UINT16,\r\n\t\t701:AWDParser.BOOL,\r\n\t\t702:AWDParser.BOOL,\r\n\t\t703:AWDParser.BOOL,\r\n\t\t704:AWDParser.BOOL};\r\n\r\n\tprivate static primitiveTypes:Array<string> = [\"Unsupported Type-ID\", \"PrimitivePlanePrefab\", \"PrimitiveCubePrefab\", \"PrimitiveSpherePrefab\", \"PrimitiveCylinderPrefab\", \"PrimitivesConePrefab\", \"PrimitivesCapsulePrefab\", \"PrimitivesTorusPrefab\"];\r\n\r\n\t//Block ID = 11\r\n\tprivate parsePrimitves(blockID:number)\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar primType:number;\r\n\t\tvar subs_parsed:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar bsm:Matrix3D;\r\n\r\n\t\t// Read name and sub count\r\n\t\tname = this.parseVarStr();\r\n\t\tprimType = this._newBlockBytes.readUnsignedByte();\r\n\t\tprops = this.parseProperties(AWDParser.primitiveProperties);\r\n\r\n\t\t// to do, not all properties are set on all primitives\r\n\t\tswitch (primType) {\r\n\t\t\tcase 1:\r\n\t\t\t\tprefab = new PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tprefab = new PrimitiveCubePrefab(props.get(101, 100), props.get(102, 100), props.get(103, 100), props.get(301, 1), props.get(302, 1), props.get(303, 1), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tprefab = new PrimitiveSpherePrefab(props.get(101, 50), props.get(301, 16), props.get(302, 12), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tprefab = new PrimitiveCylinderPrefab(props.get(101, 50), props.get(102, 50), props.get(103, 100), props.get(301, 16), props.get(302, 1), true, true, true); // bool701, bool702, bool703, bool704);\r\n\t\t\t\tif (!props.get(701, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).topClosed = false;\r\n\t\t\t\tif (!props.get(702, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).bottomClosed = false;\r\n\t\t\t\tif (!props.get(703, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).yUp = false;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tprefab = new PrimitiveConePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 1), props.get(701, true), props.get(702, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tprefab = new PrimitiveCapsulePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 15), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tprefab = new PrimitiveTorusPrefab(props.get(101, 50), props.get(102, 50), props.get(301, 16), props.get(302, 8), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tprefab = new PrefabBase();\r\n\t\t\t\tconsole.log(\"ERROR: UNSUPPORTED PREFAB_TYPE\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif ((props.get(110, 1) != 1) || (props.get(111, 1) != 1)) {\r\n\t\t\t//geom.subGeometries;\r\n\t\t\t//geom.scaleUV(props.get(110, 1), props.get(111, 1)); //TODO add back scaling to prefabs\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tprefab.name = name;\r\n\t\tthis._pFinalizeAsset(prefab, name);\r\n\t\tthis._blocks[blockID].data = prefab;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tif ((primType < 0) || (primType > 7))\r\n\t\t\t\tprimType = 0;\r\n\r\n\t\t\tconsole.log(\"Parsed a Primivite: Name = \" + name + \"| type = \" + AWDParser.primitiveTypes[primType]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static containerProperties:Object = {\r\n\t\t1:AWDParser.MATRIX_NUMBER,\r\n\t\t2:AWDParser.MATRIX_NUMBER,\r\n\t\t3:AWDParser.MATRIX_NUMBER,\r\n\t\t4:AWDParser.UINT8};\r\n\r\n\t// Block ID = 22\r\n\tprivate parseContainer(blockID:number)\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar mtx:Matrix3D;\r\n\t\tvar ctr:DisplayObjectContainer;\r\n\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\r\n\t\tmtx = this.parseMatrix3D();\r\n\t\tname = this.parseVarStr();\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tctr = new DisplayObjectContainer();\r\n\t\tctr.transform.matrix3D = mtx;\r\n\r\n\t\tif (parent) {\r\n\t\t\tparent.addChild(ctr);\r\n\t\t\tparentName = parent.name;\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(ctr);\r\n\t\t}\r\n\r\n\t\t// in AWD version 2.1 we read the Container properties\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties(AWDParser.containerProperties);\r\n\t\t\tctr.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t} else {// in other versions we do not read the Container properties\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\t// the extraProperties should only be set for AWD2.1-Files, but is read for both versions\r\n\t\tctr.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> ctr, name);\r\n\t\tthis._blocks[blockID].data = ctr;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Container: Name = '\" + name + \"' | Parent-Name = \" + parentName);\r\n\t}\r\n\r\n\tprivate static meshInstanceProperties:Object = {\r\n\t\t1:AWDParser.MATRIX_NUMBER,\r\n\t\t2:AWDParser.MATRIX_NUMBER,\r\n\t\t3:AWDParser.MATRIX_NUMBER,\r\n\t\t4:AWDParser.UINT8,\r\n\t\t5:AWDParser.BOOL};\r\n\r\n\t// Block ID = 23\r\n\tprivate parseMeshInstance(blockID:number)\r\n\t{\r\n\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar asset:IAsset = <IAsset> this._blocks[data_id].data;\r\n\t\tvar geom:Geometry;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar isPrefab:boolean=false;\r\n\t\tif (asset.isAsset(Geometry)) {\r\n\t\t\tgeom = <Geometry> asset;\r\n\t\t} else {\r\n\t\t\tisPrefab = true;\r\n\t\t\tprefab = <PrefabBase> asset;\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].geoID = data_id;\r\n\t\tvar num_materials:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar materials:Array<MethodMaterial> = new Array<MethodMaterial>();\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tvar mat:MethodMaterial;\r\n\t\tfor (var materials_parsed:number = 0; materials_parsed < num_materials; materials_parsed++) {\r\n\t\t\tmat = <MethodMaterial> (this._blocks[this._newBlockBytes.readUnsignedInt()].data || DefaultMaterialManager.getDefaultMaterial());\r\n\t\t\tmaterials[materials_parsed] = mat;\r\n\t\t\tmaterialNames[materials_parsed] = mat.name;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = isPrefab? <Mesh> prefab.getNewObject() : new Mesh(geom, null);\r\n\t\tmesh.transform.matrix3D = mtx;\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tif (parent) {\r\n\t\t\tparent.addChild(mesh);\r\n\t\t\tparentName = parent.name;\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\t\t}\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (var i:number = 0; i < mesh.subMeshes.length; i++)\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t}\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties(AWDParser.meshInstanceProperties);\r\n\t\t\tmesh.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\tmesh.castsShadows = props.get(5, true);\r\n\t\t} else {\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\tmesh.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mesh, name);\r\n\t\tthis._blocks[blockID].data = mesh;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tif (isPrefab)\r\n\t\t\t\tconsole.log(\"Parsed a Mesh for Prefab: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Prefab-Name = \" + prefab.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames);\r\n\t\t\telse\r\n\t\t\t\tconsole.log(\"Parsed a Mesh for Geometry: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//Block ID 31\r\n\tprivate parseSkyboxInstance(blockID:number)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar asset:Skybox = new Skybox();\r\n\t\tvar tex:SingleCubeTexture = <SingleCubeTexture> (this._blocks[this._newBlockBytes.readUnsignedInt()].data || DefaultMaterialManager.getDefaultTexture(asset));\r\n\t\tasset.cubeMap = tex;\r\n\r\n\t\tthis.parseProperties(null);\r\n\t\tasset.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(asset, name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skybox: Name = '\" + name + \"' | CubeTexture-Name = \" + tex.name);\r\n\t}\r\n\r\n\tprivate static lightProperties:Object = {\r\n\t\t1:AWDParser.PROPERTY_NUMBER,\r\n\t\t2:AWDParser.PROPERTY_NUMBER,\r\n\t\t3:AWDParser.COLOR,\r\n\t\t4:AWDParser.PROPERTY_NUMBER,\r\n\t\t5:AWDParser.PROPERTY_NUMBER,\r\n\t\t6:AWDParser.BOOL,\r\n\t\t7:AWDParser.COLOR,\r\n\t\t8:AWDParser.PROPERTY_NUMBER,\r\n\t\t9:AWDParser.UINT8,\r\n\t\t10:AWDParser.UINT8,\r\n\t\t11:AWDParser.PROPERTY_NUMBER,\r\n\t\t12:AWDParser.UINT16,\r\n\t\t21:AWDParser.MATRIX_NUMBER,\r\n\t\t22:AWDParser.MATRIX_NUMBER,\r\n\t\t23:AWDParser.MATRIX_NUMBER};\r\n\r\n\t//Block ID = 41\r\n\tprivate parseLight(blockID:number)\r\n\t{\r\n\t\tvar light:LightBase;\r\n\t\tvar newShadowMapper:ShadowMapperBase;\r\n\r\n\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar lightType:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.lightProperties);\r\n\t\tvar shadowMapperType:number = props.get(9, 0);\r\n\t\tvar lightTypes:Array<string> = [\"Unsupported LightType\", \"PointLight\", \"DirectionalLight\"];\r\n\t\tvar shadowMapperTypes:Array<string> = [\"No ShadowMapper\", \"DirectionalShadowMapper\", \"NearDirectionalShadowMapper\", \"CascadeShadowMapper\", \"CubeMapShadowMapper\"];\r\n\r\n\t\tif (lightType == 1) {\r\n\t\t\tlight = new PointLight();\r\n\r\n\t\t\t(<PointLight> light).radius = props.get(1, 90000);\r\n\t\t\t(<PointLight> light).fallOff = props.get(2, 100000);\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 4) {\r\n\t\t\t\t\tnewShadowMapper = new CubeMapShadowMapper();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.transform.matrix3D = mtx;\r\n\t\t}\r\n\r\n\t\tif (lightType == 2) {\r\n\t\t\tlight = new DirectionalLight(props.get(21, 0), props.get(22, -1), props.get(23, 1));\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 1) {\r\n\t\t\t\t\tnewShadowMapper = new DirectionalShadowMapper();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if (shadowMapperType == 2)\r\n\t\t\t\t//  newShadowMapper = new NearDirectionalShadowMapper(props.get(11, 0.5));\r\n\t\t\t\t//if (shadowMapperType == 3)\r\n\t\t\t\t//   newShadowMapper = new CascadeShadowMapper(props.get(12, 3));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlight.color = props.get(3, 0xffffff);\r\n\t\tlight.specular = props.get(4, 1.0);\r\n\t\tlight.diffuse = props.get(5, 1.0);\r\n\t\tlight.ambientColor = props.get(7, 0xffffff);\r\n\t\tlight.ambient = props.get(8, 0.0);\r\n\r\n\t\t// if a shadowMapper has been created, adjust the depthMapSize if needed, assign to light and set castShadows to true\r\n\t\tif (newShadowMapper) {\r\n\t\t\tif (newShadowMapper instanceof CubeMapShadowMapper) {\r\n\t\t\t\tif (props.get(10, 1) != 1)\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 1)];\r\n\t\t\t} else {\r\n\t\t\t\tif (props.get(10, 2) != 2)\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 2)];\r\n\t\t\t}\r\n\r\n\t\t\tlight.shadowMapper = newShadowMapper;\r\n\t\t\tlight.castsShadows = true;\r\n\t\t}\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tif (parent) {\r\n\t\t\tparent.addChild(light);\r\n\t\t\tparentName = parent.name;\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(light);\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(< IAsset> light, name);\r\n\r\n\t\tthis._blocks[blockID].data = light;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Light: Name = '\" + name + \"' | Type = \" + lightTypes[lightType] + \" | Parent-Name = \" + parentName + \" | ShadowMapper-Type = \" + shadowMapperTypes[shadowMapperType]);\r\n\t}\r\n\r\n\tprivate static cameraProperties:Object = {\r\n\t\t101:AWDParser.PROPERTY_NUMBER,\r\n\t\t102:AWDParser.PROPERTY_NUMBER,\r\n\t\t103:AWDParser.PROPERTY_NUMBER,\r\n\t\t104:AWDParser.PROPERTY_NUMBER};\r\n\r\n\tprivate static cameraPivotProperties:Object = {\r\n\t\t1:AWDParser.MATRIX_NUMBER,\r\n\t\t2:AWDParser.MATRIX_NUMBER,\r\n\t\t3:AWDParser.MATRIX_NUMBER,\r\n\t\t4:AWDParser.UINT8};\r\n\r\n\t//Block ID = 43\r\n\tprivate parseCamera(blockID:number)\r\n\t{\r\n\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar projection:ProjectionBase;\r\n\r\n\t\tthis._newBlockBytes.readUnsignedByte(); //set as active camera\r\n\t\tthis._newBlockBytes.readShort(); //lengthof lenses - not used yet\r\n\r\n\t\tvar projectiontype:number = this._newBlockBytes.readShort();\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.cameraProperties);\r\n\r\n\t\tswitch (projectiontype) {\r\n\t\t\tcase 5001:\r\n\t\t\t\tprojection = new PerspectiveProjection(props.get(101, 60));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5002:\r\n\t\t\t\tprojection = new OrthographicProjection(props.get(101, 500));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5003:\r\n\t\t\t\tprojection = new OrthographicOffCenterProjection(props.get(101, -400), props.get(102, 400), props.get(103, -300), props.get(104, 300));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"unsupportedLenstype\");\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar camera:Camera = new Camera(projection);\r\n\t\tcamera.transform.matrix3D = mtx;\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tif (parent) {\r\n\t\t\tparent.addChild(camera);\r\n\t\t\tparentName = parent.name;\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(camera);\r\n\t\t}\r\n\r\n\t\tcamera.name = name;\r\n\t\tprops = this.parseProperties(AWDParser.cameraPivotProperties);\r\n\t\tcamera.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\tcamera.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(camera, name);\r\n\r\n\t\tthis._blocks[blockID].data = camera;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Camera: Name = '\" + name + \"' | Projectiontype = \" + projection + \" | Parent-Name = \" + parentName);\r\n\t}\r\n\r\n\t//Block ID = 51\r\n\tprivate parseLightPicker(blockID:number)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar numLights:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar lightsArray:Array<LightBase> = new Array<LightBase>();\r\n\r\n\t\tvar lightsArrayNames:Array<string> = new Array<string>();\r\n\r\n\t\tfor (var k:number = 0; k < numLights; k++) {\r\n\t\t\tvar light:LightBase = <LightBase> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\t\tlightsArray.push(light);\r\n\t\t\tlightsArrayNames.push(light.name);\r\n\t\t}\r\n\r\n\t\tif (lightsArray.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this LightPicker, cause no Light was found.\");\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\treturn; //return without any more parsing for this block\r\n\t\t}\r\n\r\n\t\tvar lightPick:LightPickerBase = new StaticLightPicker(lightsArray);\r\n\t\tlightPick.name = name;\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> lightPick, name);\r\n\r\n\t\tthis._blocks[blockID].data = lightPick;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a StaticLightPicker: Name = '\" + name + \"' | Texture-Name = \" + lightsArrayNames);\r\n\t}\r\n\r\n\t// (1=color, 2=bitmap url, 10=alpha, 11=alpha_blending, 12=alpha_threshold, 13=repeat)\r\n\tprivate static materialProperties:Object = {\r\n\t\t1:AWDParser.INT32,\r\n\t\t2:AWDParser.BADDR,\r\n\t\t10:AWDParser.PROPERTY_NUMBER,\r\n\t\t11:AWDParser.BOOL,\r\n\t\t12:AWDParser.PROPERTY_NUMBER,\r\n\t\t13:AWDParser.BOOL};\r\n\r\n\t//Block ID = 81\r\n\tprivate parseMaterial(blockID:number)\r\n\t{\r\n\t\t// TODO: not used\r\n\t\t////blockLength = block.len;\r\n\t\tvar name:string;\r\n\t\tvar type:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar finalize:boolean;\r\n\t\tvar num_methods:number;\r\n\t\tvar methods_parsed:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tname = this.parseVarStr();\r\n\t\ttype = this._newBlockBytes.readUnsignedByte();\r\n\t\tnum_methods = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\t// Read material numerical properties\r\n\t\tprops = this.parseProperties(AWDParser.materialProperties);\r\n\r\n\t\tmethods_parsed = 0;\r\n\t\twhile (methods_parsed < num_methods) {\r\n\t\t\tvar method_type:number;\r\n\r\n\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tmethods_parsed += 1;\r\n\t\t}\r\n\r\n\t\tvar debugString:string = \"\";\r\n\t\tif (type === 1) { // Color material\r\n\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\tvar color:number = props.get(1, 0xffffff);\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t} else {\r\n\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t}\r\n\t\t} else if (type === 2) {\r\n\t\t\tvar texture:Single2DTexture = <Single2DTexture> this._blocks[props.get(2, 0)].data;\r\n\r\n\t\t\tmat = new MethodMaterial(texture);\r\n\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"'\" + (texture? \" | Texture-Name = \" + texture.name : \"\");\r\n\t\t\t} else {\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"'\" + (texture? \" | Texture-Name = \" + texture.name : \"\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmat.extra = this.parseUserAttributes();\r\n\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\r\n\t\tthis._blocks[blockID].data = mat;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(debugString);\r\n\t}\r\n\t\r\n\tprivate static material_v1Properties:Object = {1:AWDParser.UINT32,\r\n\t\t2:AWDParser.BADDR,\r\n\t\t3:AWDParser.BADDR,\r\n\t\t4:AWDParser.UINT8,\r\n\t\t5:AWDParser.BOOL,\r\n\t\t6:AWDParser.BOOL,\r\n\t\t7:AWDParser.BOOL,\r\n\t\t8:AWDParser.BOOL,\r\n\t\t9:AWDParser.UINT8,\r\n\t\t10:AWDParser.PROPERTY_NUMBER,\r\n\t\t11:AWDParser.BOOL,\r\n\t\t12:AWDParser.PROPERTY_NUMBER,\r\n\t\t13:AWDParser.BOOL,\r\n\t\t15:AWDParser.PROPERTY_NUMBER,\r\n\t\t16:AWDParser.UINT32,\r\n\t\t17:AWDParser.BADDR,\r\n\t\t18:AWDParser.PROPERTY_NUMBER,\r\n\t\t19:AWDParser.PROPERTY_NUMBER,\r\n\t\t20:AWDParser.UINT32,\r\n\t\t21:AWDParser.BADDR,\r\n\t\t22:AWDParser.BADDR};\r\n\r\n\tprivate static method_v1Properties:Object = {\r\n\t\t1:AWDParser.BADDR,\r\n\t\t2:AWDParser.BADDR,\r\n\t\t3:AWDParser.BADDR,\r\n\t\t101:AWDParser.PROPERTY_NUMBER,\r\n\t\t102:AWDParser.PROPERTY_NUMBER,\r\n\t\t103:AWDParser.PROPERTY_NUMBER,\r\n\t\t201:AWDParser.UINT32,\r\n\t\t202:AWDParser.UINT32,\r\n\t\t301:AWDParser.UINT16,\r\n\t\t302:AWDParser.UINT16,\r\n\t\t401:AWDParser.UINT8,\r\n\t\t402:AWDParser.UINT8,\r\n\t\t601:AWDParser.COLOR,\r\n\t\t602:AWDParser.COLOR,\r\n\t\t701:AWDParser.BOOL,\r\n\t\t702:AWDParser.BOOL,\r\n\t\t801:AWDParser.MTX4x4};\r\n\r\n\t// Block ID = 81 AWD2.1\r\n\tprivate parseMaterial_v1(blockID:number)\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar diffuseTexture:Single2DTexture;\r\n\t\tvar normalTexture:TextureBase;\r\n\t\tvar specTexture:TextureBase;\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar num_methods:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.material_v1Properties);\r\n\t\tvar spezialType:number = props.get(4, 0);\r\n\t\tvar debugString:string = \"Parsed Material \";\r\n\r\n\t\tif (spezialType >= 2) {//this is no supported material\r\n\t\t\tthis._blocks[blockID].addError(\"Material-spezialType '\" + spezialType + \"' is not supported, can only be 0:singlePass, 1:MultiPass !\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type <= 2) {// Color material\r\n\t\t\tif (this.materialMode == 1)\r\n\t\t\t\tspezialType = 0;\r\n\t\t\telse if (this.materialMode == 2)\r\n\t\t\t\tspezialType = 1;\r\n\r\n\t\t\tif (spezialType < 2) {//this is SinglePass or MultiPass\r\n\r\n\t\t\t\tif (type == 1) {// Color material\r\n\t\t\t\t\tvar color:number = props.get(1, 0xcccccc);//TODO temporarily swapped so that diffuse color goes to ambient\r\n\r\n\t\t\t\t\tif (spezialType == 1) {//\tMultiPassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(MultiPass): Name = '\" + name + \"' | \";\r\n\r\n\t\t\t\t\t} else { //\tSinglePassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (type == 2) {// texture material\r\n\t\t\t\t\tvar texture:Single2DTexture = <Single2DTexture> this._blocks[props.get(2, 0)].data;\r\n\r\n\t\t\t\t\tmat = new MethodMaterial(texture);\r\n\r\n\t\t\t\t\tif (spezialType == 1) {// MultiPassMaterial\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"'\" + (texture? \" | Texture-Name = \" + texture.name : \"\");\r\n\t\t\t\t\t} else {//\tSinglePassMaterial\r\n\t\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"'\" + (texture? \" | Texture-Name = \" + texture.name : \"\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdiffuseTexture = <Single2DTexture> this._blocks[props.get(17, 0)].data;\r\n\t\t\t\tnormalTexture = <TextureBase> this._blocks[props.get(3, 0)].data;\r\n\t\t\t\tspecTexture = <TextureBase> this._blocks[props.get(21, 0)].data;\r\n\t\t\t\tmat.lightPicker = <LightPickerBase> this._blocks[props.get(22, 0)].data;\r\n\t\t\t\tmat.smooth = props.get(5, true);\r\n\t\t\t\tmat.mipmap = props.get(6, true);\r\n\t\t\t\tmat.bothSides = props.get(7, false);\r\n\t\t\t\tmat.alphaPremultiplied = props.get(8, false);\r\n\t\t\t\tmat.blendMode = this.blendModeDic[props.get(9, 0)];\r\n\t\t\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\t\t\tif (diffuseTexture) {\r\n\t\t\t\t\tmat.diffuseTexture = diffuseTexture;\r\n\t\t\t\t\tdebugString += \" | DiffuseTexture-Name = \" + diffuseTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (normalTexture) {\r\n\t\t\t\t\tmat.normalMap = normalTexture;\r\n\t\t\t\t\tdebugString += \" | NormalTexture-Name = \" + normalTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (specTexture) {\r\n\t\t\t\t\tmat.specularMap = specTexture;\r\n\t\t\t\t\tdebugString += \" | SpecularTexture-Name = \" + specTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\t\tmat.ambient = props.get(15, 1.0);\r\n\t\t\t\tmat.diffuseColor = props.get(16, 0xffffff);\r\n\t\t\t\tmat.specular = props.get(18, 1.0);\r\n\t\t\t\tmat.gloss = props.get(19, 50);\r\n\t\t\t\tmat.specularColor = props.get(20, 0xffffff);\r\n\r\n\t\t\t\tfor (var methods_parsed:number = 0; methods_parsed < num_methods; methods_parsed++) {\r\n\t\t\t\t\tvar method_type:number;\r\n\t\t\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t\tprops = this.parseProperties(AWDParser.method_v1Properties);\r\n\r\n\t\t\t\t\tswitch (method_type) {\r\n\t\t\t\t\t\tcase 999: //wrapper-Methods that will load a previous parsed EffektMethod returned\r\n\t\t\t\t\t\t\tvar effectMethod:EffectMethodBase = <EffectMethodBase> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.addEffectMethod(effectMethod);\r\n\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + effectMethod.name;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 998: //wrapper-Methods that will load a previous parsed ShadowMapMethod\r\n\t\t\t\t\t\t\tvar shadowMapMethod:ShadowMapMethodBase = <ShadowMapMethodBase> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.shadowMethod = shadowMapMethod;\r\n\t\t\t\t\t\t\tdebugString += \" | ShadowMethod-Name = \" + shadowMapMethod.name;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 1: //EnvMapAmbientMethod\r\n\t\t\t\t\t\t\tvar cubeTexture:SingleCubeTexture = <SingleCubeTexture> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.ambientMethod = new AmbientEnvMapMethod();\r\n\t\t\t\t\t\t\tmat.texture = cubeTexture;\r\n\t\t\t\t\t\t\tdebugString += \" | AmbientEnvMapMethod | EnvMap-Name =\" + cubeTexture.name;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 51: //DepthDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseDepthMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseDepthMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 52: //GradientDiffuseMethod\r\n\t\t\t\t\t\t\tvar texture:Single2DTexture = <Single2DTexture> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseGradientMethod(texture);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseGradientMethod | GradientDiffuseTexture-Name =\" + texture.name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 53: //WrapDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseWrapMethod(props.get(101, 5));\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseWrapMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 54: //LightMapDiffuseMethod\r\n\t\t\t\t\t\t\tvar texture:Single2DTexture = <Single2DTexture> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseLightMapMethod(texture, this.blendModeDic[props.get(401, 10)], false, mat.diffuseMethod);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseLightMapMethod | LightMapTexture-Name =\" + texture.name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 55: //CelDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseCelMethod(props.get(401, 3), mat.diffuseMethod);\r\n\t\t\t\t\t\t\t(<DiffuseCelMethod> mat.diffuseMethod).smoothness = props.get(101, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 56: //SubSurfaceScatteringMethod\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseSubSurfaceMethod(); //depthMapSize and depthMapOffset ?\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scattering = props.get(101, 0.2);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).translucency = props.get(102, 1);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scatterColor = props.get(601, 0xffffff);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tdebugString += \" | DiffuseSubSurfaceMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 101: //AnisotropicSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularAnisotropicMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularAnisotropicMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 102: //SpecularPhongMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularPhongMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularPhongMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 103: //CellSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularCelMethod(props.get(101, 0.5), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularCelMethod> mat.specularMethod).smoothness = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 104: //SpecularFresnelMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularFresnelMethod(props.get(701, true), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).fresnelPower = props.get(101, 5);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).normalReflectance = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularFresnelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 151://HeightMapNormalMethod - thios is not implemented for now, but might appear later\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 152: //SimpleWaterNormalMethod\r\n\t\t\t\t\t\t\tvar texture:Single2DTexture = <Single2DTexture> this._blocks[props.get(1, 0)].data;\r\n\t\t\t\t\t\t\tmat.normalMap = texture;\r\n\t\t\t\t\t\t\tmat.normalMethod = new NormalSimpleWaterMethod(mat.normalMap, texture);\r\n\t\t\t\t\t\t\tdebugString += \" | NormalSimpleWaterMethod | Second-NormalTexture-Name = \" + texture.name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.parseUserAttributes();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: we should not need this anymore (if using texture-atlas)\r\n\t\telse if ((type>=3)&&(type<=7)){\r\n\t\t\t// if this is a basic material, we create it, finalize it, assign it to block-cache and return and return.\r\n\t\t\tvar color:number = props.get(1, 0xcccccc);\r\n\t\t\tdebugString+=color;\r\n\t\t\r\n\t\t\tvar diffuseTexture:Single2DTexture = <Single2DTexture> this._blocks[props.get(2, 0)].data;\r\n\t\t\tvar basic_mat:BasicMaterial = new BasicMaterial(diffuseTexture);\r\n\t\t\tbasic_mat.bothSides = true;\r\n\t\t\tbasic_mat.preserveAlpha = true;\r\n\t\t\tbasic_mat.alphaBlending = true;\r\n\t\t\tbasic_mat.extra = this.parseUserAttributes();\r\n\t\t\tthis._pFinalizeAsset(<IAsset> basic_mat, name);\r\n\t\t\tthis._blocks[blockID].data = basic_mat;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(debugString);\r\n\t\t\treturn;\r\n\t\t\r\n\t\t}\r\n\t\tmat.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\r\n\t\tthis._blocks[blockID].data = mat;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(debugString);\r\n\t}\r\n\r\n\t//Block ID = 82\r\n\tprivate parseTexture(blockID:number)\r\n\t{\r\n\r\n\t\tvar asset:TextureBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\tthis._texture_users[this._cur_block_id] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tvar url:string = this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedInt());\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true);\r\n\r\n\t\t} else {\r\n\t\t\tvar data_len:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar data:ByteArray = new ByteArray(data_len);\r\n\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t//this._pAddDependency(this._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Start parsing a \" + [\"external\", \"embed\"][type] + \" Bitmap for Texture\");\r\n\t}\r\n\r\n\t//Block ID = 83\r\n\tprivate parseCubeTexture(blockID:number)\r\n\t{\r\n\t\t//blockLength = block.len;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:SingleCubeTexture;\r\n\t\tvar i:number;\r\n\r\n\t\tthis._texture_users[ this._cur_block_id ] = [];\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tthis._texture_users[this._cur_block_id] = [];\r\n\r\n\t\t\t// External\r\n\t\t\tif (type == 0) {\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar url:string;\r\n\t\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true, i);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar data:ByteArray = new ByteArray(data_len);\r\n\t\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true, i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Start parsing 6 \" + [\"external\", \"embed\"][type] + \" Bitmaps for CubeTexture\");\r\n\t}\r\n\r\n\t//Block ID = 91\r\n\tprivate parseSharedMethodBlock(blockID:number)\r\n\t{\r\n\t\tvar asset:EffectMethodBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\t\tasset = this.parseSharedMethodList(blockID);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a EffectMethod: Name = \" + asset.name + \" Type = \" + asset);\r\n\t}\r\n\r\n\t//Block ID = 92\r\n\tprivate parseShadowMethodBlock(blockID:number)\r\n\t{\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\t\tvar light:LightBase = <LightBase> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar asset:ShadowMethodBase = this.parseShadowMethodList(light, blockID);\r\n\r\n\t\tif (!asset)\r\n\t\t\treturn;\r\n\r\n\t\tthis.parseUserAttributes(); // Ignore for now\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a ShadowMapMethodMethod: Name = \" + asset.name + \" | Type = \" + asset + \" | Light-Name = \", light.name);\r\n\t}\r\n\r\n\tprivate static commandProperties:Object = {\r\n\t\t1:AWDParser.BADDR};\r\n\r\n\tprivate static targetProperties:Object = {\r\n\t\t1:AWDParser.MATRIX_NUMBER,\r\n\t\t2:AWDParser.MATRIX_NUMBER,\r\n\t\t3:AWDParser.MATRIX_NUMBER,\r\n\t\t4:AWDParser.UINT8};\r\n\t\r\n\t//Block ID = 253\r\n\tprivate parseCommand(blockID:number)\r\n\t{\r\n\t\tvar hasBlocks:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tvar parentObject:DisplayObjectContainer = <DisplayObjectContainer> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\tvar targetObject:DisplayObjectContainer;\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar numCommands:number = this._newBlockBytes.readShort();\r\n\t\tvar typeCommand:number = this._newBlockBytes.readShort();\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.commandProperties);\r\n\r\n\t\tswitch (typeCommand) {\r\n\t\t\tcase 1:\r\n\t\t\t\ttargetObject = this._blocks[props.get(1, 0)].data;\r\n\t\t\t\ttargetObject.transform.matrix3D = mtx;\r\n\r\n\t\t\t\tif (parentObject)\r\n\t\t\t\t\tparentObject.addChild(targetObject);\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (targetObject) {\r\n\t\t\tprops = this.parseProperties(AWDParser.targetProperties);\r\n\r\n\t\t\ttargetObject.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\ttargetObject.extra = this.parseUserAttributes();\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].data = targetObject;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a CommandBlock: Name = '\" + name);\r\n\t}\r\n\t\r\n\tprivate static metaDataProperties:Object = {\r\n\t\t1:AWDParser.UINT32,\r\n\t\t2:AWDParser.AWDSTRING,\r\n\t\t3:AWDParser.AWDSTRING,\r\n\t\t4:AWDParser.AWDSTRING,\r\n\t\t5:AWDParser.AWDSTRING};\r\n\r\n\t//blockID 255\r\n\tprivate parseMetaData(blockID:number)\r\n\t{\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.metaDataProperties);\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a MetaDataBlock: TimeStamp         = \" + props.get(1, 0));\r\n\t\t\tconsole.log(\"                        EncoderName       = \" + props.get(2, \"unknown\"));\r\n\t\t\tconsole.log(\"                        EncoderVersion    = \" + props.get(3, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorName     = \" + props.get(4, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorVersion  = \" + props.get(5, \"unknown\"));\r\n\t\t}\r\n\t}\r\n\r\n\t//blockID 254\r\n\tprivate parseNameSpace(blockID:number)\r\n\t{\r\n\t\tvar id:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar nameSpaceString:string = this.parseVarStr();\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a NameSpaceBlock: ID = \" + id + \" | String = \" + nameSpaceString);\r\n\t}\r\n\r\n\t//--Parser UTILS---------------------------------------------------------------------------\r\n\r\n\tprivate shadowMethodListProperties:Object = {\r\n\t\t1:AWDParser.BADDR,\r\n\t\t2:AWDParser.BADDR,\r\n\t\t3:AWDParser.BADDR,\r\n\t\t101:AWDParser.PROPERTY_NUMBER,\r\n\t\t102:AWDParser.PROPERTY_NUMBER,\r\n\t\t103:AWDParser.PROPERTY_NUMBER,\r\n\t\t201:AWDParser.UINT32,\r\n\t\t202:AWDParser.UINT32,\r\n\t\t301:AWDParser.UINT16,\r\n\t\t302:AWDParser.UINT16,\r\n\t\t401:AWDParser.UINT8,\r\n\t\t402:AWDParser.UINT8,\r\n\t\t601:AWDParser.COLOR,\r\n\t\t602:AWDParser.COLOR,\r\n\t\t701:AWDParser.BOOL,\r\n\t\t702:AWDParser.BOOL,\r\n\t\t801:AWDParser.MTX4x4}\r\n\t\r\n\t// this functions reads and creates a ShadowMethodMethod\r\n\tprivate parseShadowMethodList(light:LightBase, blockID:number):ShadowMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar shadowMethod:ShadowMethodBase;\r\n\t\tvar props:AWDProperties = this.parseProperties(this.shadowMethodListProperties);\r\n\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>\r\n\t\tswitch (methodType) {\r\n\t\t\t//\t\t\t\tcase 1001: //CascadeShadowMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this CascadeShadowMapMethod - ShadowMethod not created\");\r\n\t\t\t//\t\t\t\t\t\treturn shadowMethod;\r\n\t\t\t//\t\t\t\t\t}\r\n\t\t\t//\t\t\t\t\tshadowMethod = new CascadeShadowMapMethod(returnedArray[1]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 1002: //ShadowNearMethod\r\n\t\t\t\tshadowMethod = new ShadowNearMethod(<ShadowMethodBase> this._blocks[props.get(1, 0)].data);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1101: //ShadowFilteredMethod\r\n\t\t\t\tshadowMethod = new ShadowFilteredMethod(<DirectionalLight> light);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1102: //ShadowDitheredMethod\r\n\t\t\t\tshadowMethod = new ShadowDitheredMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1103: //ShadowSoftMethod\r\n\t\t\t\tshadowMethod = new ShadowSoftMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1104: //ShadowHardMethod\r\n\t\t\t\tshadowMethod = new ShadowHardMethod(light);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn shadowMethod;\r\n\t}\r\n\r\n\t//Block ID 101\r\n\tprivate parseSkeleton(blockID:number /*uint*/)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar skeleton:Skeleton = new Skeleton();\r\n\t\tthis.parseProperties(null); // Discard properties for now\r\n\r\n\t\tfor (var joints_parsed:number = 0; joints_parsed < num_joints; joints_parsed++) {\r\n\t\t\tvar joint:SkeletonJoint;\r\n\t\t\tvar ibp:Matrix3D;\r\n\t\t\t// Ignore joint id\r\n\t\t\tthis._newBlockBytes.readUnsignedShort();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.parentIndex = this._newBlockBytes.readUnsignedShort() - 1; // 0=null in AWD\r\n\t\t\tjoint.name = this.parseVarStr();\r\n\r\n\t\t\tibp = this.parseMatrix3D();\r\n\t\t\tjoint.inverseBindPose = ibp.rawData;\r\n\t\t\t// Ignore joint props/attributes for now\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tskeleton.joints.push(joint);\r\n\t\t}\r\n\r\n\t\t// Discard attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(skeleton, name);\r\n\r\n\t\tthis._blocks[blockID].data = skeleton;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skeleton: Name = \" + skeleton.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//Block ID = 102\r\n\tprivate parseSkeletonPose(blockID:number /*uint*/)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar pose:SkeletonPose = new SkeletonPose();\r\n\r\n\t\tfor (var joints_parsed:number = 0; joints_parsed < num_joints; joints_parsed++) {\r\n\t\t\tvar joint_pose:JointPose;\r\n\t\t\tvar has_transform:number /*uint*/;\r\n\t\t\tjoint_pose = new JointPose();\r\n\t\t\thas_transform = this._newBlockBytes.readUnsignedByte();\r\n\t\t\tif (has_transform == 1) {\r\n\t\t\t\tvar mtx_data:Float32Array = this.parseMatrix43RawData();\r\n\r\n\t\t\t\tvar mtx:Matrix3D = new Matrix3D(mtx_data);\r\n\t\t\t\tjoint_pose.orientation.fromMatrix(mtx);\r\n\t\t\t\tjoint_pose.translation.copyFrom(mtx.position);\r\n\r\n\t\t\t\tpose.jointPoses[joints_parsed] = joint_pose;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Skip attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(pose, name);\r\n\r\n\t\tthis._blocks[blockID].data = pose;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonPose: Name = \" + pose.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//blockID 103\r\n\tprivate parseSkeletonAnimation(blockID:number /*uint*/)\r\n\t{\r\n\t\tvar frame_dur:number;\r\n\t\tvar pose_id:number;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar clip:SkeletonClipNode = new SkeletonClipNode();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tfor (var frames_parsed:number = 0; frames_parsed < num_frames; frames_parsed++) {\r\n\t\t\tpose_id = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tclip.addFrame(<SkeletonPose> this._blocks[pose_id].data, frame_dur);\r\n\t\t}\r\n\t\tif (clip.frames.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not this SkeletonClipNode, because no Frames where set.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Ignore attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\t\tthis._blocks[blockID].data = clip;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonClipNode: Name = \" + clip.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\t\r\n\tprivate meshPoseAnimationProperties:Object = {\r\n\t\t1:AWDParser.BOOL,\r\n\t\t2:AWDParser.BOOL};\r\n\r\n\t//Block ID = 111 /  Block ID = 112\r\n\tprivate parseMeshPoseAnimation(blockID:number /*uint*/, poseOnly:boolean = false)\r\n\t{\r\n\t\tvar subMeshParsed:number /*uint*/;\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\t\tvar z:number;\r\n\t\tvar str_len:number;\r\n\t\tvar str_end:number;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar idx:number /*int*/ = 0;\r\n\t\tvar clip:VertexClipNode = new VertexClipNode();\r\n\t\tvar indices:Short3Attributes;\r\n\t\tvar verts:Array<number>;\r\n\t\tvar streamtypes:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar geo_id:number /*int*/ = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar geometry:Geometry = <Geometry> this._blocks[geo_id].data;\r\n\r\n\t\tvar uvs:Array<Float32Array> = this.getUVForVertexAnimation(geo_id);\r\n\r\n\t\tvar num_frames:number = (!poseOnly)? this._newBlockBytes.readUnsignedShort() : 1;\r\n\r\n\t\tvar num_submeshes:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar num_Streams:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (var streamsParsed:number = 0; streamsParsed < num_Streams; streamsParsed++)\r\n\t\t\tstreamtypes.push(this._newBlockBytes.readUnsignedShort());\r\n\r\n\t\tprops = this.parseProperties(this.meshPoseAnimationProperties);\r\n\r\n\t\tclip.looping = props.get(1, true);\r\n\t\tclip.stitchFinalFrame = props.get(2, false);\r\n\r\n\t\tvar frame_dur:number;\r\n\t\tfor (var frames_parsed:number = 0; frames_parsed < num_frames; frames_parsed++) {\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tsubMeshParsed = 0;\r\n\t\t\twhile (subMeshParsed < num_submeshes) {\r\n\t\t\t\tstreamsParsed = 0;\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\t\t\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\t\t\tif (streamtypes[streamsParsed] == 1) {\r\n\t\t\t\t\t\tindices = geometry.subGeometries[subMeshParsed].indices;\r\n\t\t\t\t\t\tverts = new Array<number>();\r\n\t\t\t\t\t\tidx = 0;\r\n\t\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\t\tz = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubGeom = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\t\t\t\tsubGeom.setIndices(indices);\r\n\t\t\t\t\t\tsubGeom.setPositions(verts);\r\n\t\t\t\t\t\tsubGeom.setUVs(uvs[subMeshParsed]);\r\n\t\t\t\t\t\tsubGeom.setNormals(null);\r\n\t\t\t\t\t\tsubGeom.setTangents(null);\r\n\t\t\t\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\t\t\t\tsubGeom.autoDeriveTangents = false;\r\n\t\t\t\t\t\tsubMeshParsed++;\r\n\t\t\t\t\t\tgeometry.addSubGeometry(subGeom)\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t\tstreamsParsed++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, frame_dur);\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\r\n\t\tthis._blocks[blockID].data = clip;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a VertexClipNode: Name = \" + clip.name + \" | Target-Geometry-Name = \" + geometry.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\tprivate static vertexAnimationSetProperties:Object = {\r\n\t\t1:AWDParser.UINT16};\r\n\t\r\n\t//BlockID 113\r\n\tprivate parseVertexAnimationSet(blockID:number /*uint*/)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.vertexAnimationSetProperties);\r\n\t\tvar skeletonFrames:Array<SkeletonClipNode> = new Array<SkeletonClipNode>();\r\n\t\tvar vertexFrames:Array<VertexClipNode> = new Array<VertexClipNode>();\r\n\t\tvar clipNode:AnimationClipNodeBase;\r\n\t\tfor (var frames_parsed:number = 0; frames_parsed < num_frames; frames_parsed++) {\r\n\t\t\tclipNode = <AnimationClipNodeBase> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\t\t\tif (clipNode instanceof VertexClipNode)\r\n\t\t\t\tvertexFrames.push(<VertexClipNode> clipNode);\r\n\t\t\telse if (clipNode instanceof SkeletonClipNode)\r\n\t\t\t\tskeletonFrames.push(<SkeletonClipNode> clipNode);\r\n\t\t}\r\n\r\n\t\tif ((vertexFrames.length == 0) && (skeletonFrames.length == 0)) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this AnimationSet, because it contains no animations\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tif (vertexFrames.length > 0) {\r\n\t\t\tvar newVertexAnimationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\r\n\t\t\tfor (var i:number /*int*/ = 0; i < vertexFrames.length; i++)\r\n\t\t\t\tnewVertexAnimationSet.addAnimation(vertexFrames[i]);\r\n\r\n\t\t\tthis._pFinalizeAsset(newVertexAnimationSet, name);\r\n\r\n\t\t\tthis._blocks[blockID].data = newVertexAnimationSet;\r\n\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a VertexAnimationSet: Name = \" + name + \" | Animations = \" + newVertexAnimationSet.animations.length + \" | Animation-Names = \" + newVertexAnimationSet.animationNames);\r\n\r\n\t\t} else if (skeletonFrames.length > 0) {\r\n\t\t\tvar newSkeletonAnimationSet:SkeletonAnimationSet = new SkeletonAnimationSet(props.get(1, 4)); //props.get(1,4));\r\n\t\t\tfor (var i:number /*int*/ = 0; i < skeletonFrames.length; i++)\r\n\t\t\t\tnewSkeletonAnimationSet.addAnimation(skeletonFrames[i]);\r\n\t\t\tthis._pFinalizeAsset(newSkeletonAnimationSet, name);\r\n\r\n\t\t\tthis._blocks[blockID].data = newSkeletonAnimationSet;\r\n\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a SkeletonAnimationSet: Name = \" + name + \" | Animations = \" + newSkeletonAnimationSet.animations.length + \" | Animation-Names = \" + newSkeletonAnimationSet.animationNames);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static animatorSetProperties:Object = {1:AWDParser.BADDR};\r\n\t\r\n\t//BlockID 122\r\n\tprivate parseAnimatorSet(blockID:number /*uint*/)\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.parseProperties(AWDParser.animatorSetProperties);\r\n\t\tvar targetAnimationSet:AnimationSetBase = <AnimationSetBase> this._blocks[this._newBlockBytes.readUnsignedInt()].data;\r\n\r\n\t\tvar targetMeshes:Array<Mesh> = new Array<Mesh>();\r\n\t\tvar targetMeshLength:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (var i:number /*int*/ = 0; i < targetMeshLength; i++)\r\n\t\t\ttargetMeshes.push(<Mesh> this._blocks[this._newBlockBytes.readUnsignedInt()].data);\r\n\r\n\t\tvar activeState:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar autoplay:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tvar thisAnimator:AnimatorBase;\r\n\t\tif (type == 1)\r\n\t\t\tthisAnimator = new SkeletonAnimator(<SkeletonAnimationSet> targetAnimationSet, <Skeleton> this._blocks[props.get(1, 0)].data);\r\n\t\telse if (type == 2)\r\n\t\t\tthisAnimator = new VertexAnimator(<VertexAnimationSet> targetAnimationSet);\r\n\r\n\t\tthis._pFinalizeAsset(thisAnimator, name);\r\n\t\tthis._blocks[blockID].data = thisAnimator;\r\n\r\n\t\tfor (i = 0; i < targetMeshes.length; i++) {\r\n\t\t\tif (type == 1)\r\n\t\t\t\ttargetMeshes[i].animator = (<SkeletonAnimator> thisAnimator);\r\n\t\t\telse if (type == 2)\r\n\t\t\t\ttargetMeshes[i].animator = (<VertexAnimator> thisAnimator);\r\n\t\t}\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Animator: Name = \" + name);\r\n\t}\r\n\r\n\tprivate sharedMethodListProperties:Object = {\r\n\t\t1:AWDParser.BADDR,\r\n\t\t2:AWDParser.BADDR,\r\n\t\t3:AWDParser.BADDR,\r\n\t\t101:AWDParser.PROPERTY_NUMBER,\r\n\t\t102:AWDParser.PROPERTY_NUMBER,\r\n\t\t103:AWDParser.PROPERTY_NUMBER,\r\n\t\t104:AWDParser.PROPERTY_NUMBER,\r\n\t\t105:AWDParser.PROPERTY_NUMBER,\r\n\t\t106:AWDParser.PROPERTY_NUMBER,\r\n\t\t107:AWDParser.PROPERTY_NUMBER,\r\n\t\t201:AWDParser.UINT32,\r\n\t\t202:AWDParser.UINT32,\r\n\t\t301:AWDParser.UINT16,\r\n\t\t302:AWDParser.UINT16,\r\n\t\t401:AWDParser.UINT8,\r\n\t\t402:AWDParser.UINT8,\r\n\t\t601:AWDParser.COLOR,\r\n\t\t602:AWDParser.COLOR,\r\n\t\t701:AWDParser.BOOL,\r\n\t\t702:AWDParser.BOOL};\r\n\r\n\t// this functions reads and creates a EffectMethod\r\n\tprivate parseSharedMethodList(blockID:number):EffectMethodBase\r\n\t{\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar effectMethodReturn:EffectMethodBase;\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties(this.sharedMethodListProperties);\r\n\r\n\t\tswitch (methodType) {\r\n\t\t\t// Effect Methods\r\n\t\t\tcase 401: //ColorMatrix\r\n\t\t\t\teffectMethodReturn = new EffectColorMatrixMethod(props.get(101, new Array(0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 402: //ColorTransform\r\n\t\t\t\teffectMethodReturn = new EffectColorTransformMethod();\r\n\t\t\t\tvar offCol:number /*uint*/ = props.get(601, 0x00000000);\r\n\t\t\t\t(<EffectColorTransformMethod> effectMethodReturn).colorTransform = new ColorTransform(props.get(102, 1), props.get(103, 1), props.get(104, 1), props.get(101, 1), ((offCol >> 16) & 0xFF), ((offCol >> 8) & 0xFF), (offCol & 0xFF), ((offCol >> 24) & 0xFF));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 403: //EnvMap\r\n\t\t\t\teffectMethodReturn = new EffectEnvMapMethod(<SingleCubeTexture> this._blocks[props.get(1, 0)].data, <number> props.get(101, 1));\r\n\t\t\t\tvar targetID:number = props.get(2, 0);\r\n\t\t\t\tif (targetID > 0) {\r\n\t\t\t\t\t// Todo: test mask with EnvMapMethod\r\n\t\t\t\t\t//(<EnvMapMethod> effectMethodReturn).mask = <TextureBase> this._blocks[targetID].data;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 404: //LightMapMethod\r\n\t\t\t\teffectMethodReturn = new EffectLightMapMethod(this._blocks[props.get(1, 0)].data, this.blendModeDic[props.get(401, 10)]); //usesecondaryUV not set\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 405: //ProjectiveTextureMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureProjector.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the TextureProjector (ID = \" + targetID + \" ) for this ProjectiveTextureMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new ProjectiveTextureMethod(returnedArray[1], blendModeDic[props.get(401, 10)]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 406: //RimLightMethod\r\n\t\t\t\teffectMethodReturn = new EffectRimLightMethod(props.get(601, 0xffffff), props.get(101, 0.4), props.get(101, 2)); //blendMode\r\n\t\t\t\tbreak;\r\n\t\t\tcase 407: //AlphaMaskMethod\r\n\t\t\t\teffectMethodReturn = new EffectAlphaMaskMethod(this._blocks[props.get(1, 0)].data, props.get(701, false));\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 408: //RefractionEnvMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this RefractionEnvMapMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new RefractionEnvMapMethod(returnedArray[1], props.get(101, 0.1), props.get(102, 0.01), props.get(103, 0.01), props.get(104, 0.01));\r\n\t\t\t//\t\t\t\t\tRefractionEnvMapMethod(effectMethodReturn).alpha = props.get(104, 1);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 409: //OutlineMethod\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new OutlineMethod(props.get(601, 0x00000000), props.get(101, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 410: //FresnelEnvMapMethod\r\n\t\t\t\teffectMethodReturn = new EffectFresnelEnvMapMethod(this._blocks[props.get(1, 0)].data, props.get(101, 1));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 411: //FogMethod\r\n\t\t\t\teffectMethodReturn = new EffectFogMethod(props.get(101, 0), props.get(102, 1000), props.get(601, 0x808080));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn effectMethodReturn;\r\n\r\n\t}\r\n\r\n\tprivate parseUserAttributes():Object\r\n\t{\r\n\t\tvar list_len:number = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tif (list_len > 0) {\r\n\t\t\tvar list_end:number = this._newBlockBytes.position + list_len;\r\n\t\t\tvar attributes:Object = {};\r\n\r\n\t\t\tfor (var attibuteCnt:number = 0; this._newBlockBytes.position < list_end; attibuteCnt++) {\r\n\t\t\t\tvar ns_id:number;\r\n\t\t\t\tvar attr_key:string;\r\n\t\t\t\tvar attr_type:number;\r\n\t\t\t\tvar attr_len:number;\r\n\t\t\t\tvar attr_val:any;\r\n\r\n\t\t\t\t// TODO: Properly tend to namespaces in attributes\r\n\t\t\t\tns_id = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_key = this.parseVarStr();\r\n\t\t\t\tattr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + attr_len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading attribute # \" + attibuteCnt + \" = skipped to end of attribute-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (attr_type) {\r\n\t\t\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUTFBytes(attr_len);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.BOOL:\r\n\t\t\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT32:\r\n\t\t\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readDouble();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tattr_val = 'unimplemented attribute type ' + attr_type;\r\n\t\t\t\t\t\tthis._newBlockBytes.position += attr_len;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes[attr_key] = attr_val;\r\n\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"attribute = name: \" + attr_key + \"  / value = \" + attr_val);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\tprivate parseProperties(expected:Object):AWDProperties\r\n\t{\r\n\t\tvar list_len:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar props:AWDProperties = new AWDProperties();\r\n\t\tvar list_end:number = this._newBlockBytes.position + list_len;\r\n\r\n\t\tif (expected) {\r\n\t\t\tvar len:number;\r\n\t\t\tvar key:number;\r\n\t\t\tvar type:number;\r\n\r\n\t\t\tfor (var propertyCnt:number = 0; this._newBlockBytes.position < list_end; propertyCnt++) {\r\n\t\t\t\tkey = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\tlen = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading property # \" + propertyCnt + \" = skipped to end of propertie-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn props;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (expected[key]) {\r\n\t\t\t\t\ttype = expected[key];\r\n\t\t\t\t\tprops.set(key, this.parseAttrValue(type, len));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\t}\r\n\r\n\tprivate parseAttrValue(type:number, len:number):any\r\n\t{\r\n\t\tvar elem_len:number;\r\n\t\tvar read_func:Function;\r\n\t\tvar accuracy:boolean;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase AWDParser.BOOL:\r\n\t\t\tcase AWDParser.INT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT32:\r\n\t\t\tcase AWDParser.COLOR:\r\n\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\r\n\t\t\tcase AWDParser.VECTOR2x1:\r\n\t\t\tcase AWDParser.VECTOR3x1:\r\n\t\t\tcase AWDParser.VECTOR4x1:\r\n\t\t\tcase AWDParser.MTX3x2:\r\n\t\t\tcase AWDParser.MTX3x3:\r\n\t\t\tcase AWDParser.MTX4x3:\r\n\t\t\tcase AWDParser.MTX4x4:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\t\t\tcase AWDParser.GEO_NUMBER:\r\n\t\t\t\taccuracy = this._accuracyGeo;\r\n\t\t\tcase AWDParser.MATRIX_NUMBER:\r\n\t\t\t\taccuracy = this._accuracyMatrix;\r\n\t\t\tcase AWDParser.PROPERTY_NUMBER:\r\n\t\t\t\taccuracy = this._accuracyProps;\r\n\t\t\tdefault:\r\n\t\t\t\tif (accuracy) {\r\n\t\t\t\t\telem_len = 8;\r\n\t\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\t} else {\r\n\t\t\t\t\telem_len = 4;\r\n\t\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (elem_len < len) {\r\n\t\t\tvar list:Array<any> = [];\r\n\t\t\tvar num_elems:number = len/elem_len;\r\n\r\n\t\t\tfor (var num_read:number = 0; num_read < num_elems; num_read++)\r\n\t\t\t\tlist[num_read] = read_func.call(this._newBlockBytes);\r\n\r\n\t\t\treturn list;\r\n\t\t} else {\r\n\t\t\treturn read_func.call(this._newBlockBytes);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseHeader()\r\n\t{\r\n\t\tthis._byteData.position = 3; // Skip magic string and parse version\r\n\r\n\t\tthis._version[0] = this._byteData.readUnsignedByte();\r\n\t\tthis._version[1] = this._byteData.readUnsignedByte();\r\n\r\n\t\tvar flags:number = this._byteData.readUnsignedShort(); // Parse bit flags\r\n\r\n\t\tthis._streaming = BitFlags.test(flags, BitFlags.FLAG1);\r\n\r\n\t\t// if we set _accuracyOnBlocks, the precision-values are read from each block-header.\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\t}\r\n\r\n\t\tthis._compression = this._byteData.readUnsignedByte(); // compression\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Import AWDFile of version = \" + this._version[0] + \" - \" + this._version[1]);\r\n\t\t\tconsole.log(\"Global Settings = Compression = \" + this._compression + \" | Streaming = \" + this._streaming + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\t\t}\r\n\r\n\t\t// Check file integrity\r\n\t\tvar body_len:number = this._byteData.readUnsignedInt();\r\n\t\tif (!this._streaming && body_len != this._byteData.getBytesAvailable())\r\n\t\t\tthis._pDieWithError('AWD2 body length does not match header integrity field');\r\n\r\n\t}\r\n\t// Helper - functions\r\n\tprivate getUVForVertexAnimation(meshID:number /*uint*/):Array<Float32Array>\r\n\t{\r\n\t\tif (this._blocks[meshID].data instanceof Mesh)\r\n\t\t\tmeshID = this._blocks[meshID].geoID;\r\n\r\n\t\tif (this._blocks[meshID].uvsForVertexAnimation)\r\n\t\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\r\n\t\tvar geometry:Geometry = (<Geometry> this._blocks[meshID].data);\r\n\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\tvar uvsForVertexAnimation:Array<Float32Array> = this._blocks[meshID].uvsForVertexAnimation = new Array<Float32Array>();\r\n\r\n\t\tvar len:number = geometry.subGeometries.length;\r\n\t\tfor (var geoCnt:number= 0; geoCnt < len; geoCnt++) {\r\n\t\t\tsub_geom = <TriangleSubGeometry> geometry.subGeometries[geoCnt];\r\n\t\t\tuvsForVertexAnimation[geoCnt] = sub_geom.uvs.get(sub_geom.numVertices);\r\n\t\t}\r\n\r\n\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t}\r\n\r\n\tprivate parseVarStr():string\r\n\t{\r\n\t\treturn this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort());\r\n\t}\r\n\r\n\tprivate readNumber(precision:boolean = false):number\r\n\t{\r\n\t\tif (precision)\r\n\t\t\treturn this._newBlockBytes.readDouble();\r\n\r\n\t\treturn this._newBlockBytes.readFloat();\r\n\t}\r\n\r\n\tprivate parseMatrix3D():Matrix3D\r\n\t{\r\n\t\treturn new Matrix3D(this.parseMatrix43RawData());\r\n\t}\r\n\r\n\tprivate parseMatrix32RawData():Array<number>\r\n\t{\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(6);\r\n\r\n\t\tfor (var i:number = 0; i < 6; i++)\r\n\t\t\tmtx_raw[i] = this._newBlockBytes.readFloat();\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n\tprivate parseMatrix43RawData():Float32Array\r\n\t{\r\n\t\tvar mtx_raw:Float32Array = new Float32Array(16);\r\n\r\n\t\tmtx_raw[0] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[1] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[2] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[3] = 0.0;\r\n\t\tmtx_raw[4] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[5] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[6] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[7] = 0.0;\r\n\t\tmtx_raw[8] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[9] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[10] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[11] = 0.0;\r\n\t\tmtx_raw[12] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[13] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[14] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[15] = 1.0;\r\n\r\n\t\t//TODO: fix max exporter to remove NaN values in joint 0 inverse bind pose\r\n\r\n\t\tif (isNaN(mtx_raw[0])) {\r\n\t\t\tmtx_raw[0] = 1;\r\n\t\t\tmtx_raw[1] = 0;\r\n\t\t\tmtx_raw[2] = 0;\r\n\t\t\tmtx_raw[4] = 0;\r\n\t\t\tmtx_raw[5] = 1;\r\n\t\t\tmtx_raw[6] = 0;\r\n\t\t\tmtx_raw[8] = 0;\r\n\t\t\tmtx_raw[9] = 0;\r\n\t\t\tmtx_raw[10] = 1;\r\n\t\t\tmtx_raw[12] = 0;\r\n\t\t\tmtx_raw[13] = 0;\r\n\t\t\tmtx_raw[14] = 0;\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n}\r\n\r\nexport = AWDParser;\r\n\r\n\r\nclass AWDProperties\r\n{\r\n\tpublic set(key:number, value:any)\r\n\t{\r\n\t\tthis[key] = value;\r\n\t}\r\n\r\n\tpublic get(key:number, fallback:any):any\r\n\t{\r\n\t\treturn (this[key] || fallback);\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BitFlags\r\n{\r\n\tpublic static FLAG1:number = 1;\r\n\tpublic static FLAG2:number = 2;\r\n\tpublic static FLAG3:number = 4;\r\n\tpublic static FLAG4:number = 8;\r\n\tpublic static FLAG5:number = 16;\r\n\tpublic static FLAG6:number = 32;\r\n\tpublic static FLAG7:number = 64;\r\n\tpublic static FLAG8:number = 128;\r\n\tpublic static FLAG9:number = 256;\r\n\tpublic static FLAG10:number = 512;\r\n\tpublic static FLAG11:number = 1024;\r\n\tpublic static FLAG12:number = 2048;\r\n\tpublic static FLAG13:number = 4096;\r\n\tpublic static FLAG14:number = 8192;\r\n\tpublic static FLAG15:number = 16384;\r\n\tpublic static FLAG16:number = 32768;\r\n\r\n\tpublic static test(flags:number, testFlag:number):boolean\r\n\t{\r\n\t\treturn (flags & testFlag) == testFlag;\r\n\t}\r\n}\r\n",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * MD2Parser provides a parser for the MD2 data type.\r\n */\r\nclass MD2Parser extends ParserBase\r\n{\r\n\tpublic static FPS:number /*int*/ = 6;\r\n\r\n\tprivate _clipNodes:Object = new Object();\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _parsedHeader:boolean;\r\n\tprivate _parsedUV:boolean;\r\n\tprivate _parsedFaces:boolean;\r\n\tprivate _parsedFrames:boolean;\r\n\r\n\tprivate _ident:number /*uint*/;\r\n\tprivate _version:number /*uint*/;\r\n\tprivate _skinWidth:number /*uint*/;\r\n\tprivate _skinHeight:number /*uint*/;\r\n\t//private _frameSize : number /*uint*/;\r\n\tprivate _numSkins:number /*uint*/;\r\n\tprivate _numVertices:number /*uint*/;\r\n\tprivate _numST:number /*uint*/;\r\n\tprivate _numTris:number /*uint*/;\r\n\t//private _numGlCmds : number /*uint*/;\r\n\tprivate _numFrames:number /*uint*/;\r\n\tprivate _offsetSkins:number /*uint*/;\r\n\tprivate _offsetST:number /*uint*/;\r\n\tprivate _offsetTris:number /*uint*/;\r\n\tprivate _offsetFrames:number /*uint*/;\r\n\t//private _offsetGlCmds : number /*uint*/;\r\n\tprivate _offsetEnd:number /*uint*/;\r\n\r\n\tprivate _uvIndices:Array<number>;\r\n\tprivate _indices:Array<number> /*uint*/;\r\n\tprivate _vertIndices:Array<number>;\r\n\r\n\t// the current subgeom being built\r\n\tprivate _animationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\tprivate _firstSubGeom:TriangleSubGeometry;\r\n\tprivate _uvs:Array<number>;\r\n\tprivate _finalUV:Array<number>;\r\n\r\n\tprivate _materialNames:Array<string>;\r\n\tprivate _textureType:string;\r\n\tprivate _ignoreTexturePath:boolean;\r\n\tprivate _mesh:Mesh;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate materialFinal:boolean = false;\r\n\tprivate geoCreated:boolean = false;\r\n\r\n\t/**\r\n\t * Creates a new MD2Parser object.\r\n\t * @param textureType The extension of the texture (e.g. jpg/png/...)\r\n\t * @param ignoreTexturePath If true, the path of the texture is ignored\r\n\t */\r\n\tconstructor(textureType:string = \"jpg\", ignoreTexturePath:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\t\tthis._textureType = textureType;\r\n\t\tthis._ignoreTexturePath = ignoreTexturePath;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md2\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 4) == 'IDP2');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.assets.length != 1)\r\n\t\t\treturn;\r\n\r\n\t\tvar asset:Single2DTexture = new Single2DTexture(<BitmapImage2D> resourceDependency.assets[0]);\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar material:MethodMaterial = new MethodMaterial(asset);\r\n\r\n\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\tmaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\tmaterial.name = this._mesh.material.name;\r\n\t\t\tthis._mesh.material = material;\r\n\t\t\tthis._pFinalizeAsset(material);\r\n\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t}\r\n\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// apply system default\r\n\t\tif (this.materialMode < 2) {\r\n\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t} else {\r\n\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t}\r\n\r\n\t\t//add to the content property\r\n\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\tthis.materialFinal = true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\r\n\t\t\t// Reset bytearray read position (which may have been\r\n\t\t\t// moved forward by the supportsData() function.)\r\n\t\t\tthis._byteData.position = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\tif (!this._parsedHeader) {\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\r\n\t\t\t\t// TODO: Create a mesh only when encountered (if it makes sense\r\n\t\t\t\t// for this file format) and return it using this._pFinalizeAsset()\r\n\t\t\t\tthis._geometry = new Geometry();\r\n\t\t\t\tthis._mesh = new Mesh(this._geometry, null);\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//_geometry.animation = new VertexAnimation(2, VertexAnimationMode.ABSOLUTE);\r\n\t\t\t\t//_animator = new VertexAnimator(VertexAnimationState(_mesh.animationState));\r\n\r\n\t\t\t\t// Parse header and decompress body\r\n\t\t\t\tthis.parseHeader();\r\n\t\t\t\tthis.parseMaterialNames();\r\n\t\t\t} else if (!this._parsedUV) {\r\n\t\t\t\tthis.parseUV();\r\n\t\t\t} else if (!this._parsedFaces) {\r\n\t\t\t\tthis.parseFaces();\r\n\t\t\t} else if (!this._parsedFrames) {\r\n\t\t\t\tthis.parseFrames();\r\n\t\t\t} else if ((this.geoCreated) && (this.materialFinal)) {\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t} else if (!this.geoCreated) {\r\n\t\t\t\tthis.geoCreated = true;\r\n\t\t\t\t//create default subgeometry\r\n\t\t\t\tthis._geometry.addSubGeometry(this._firstSubGeom.clone());\r\n\t\t\t\t// Force name to be chosen by this._pFinalizeAsset()\r\n\t\t\t\tthis._mesh.name = \"\";\r\n\t\t\t\tif (this.materialFinal) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\t}\r\n\r\n\t/**\r\n\t * Reads in all that MD2 Header data that is declared as private variables.\r\n\t * I know its a lot, and it looks ugly, but only way to do it in Flash\r\n\t */\r\n\tprivate parseHeader()\r\n\t{\r\n\t\tthis._ident = this._byteData.readInt();\r\n\t\tthis._version = this._byteData.readInt();\r\n\t\tthis._skinWidth = this._byteData.readInt();\r\n\t\tthis._skinHeight = this._byteData.readInt();\r\n\t\t//skip this._frameSize\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numSkins = this._byteData.readInt();\r\n\t\tthis._numVertices = this._byteData.readInt();\r\n\t\tthis._numST = this._byteData.readInt();\r\n\t\tthis._numTris = this._byteData.readInt();\r\n\t\t//skip this._numGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numFrames = this._byteData.readInt();\r\n\t\tthis._offsetSkins = this._byteData.readInt();\r\n\t\tthis._offsetST = this._byteData.readInt();\r\n\t\tthis._offsetTris = this._byteData.readInt();\r\n\t\tthis._offsetFrames = this._byteData.readInt();\r\n\t\t//skip this._offsetGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._offsetEnd = this._byteData.readInt();\r\n\r\n\t\tthis._parsedHeader = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the file names for the materials.\r\n\t */\r\n\tprivate parseMaterialNames()\r\n\t{\r\n\t\tvar url:string;\r\n\t\tvar name:string;\r\n\t\tvar extIndex:number /*int*/;\r\n\t\tvar slashIndex:number /*int*/;\r\n\t\tthis._materialNames = new Array<string>();\r\n\t\tthis._byteData.position = this._offsetSkins;\r\n\r\n\t\tvar regExp:RegExp = new RegExp(\"[^a-zA-Z0-9\\\\_\\/.]\", \"g\");\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numSkins; ++i) {\r\n\t\t\tname = this._byteData.readUTFBytes(64);\r\n\t\t\tname = name.replace(regExp, \"\");\r\n\t\t\textIndex = name.lastIndexOf(\".\");\r\n\t\t\tif (this._ignoreTexturePath)\r\n\t\t\t\tslashIndex = name.lastIndexOf(\"/\");\r\n\t\t\tif (name.toLowerCase().indexOf(\".jpg\") == -1 && name.toLowerCase().indexOf(\".png\") == -1) {\r\n\t\t\t\tname = name.substring(slashIndex + 1, extIndex);\r\n\t\t\t\turl = name + \".\" + this._textureType;\r\n\t\t\t} else {\r\n\t\t\t\turl = name;\r\n\t\t\t}\r\n\r\n\t\t\tthis._materialNames[i] = name;\r\n\r\n\t\t\t// only support 1 skin TODO: really?\r\n\t\t\tif (this.dependencies.length == 0)\r\n\t\t\t\tthis._pAddDependency(name, new URLRequest(url));\r\n\t\t}\r\n\r\n\t\tif (this._materialNames.length > 0)\r\n\t\t\tthis._mesh.material.name = this._materialNames[0]; else\r\n\t\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the uv data for the mesh.\r\n\t */\r\n\tprivate parseUV()\r\n\t{\r\n\t\tvar j:number /*uint*/ = 0;\r\n\r\n\t\tthis._uvs = new Array<number>(this._numST*2);\r\n\t\tthis._byteData.position = this._offsetST;\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numST; i++) {\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinWidth;\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinHeight;\r\n\t\t}\r\n\r\n\t\tthis._parsedUV = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses unique indices for the faces.\r\n\t */\r\n\tprivate parseFaces()\r\n\t{\r\n\t\tvar a:number /*uint*/, b:number /*uint*/, c:number /*uint*/, ta:number /*uint*/, tb:number /*uint*/, tc:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\r\n\t\tthis._vertIndices = new Array<number>();\r\n\t\tthis._uvIndices = new Array<number>();\r\n\t\tthis._indices = new Array<number>() /*uint*/;\r\n\r\n\t\tthis._byteData.position = this._offsetTris;\r\n\r\n\t\tfor (i = 0; i < this._numTris; i++) {\r\n\t\t\t//collect vertex indices\r\n\t\t\ta = this._byteData.readUnsignedShort();\r\n\t\t\tb = this._byteData.readUnsignedShort();\r\n\t\t\tc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\t//collect uv indices\r\n\t\t\tta = this._byteData.readUnsignedShort();\r\n\t\t\ttb = this._byteData.readUnsignedShort();\r\n\t\t\ttc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis.addIndex(a, ta);\r\n\t\t\tthis.addIndex(b, tb);\r\n\t\t\tthis.addIndex(c, tc);\r\n\t\t}\r\n\r\n\t\tvar len:number /*uint*/ = this._uvIndices.length;\r\n\t\tthis._finalUV = new Array<number>(len*2);\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._finalUV[i << 1] = this._uvs[this._uvIndices[i] << 1];\r\n\t\t\tthis._finalUV[(i << 1) + 1] = this._uvs[(this._uvIndices[i] << 1) + 1];\r\n\t\t}\r\n\r\n\t\tthis._parsedFaces = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a face index to the list if it doesn't exist yet, based on vertexIndex and uvIndex, and adds the\r\n\t * corresponding vertex and uv data in the correct location.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t */\r\n\tprivate addIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/)\r\n\t{\r\n\t\tvar index:number /*int*/ = this.findIndex(vertexIndex, uvIndex);\r\n\r\n\t\tif (index == -1) {\r\n\t\t\tthis._indices.push(this._vertIndices.length);\r\n\t\t\tthis._vertIndices.push(vertexIndex);\r\n\t\t\tthis._uvIndices.push(uvIndex);\r\n\t\t} else\r\n\t\t\tthis._indices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the final index corresponding to the original MD2's vertex and uv indices. Returns -1 if it wasn't added yet.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t * @return The index of the final mesh corresponding to the original vertex and uv index. -1 if it doesn't exist yet.\r\n\t */\r\n\tprivate findIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/):number /*int*/\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._vertIndices.length;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tif (this._vertIndices[i] == vertexIndex && this._uvIndices[i] == uvIndex)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses all the frame geometries.\r\n\t */\r\n\tprivate parseFrames()\r\n\t{\r\n\t\tvar sx:number, sy:number, sz:number;\r\n\t\tvar tx:number, ty:number, tz:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar vertLen:number /*uint*/ = this._vertIndices.length;\r\n\t\tvar fvertices:Array<number>;\r\n\t\tvar tvertices:Array<number>;\r\n\t\tvar i:number /*uint*/, j:number /*int*/, k:number /*uint*/;\r\n\t\t//var ch : number /*uint*/;\r\n\t\tvar name:string = \"\";\r\n\t\tvar prevClip:VertexClipNode = null;\r\n\r\n\t\tthis._byteData.position = this._offsetFrames;\r\n\r\n\t\tfor (i = 0; i < this._numFrames; i++) {\r\n\r\n\t\t\ttvertices = new Array<number>();\r\n\t\t\tfvertices = new Array<number>(vertLen*3);\r\n\r\n\t\t\tsx = this._byteData.readFloat();\r\n\t\t\tsy = this._byteData.readFloat();\r\n\t\t\tsz = this._byteData.readFloat();\r\n\r\n\t\t\ttx = this._byteData.readFloat();\r\n\t\t\tty = this._byteData.readFloat();\r\n\t\t\ttz = this._byteData.readFloat();\r\n\r\n\t\t\tname = this.readFrameName();\r\n\r\n\t\t\t// Note, the extra data.position++ in the for loop is there\r\n\t\t\t// to skip over a byte that holds the \"vertex normal index\"\r\n\t\t\tfor (j = 0; j < this._numVertices; j++, this._byteData.position++)\r\n\t\t\t\ttvertices.push(sx*this._byteData.readUnsignedByte() + tx, sy*this._byteData.readUnsignedByte() + ty, sz*this._byteData.readUnsignedByte() + tz);\r\n\r\n\t\t\tk = 0;\r\n\t\t\tfor (j = 0; j < vertLen; j++) {\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 2];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 1];\r\n\t\t\t}\r\n\r\n\t\t\tsubGeom = new TriangleSubGeometry(new AttributesBuffer());\r\n\r\n\t\t\tif (this._firstSubGeom == null)\r\n\t\t\t\tthis._firstSubGeom = subGeom;\r\n\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tgeometry.addSubGeometry(subGeom);\r\n\r\n\t\t\tsubGeom.setIndices(this._indices);\r\n\t\t\tsubGeom.setPositions(fvertices);\r\n\t\t\tsubGeom.setUVs(this._finalUV);\r\n\t\t\t// cause explicit updates\r\n\t\t\tsubGeom.setNormals(null);\r\n\t\t\tsubGeom.setTangents(null);\r\n\t\t\t// turn auto updates off because they may be animated and set explicitly\r\n\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\tsubGeom.autoDeriveTangents = false;\r\n\r\n\t\t\tvar clip:VertexClipNode = this._clipNodes[name];\r\n\r\n\t\t\tif (!clip) {\r\n\t\t\t\t// If another sequence was parsed before this one, starting\r\n\t\t\t\t// a new state means the previous one is complete and can\r\n\t\t\t\t// hence be finalized.\r\n\t\t\t\tif (prevClip) {\r\n\t\t\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclip = new VertexClipNode();\r\n\t\t\t\tclip.name = name;\r\n\t\t\t\tclip.stitchFinalFrame = true;\r\n\r\n\t\t\t\tthis._clipNodes[name] = clip;\r\n\r\n\t\t\t\tprevClip = clip;\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, 1000/MD2Parser.FPS);\r\n\t\t}\r\n\r\n\t\t// Finalize the last state\r\n\t\tif (prevClip) {\r\n\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t}\r\n\r\n\t\t// Force this._pFinalizeAsset() to decide name\r\n\t\tthis._pFinalizeAsset(this._animationSet);\r\n\r\n\t\tthis._parsedFrames = true;\r\n\t}\r\n\r\n\tprivate readFrameName():string\r\n\t{\r\n\t\tvar name:string = \"\";\r\n\t\tvar k:number /*uint*/ = 0;\r\n\t\tfor (var j:number /*uint*/ = 0; j < 16; j++) {\r\n\t\t\tvar ch:number /*uint*/ = this._byteData.readUnsignedByte();\r\n\r\n\t\t\tif (Math.floor(ch) > 0x39 && Math.floor(ch) <= 0x7A && k == 0)\r\n\t\t\t\tname += String.fromCharCode(ch);\r\n\r\n\t\t\tif (Math.floor(ch) >= 0x30 && Math.floor(ch) <= 0x39)\r\n\t\t\t\tk++;\r\n\t\t}\r\n\t\treturn name;\r\n\t}\r\n}\r\n\r\nexport = MD2Parser;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\n\r\n/**\r\n * MD5AnimParser provides a parser for the md5anim data type, providing an animation sequence for the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5AnimParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_FRAMES_TOKEN:string = \"numFrames\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static FRAME_RATE_TOKEN:string = \"frameRate\";\r\n\tpublic static NUM_ANIMATED_COMPONENTS_TOKEN:string = \"numAnimatedComponents\";\r\n\r\n\tpublic static HIERARCHY_TOKEN:string = \"hierarchy\";\r\n\tpublic static BOUNDS_TOKEN:string = \"bounds\";\r\n\tpublic static BASE_FRAME_TOKEN:string = \"baseframe\";\r\n\tpublic static FRAME_TOKEN:string = \"frame\";\r\n\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _frameRate:number /*int*/;\r\n\tprivate _numFrames:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numAnimatedComponents:number /*int*/;\r\n\r\n\tprivate _hierarchy:Array<HierarchyData>;\r\n\tprivate _bounds:Array<BoundsData>;\r\n\tprivate _frameData:Array<FrameData>;\r\n\tprivate _baseFrameData:Array<BaseFrameData>;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\tprivate _clip:SkeletonClipNode;\r\n\r\n\t/**\r\n\t * Creates a new MD5AnimParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\t\tvar t1:Quaternion = new Quaternion();\r\n\t\tvar t2:Quaternion = new Quaternion();\r\n\r\n\t\tt1.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\t\tt2.fromAxisAngle(Vector3D.Y_AXIS, -Math.PI*.5);\r\n\r\n\t\tthis._rotationQuat.multiply(t2, t1);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tthis._rotationQuat.multiply(t2, t1);\r\n\t\t\tt1.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(t1, this._rotationQuat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5anim\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5AnimParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"\":\r\n\t\t\t\t\t// can occur at the end of a file\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_FRAMES_TOKEN:\r\n\t\t\t\t\tthis._numFrames = this.getNextInt();\r\n\t\t\t\t\tthis._bounds = new Array<BoundsData>();\r\n\t\t\t\t\tthis._frameData = new Array<FrameData>();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._hierarchy = new Array<HierarchyData>(this._numJoints);\r\n\t\t\t\t\tthis._baseFrameData = new Array<BaseFrameData>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_RATE_TOKEN:\r\n\t\t\t\t\tthis._frameRate = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_ANIMATED_COMPONENTS_TOKEN:\r\n\t\t\t\t\tthis._numAnimatedComponents = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.HIERARCHY_TOKEN:\r\n\t\t\t\t\tthis.parseHierarchy();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BOUNDS_TOKEN:\r\n\t\t\t\t\tthis.parseBounds();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BASE_FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseBaseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis._clip = new SkeletonClipNode();\r\n\t\t\t\tthis.translateClip();\r\n\t\t\t\tthis._pFinalizeAsset(this._clip);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts all key frame data to an SkinnedAnimationSequence.\r\n\t */\r\n\tprivate translateClip():void\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numFrames; ++i)\r\n\t\t\tthis._clip.addFrame(this.translatePose(this._frameData[i]), 1000/this._frameRate);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a single key frame data to a SkeletonPose.\r\n\t * @param frameData The actual frame data.\r\n\t * @return A SkeletonPose containing the frame data's pose.\r\n\t */\r\n\tprivate translatePose(frameData:FrameData):SkeletonPose\r\n\t{\r\n\t\tvar hierarchy:HierarchyData;\r\n\t\tvar pose:JointPose;\r\n\t\tvar base:BaseFrameData;\r\n\t\tvar flags:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar translate:Vector3D = new Vector3D();\r\n\t\tvar orientation:Quaternion = new Quaternion();\r\n\t\tvar components:Array<number> = frameData.components;\r\n\t\tvar skelPose:SkeletonPose = new SkeletonPose();\r\n\t\tvar jointPoses:Array<JointPose> = skelPose.jointPoses;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tj = 0;\r\n\t\t\tpose = new JointPose();\r\n\t\t\thierarchy = this._hierarchy[i];\r\n\t\t\tbase = this._baseFrameData[i];\r\n\t\t\tflags = hierarchy.flags;\r\n\t\t\ttranslate.x = base.position.x;\r\n\t\t\ttranslate.y = base.position.y;\r\n\t\t\ttranslate.z = base.position.z;\r\n\t\t\torientation.x = base.orientation.x;\r\n\t\t\torientation.y = base.orientation.y;\r\n\t\t\torientation.z = base.orientation.z;\r\n\r\n\t\t\tif (flags & 1)\r\n\t\t\t\ttranslate.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 2)\r\n\t\t\t\ttranslate.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 4)\r\n\t\t\t\ttranslate.z = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 8)\r\n\t\t\t\torientation.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 16)\r\n\t\t\t\torientation.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 32)\r\n\t\t\t\torientation.z = components[hierarchy.startIndex + (j++)];\r\n\r\n\t\t\tvar w:number = 1 - orientation.x*orientation.x - orientation.y*orientation.y - orientation.z*orientation.z;\r\n\t\t\torientation.w = w < 0? 0 : -Math.sqrt(w);\r\n\r\n\t\t\tif (hierarchy.parentIndex < 0) {\r\n\t\t\t\tpose.orientation.multiply(this._rotationQuat, orientation);\r\n\t\t\t\tpose.translation = this._rotationQuat.rotatePoint(translate);\r\n\t\t\t} else {\r\n\t\t\t\tpose.orientation.copyFrom(orientation);\r\n\t\t\t\tpose.translation.x = translate.x;\r\n\t\t\t\tpose.translation.y = translate.y;\r\n\t\t\t\tpose.translation.z = translate.z;\r\n\t\t\t}\r\n\t\t\tpose.orientation.y = -pose.orientation.y;\r\n\t\t\tpose.orientation.z = -pose.orientation.z;\r\n\t\t\tpose.translation.x = -pose.translation.x;\r\n\r\n\t\t\tjointPoses[i] = pose;\r\n\t\t}\r\n\r\n\t\treturn skelPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's hierarchy data.\r\n\t */\r\n\tprivate parseHierarchy():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:HierarchyData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new HierarchyData();\r\n\t\t\tdata.name = this.parseLiteralstring();\r\n\t\t\tdata.parentIndex = this.getNextInt();\r\n\t\t\tdata.flags = this.getNextInt();\r\n\t\t\tdata.startIndex = this.getNextInt();\r\n\t\t\tthis._hierarchy[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses frame bounds.\r\n\t */\r\n\tprivate parseBounds():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BoundsData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BoundsData();\r\n\t\t\tdata.min = this.parseVector3D();\r\n\t\t\tdata.max = this.parseVector3D();\r\n\t\t\tthis._bounds[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the base frame.\r\n\t */\r\n\tprivate parseBaseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BaseFrameData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BaseFrameData();\r\n\t\t\tdata.position = this.parseVector3D();\r\n\t\t\tdata.orientation = this.parseQuaternion();\r\n\t\t\tthis._baseFrameData[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single frame.\r\n\t */\r\n\tprivate parseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:FrameData;\r\n\t\tvar token:string;\r\n\t\tvar frameIndex:number /*int*/;\r\n\r\n\t\tframeIndex = this.getNextInt();\r\n\r\n\t\ttoken = this.getNextToken();\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new FrameData();\r\n\t\t\tdata.components = new Array<number>(this._numAnimatedComponents);\r\n\r\n\t\t\tfor (var i:number /*int*/ = 0; i < this._numAnimatedComponents; ++i)\r\n\t\t\t\tdata.components[i] = this.getNextNumber();\r\n\r\n\t\t\tthis._frameData[frameIndex] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex == this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = this.getNextNumber();\r\n\t\tquat.z = this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - (quat.x*quat.x) - (quat.y*quat.y) - (quat.z*quat.z);\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn quat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5AnimParser;\r\n\r\n\r\n/**\r\n *\r\n */\r\nclass BaseFrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic position:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic orientation:Quaternion;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BoundsData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic min:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic max:Vector3D;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass FrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic index:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic components:Array<number>;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass HierarchyData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic name:string;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic parentIndex:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic flags:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic startIndex:number /*int*/;\r\n}",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\n\r\n// todo: create animation system, parse skeleton\r\n\r\n/**\r\n * MD5MeshParser provides a parser for the md5mesh data type, providing the geometry of the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5MeshParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static NUM_MESHES_TOKEN:string = \"numMeshes\";\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\tpublic static JOINTS_TOKEN:string = \"joints\";\r\n\tpublic static MESH_TOKEN:string = \"mesh\";\r\n\r\n\tpublic static MESH_SHADER_TOKEN:string = \"shader\";\r\n\tpublic static MESH_NUM_VERTS_TOKEN:string = \"numverts\";\r\n\tpublic static MESH_VERT_TOKEN:string = \"vert\";\r\n\tpublic static MESH_NUM_TRIS_TOKEN:string = \"numtris\";\r\n\tpublic static MESH_TRI_TOKEN:string = \"tri\";\r\n\tpublic static MESH_NUM_WEIGHTS_TOKEN:string = \"numweights\";\r\n\tpublic static MESH_WEIGHT_TOKEN:string = \"weight\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numMeshes:number /*int*/;\r\n\r\n\tprivate _mesh:Mesh;\r\n\tprivate _shaders:Array<string>;\r\n\r\n\tprivate _maxJointCount:number /*int*/;\r\n\tprivate _meshData:Array<MeshData>;\r\n\tprivate _bindPoses:Array<Matrix3D>;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate _skeleton:Skeleton;\r\n\tprivate _animationSet:SkeletonAnimationSet;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\r\n\t/**\r\n\t * Creates a new MD5MeshParser object.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\r\n\t\tthis._rotationQuat.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tvar quat:Quaternion = new Quaternion();\r\n\t\t\tquat.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(this._rotationQuat, quat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5mesh\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._bindPoses = new Array<Matrix3D>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_MESHES_TOKEN:\r\n\t\t\t\t\tthis._numMeshes = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.JOINTS_TOKEN:\r\n\t\t\t\t\tthis.parseJoints();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TOKEN:\r\n\t\t\t\t\tthis.parseMesh();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis.calculateMaxJointCount();\r\n\t\t\t\tthis._animationSet = new SkeletonAnimationSet(this._maxJointCount);\r\n\r\n\t\t\t\tthis._mesh = new Mesh(new Geometry(), null);\r\n\t\t\t\tthis._geometry = this._mesh.geometry;\r\n\r\n\t\t\t\tfor (var i:number /*int*/ = 0; i < this._meshData.length; ++i)\r\n\t\t\t\t\tthis._geometry.addSubGeometry(this.translateGeom(this._meshData[i].vertexData, this._meshData[i].weightData, this._meshData[i].indices));\r\n\r\n\t\t\t\t//_geometry.animation = _animation;\r\n\t\t\t\t//\t\t\t\t\t_mesh.animationController = _animationController;\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(this._geometry);\r\n\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\tthis._pFinalizeAsset(this._skeleton);\r\n\t\t\t\tthis._pFinalizeAsset(this._animationSet);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\t}\r\n\r\n\tprivate calculateMaxJointCount():void\r\n\t{\r\n\t\tthis._maxJointCount = 0;\r\n\r\n\t\tvar numMeshData:number /*int*/ = this._meshData.length;\r\n\t\tfor (var i:number /*int*/ = 0; i < numMeshData; ++i) {\r\n\t\t\tvar meshData:MeshData = this._meshData[i];\r\n\t\t\tvar vertexData:Array<VertexData> = meshData.vertexData;\r\n\t\t\tvar numVerts:number /*int*/ = vertexData.length;\r\n\r\n\t\t\tfor (var j:number /*int*/ = 0; j < numVerts; ++j) {\r\n\t\t\t\tvar zeroWeights:number /*int*/ = this.countZeroWeightJoints(vertexData[j], meshData.weightData);\r\n\t\t\t\tvar totalJoints:number /*int*/ = vertexData[j].countWeight - zeroWeights;\r\n\t\t\t\tif (totalJoints > this._maxJointCount)\r\n\t\t\t\t\tthis._maxJointCount = totalJoints;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate countZeroWeightJoints(vertex:VertexData, weights:Array<JointData>):number /*int*/\r\n\t{\r\n\t\tvar start:number /*int*/ = vertex.startWeight;\r\n\t\tvar end:number /*int*/ = vertex.startWeight + vertex.countWeight;\r\n\t\tvar count:number /*int*/ = 0;\r\n\t\tvar weight:number;\r\n\r\n\t\tfor (var i:number /*int*/ = start; i < end; ++i) {\r\n\t\t\tweight = weights[i].bias;\r\n\t\t\tif (weight == 0)\r\n\t\t\t\t++count;\r\n\t\t}\r\n\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's joints.\r\n\t */\r\n\tprivate parseJoints():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar quat:Quaternion;\r\n\t\tvar i:number /*int*/ = 0;\r\n\t\tvar token:string = this.getNextToken();\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tthis._skeleton = new Skeleton();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.name = this.parseLiteralstring();\r\n\t\t\tjoint.parentIndex = this.getNextInt();\r\n\t\t\tpos = this.parseVector3D();\r\n\t\t\tpos = this._rotationQuat.rotatePoint(pos);\r\n\t\t\tquat = this.parseQuaternion();\r\n\r\n\t\t\t// todo: check if this is correct, or maybe we want to actually store it as quats?\r\n\t\t\tthis._bindPoses[i] = quat.toMatrix3D();\r\n\t\t\tthis._bindPoses[i].appendTranslation(pos.x, pos.y, pos.z);\r\n\t\t\tvar inv:Matrix3D = this._bindPoses[i].clone();\r\n\t\t\tinv.invert();\r\n\t\t\tjoint.inverseBindPose = inv.rawData;\r\n\r\n\t\t\tthis._skeleton.joints[i++] = joint;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the mesh geometry.\r\n\t */\r\n\tprivate parseMesh():void\r\n\t{\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar ch:string;\r\n\t\tvar vertexData:Array<VertexData>;\r\n\t\tvar weights:Array<JointData>;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tif (this._shaders == null)\r\n\t\t\tthis._shaders = new Array<string>();\r\n\r\n\t\twhile (ch != \"}\") {\r\n\t\t\tch = this.getNextToken();\r\n\t\t\tswitch (ch) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_SHADER_TOKEN:\r\n\t\t\t\t\tthis._shaders.push(this.parseLiteralstring());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_VERTS_TOKEN:\r\n\t\t\t\t\tvertexData = new Array<VertexData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_TRIS_TOKEN:\r\n\t\t\t\t\tindices = new Array<number>(this.getNextInt()*3) /*uint*/;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_WEIGHTS_TOKEN:\r\n\t\t\t\t\tweights = new Array<JointData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_VERT_TOKEN:\r\n\t\t\t\t\tthis.parseVertex(vertexData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TRI_TOKEN:\r\n\t\t\t\t\tthis.parseTri(indices);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_WEIGHT_TOKEN:\r\n\t\t\t\t\tthis.parseJoint(weights);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._meshData == null)\r\n\t\t\tthis._meshData = new Array<MeshData>();\r\n\r\n\t\tvar i:number /*uint*/ = this._meshData.length;\r\n\t\tthis._meshData[i] = new MeshData();\r\n\t\tthis._meshData[i].vertexData = vertexData;\r\n\t\tthis._meshData[i].weightData = weights;\r\n\t\tthis._meshData[i].indices = indices;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the mesh data to a SkinnedSub instance.\r\n\t * @param vertexData The mesh's vertices.\r\n\t * @param weights The joint weights per vertex.\r\n\t * @param indices The indices for the faces.\r\n\t * @return A SubGeometry instance containing all geometrical data for the current mesh.\r\n\t */\r\n\tprivate translateGeom(vertexData:Array<VertexData>, weights:Array<JointData>, indices:Array<number> /*uint*/):TriangleSubGeometry\r\n\t{\r\n\t\tvar len:number /*int*/ = vertexData.length;\r\n\t\tvar v1:number /*int*/, v2:number /*int*/, v3:number /*int*/;\r\n\t\tvar vertex:VertexData;\r\n\t\tvar weight:JointData;\r\n\t\tvar bindPose:Matrix3D;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar subGeom:TriangleSubGeometry = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\tvar uvs:Array<number> = new Array<number>(len*2);\r\n\t\tvar vertices:Array<number> = new Array<number>(len*3);\r\n\t\tvar jointIndices:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar jointWeights:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar l:number /*int*/ = 0;\r\n\t\tvar nonZeroWeights:number /*int*/;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < len; ++i) {\r\n\t\t\tvertex = vertexData[i];\r\n\t\t\tv1 = vertex.index*3;\r\n\t\t\tv2 = v1 + 1;\r\n\t\t\tv3 = v1 + 2;\r\n\t\t\tvertices[v1] = vertices[v2] = vertices[v3] = 0;\r\n\r\n\t\t\tnonZeroWeights = 0;\r\n\t\t\tfor (var j:number /*int*/ = 0; j < vertex.countWeight; ++j) {\r\n\t\t\t\tweight = weights[vertex.startWeight + j];\r\n\t\t\t\tif (weight.bias > 0) {\r\n\t\t\t\t\tbindPose = this._bindPoses[weight.joint];\r\n\t\t\t\t\tpos = bindPose.transformVector(weight.pos);\r\n\t\t\t\t\tvertices[v1] += pos.x*weight.bias;\r\n\t\t\t\t\tvertices[v2] += pos.y*weight.bias;\r\n\t\t\t\t\tvertices[v3] += pos.z*weight.bias;\r\n\r\n\t\t\t\t\t// indices need to be multiplied by 3 (amount of matrix registers)\r\n\t\t\t\t\tjointIndices[l] = weight.joint*3;\r\n\t\t\t\t\tjointWeights[l++] = weight.bias;\r\n\t\t\t\t\t++nonZeroWeights;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (j = nonZeroWeights; j < this._maxJointCount; ++j) {\r\n\t\t\t\tjointIndices[l] = 0;\r\n\t\t\t\tjointWeights[l++] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tv1 = vertex.index << 1;\r\n\t\t\tuvs[v1++] = vertex.s;\r\n\t\t\tuvs[v1] = vertex.t;\r\n\t\t}\r\n\r\n\t\tsubGeom.jointsPerVertex = this._maxJointCount;\r\n\t\tsubGeom.setIndices(indices);\r\n\t\tsubGeom.setPositions(vertices);\r\n\t\tsubGeom.setUVs(uvs);\r\n\t\tsubGeom.setJointIndices(jointIndices);\r\n\t\tsubGeom.setJointWeights(jointWeights);\r\n\t\t// cause explicit updates\r\n\t\tsubGeom.setNormals(null);\r\n\t\tsubGeom.setTangents(null);\r\n\t\t// turn auto updates off because they may be animated and set explicitly\r\n\t\tsubGeom.autoDeriveTangents = false;\r\n\t\tsubGeom.autoDeriveNormals = false;\r\n\r\n\t\treturn subGeom;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve the next triplet of vertex indices that form a face.\r\n\t * @param indices The index list in which to store the read data.\r\n\t */\r\n\tprivate parseTri(indices:Array<number> /*uint*/):void\r\n\t{\r\n\t\tvar index:number /*int*/ = this.getNextInt()*3;\r\n\t\tindices[index] = this.getNextInt();\r\n\t\tindices[index + 1] = this.getNextInt();\r\n\t\tindices[index + 2] = this.getNextInt();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads a new joint data set for a single joint.\r\n\t * @param weights the target list to contain the weight data.\r\n\t */\r\n\tprivate parseJoint(weights:Array<JointData>):void\r\n\t{\r\n\t\tvar weight:JointData = new JointData();\r\n\t\tweight.index = this.getNextInt();\r\n\t\tweight.joint = this.getNextInt();\r\n\t\tweight.bias = this.getNextNumber();\r\n\t\tweight.pos = this.parseVector3D();\r\n\t\tweights[weight.index] = weight;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the data for a single vertex.\r\n\t * @param vertexData The list to contain the vertex data.\r\n\t */\r\n\tprivate parseVertex(vertexData:Array<VertexData>):void\r\n\t{\r\n\t\tvar vertex:VertexData = new VertexData();\r\n\t\tvertex.index = this.getNextInt();\r\n\t\tthis.parseUV(vertex);\r\n\t\tvertex.startWeight = this.getNextInt();\r\n\t\tvertex.countWeight = this.getNextInt();\r\n\t\t//\t\t\tif (vertex.countWeight > _maxJointCount) _maxJointCount = vertex.countWeight;\r\n\t\tvertexData[vertex.index] = vertex;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinate.\r\n\t * @param vertexData The vertexData to contain the UV coordinates.\r\n\t */\r\n\tprivate parseUV(vertexData:VertexData):void\r\n\t{\r\n\t\tvar ch:string = this.getNextToken();\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvertexData.s = this.getNextNumber();\r\n\t\tvertexData.t = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex >= this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = -this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = -this.getNextNumber();\r\n\t\tquat.z = -this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - quat.x*quat.x - quat.y*quat.y - quat.z*quat.z;\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\tvar rotQuat:Quaternion = new Quaternion();\r\n\t\trotQuat.multiply(this._rotationQuat, quat);\r\n\t\treturn rotQuat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5MeshParser;\r\n\r\n\r\nclass VertexData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic s:number;\r\n\tpublic t:number;\r\n\tpublic startWeight:number /*int*/;\r\n\tpublic countWeight:number /*int*/;\r\n}\r\n\r\nclass JointData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic joint:number /*int*/;\r\n\tpublic bias:number;\r\n\tpublic pos:Vector3D;\r\n}\r\n\r\nclass MeshData\r\n{\r\n\tpublic vertexData:Array<VertexData>;\r\n\tpublic weightData:Array<JointData>;\r\n\tpublic indices:Array<number> /*uint*/;\r\n}",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * Max3DSParser provides a parser for the 3ds data type.\r\n */\r\nclass Max3DSParser extends ParserBase\r\n{\r\n\tprivate _byteData:ByteArray;\r\n\r\n\tprivate _textures:Object;\r\n\tprivate _materials:Object;\r\n\tprivate _unfinalized_objects:Object;\r\n\r\n\tprivate _cur_obj_end:number;\r\n\tprivate _cur_obj:ObjectVO;\r\n\r\n\tprivate _cur_mat_end:number;\r\n\tprivate _cur_mat:MaterialVO;\r\n\tprivate _useSmoothingGroups:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>Max3DSParser</code> object.\r\n\t *\r\n\t * @param useSmoothingGroups Determines whether the parser looks for smoothing groups in the 3ds file or assumes uniform smoothing. Defaults to true.\r\n\t */\r\n\tconstructor(useSmoothingGroups:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._useSmoothingGroups = useSmoothingGroups;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"3ds\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar ba:ByteArray;\r\n\r\n\t\tba = ParserUtils.toByteArray(data);\r\n\t\tif (ba) {\r\n\t\t\tba.position = 0;\r\n\t\t\tif (ba.readShort() == 0x4d4d)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\t\t\tif (asset.isAsset(BitmapImage2D)) {\r\n\t\t\t\tvar tex:TextureVO;\r\n\r\n\t\t\t\ttex = this._textures[resourceDependency.id];\r\n\t\t\t\ttex.texture = new Single2DTexture(<BitmapImage2D> asset);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\t// TODO: Implement\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._byteData) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._byteData.position = 0;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\tthis._textures = {};\r\n\t\t\tthis._materials = {};\r\n\t\t\tthis._unfinalized_objects = {};\r\n\t\t}\r\n\r\n\t\t// TODO: With this construct, the loop will run no-op for as long\r\n\t\t// as there is time once file has finished reading. Consider a nice\r\n\t\t// way to stop loop when byte array is empty, without putting it in\r\n\t\t// the while-conditional, which will prevent finalizations from\r\n\t\t// happening after the last chunk.\r\n\t\twhile (this._pHasTime()) {\r\n\r\n\t\t\t// If we are currently working on an object, and the most recent chunk was\r\n\t\t\t// the last one in that object, finalize the current object.\r\n\t\t\tif (this._cur_mat && this._byteData.position >= this._cur_mat_end)\r\n\t\t\t\tthis.finalizeCurrentMaterial();\r\n\t\t\telse if (this._cur_obj && this._byteData.position >= this._cur_obj_end) {\r\n\t\t\t\t// Can't finalize at this point, because we have to wait until the full\r\n\t\t\t\t// animation section has been parsed for any potential pivot definitions\r\n\t\t\t\tthis._unfinalized_objects[this._cur_obj.name] = this._cur_obj;\r\n\t\t\t\tthis._cur_obj_end = Number.MAX_VALUE /*uint*/;\r\n\t\t\t\tthis._cur_obj = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._byteData.getBytesAvailable() > 0) {\r\n\t\t\t\tvar cid:number /*uint*/;\r\n\t\t\t\tvar len:number /*uint*/;\r\n\t\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\t\tswitch (cid) {\r\n\t\t\t\t\tcase 0x4D4D: // MAIN3DS\r\n\t\t\t\t\tcase 0x3D3D: // EDIT3DS\r\n\t\t\t\t\tcase 0xB000: // KEYF3DS\r\n\t\t\t\t\t\t// This types are \"container chunks\" and contain only\r\n\t\t\t\t\t\t// sub-chunks (no data on their own.) This means that\r\n\t\t\t\t\t\t// there is nothing more to parse at this point, and\r\n\t\t\t\t\t\t// instead we should progress to the next chunk, which\r\n\t\t\t\t\t\t// will be the first sub-chunk of this one.\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xAFFF: // MATERIAL\r\n\t\t\t\t\t\tthis._cur_mat_end = end;\r\n\t\t\t\t\t\tthis._cur_mat = this.parseMaterial();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4000: // EDIT_OBJECT\r\n\t\t\t\t\t\tthis._cur_obj_end = end;\r\n\t\t\t\t\t\tthis._cur_obj = new ObjectVO();\r\n\t\t\t\t\t\tthis._cur_obj.name = this.readNulTermstring();\r\n\t\t\t\t\t\tthis._cur_obj.materials = new Array<string>();\r\n\t\t\t\t\t\tthis._cur_obj.materialFaces = {};\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4100: // OBJ_TRIMESH\r\n\t\t\t\t\t\tthis._cur_obj.type = Mesh.assetType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4110: // TRI_VERTEXL\r\n\t\t\t\t\t\tthis.parseVertexList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4120: // TRI_FACELIST\r\n\t\t\t\t\t\tthis.parseFaceList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4140: // TRI_MAPPINGCOORDS\r\n\t\t\t\t\t\tthis.parseUVList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4130: // Face materials\r\n\t\t\t\t\t\tthis.parseFaceMaterialList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4160: // Transform\r\n\t\t\t\t\t\tthis._cur_obj.transform = this.readTransform();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xB002: // Object animation (including pivot)\r\n\t\t\t\t\t\tthis.parseObjectAnimation(end);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4150: // Smoothing groups\r\n\t\t\t\t\t\tthis.parseSmoothingGroups();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// Skip this (unknown) chunk\r\n\t\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pause parsing if there were any dependencies found during this\r\n\t\t\t\t// iteration (i.e. if there are any dependencies that need to be\r\n\t\t\t\t// retrieved at this time.)\r\n\t\t\t\tif (this.dependencies.length) {\r\n\t\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// More parsing is required if the entire byte array has not yet\r\n\t\t// been read, or if there is a currently non-finalized object in\r\n\t\t// the pipeline.\r\n\t\tif (this._byteData.getBytesAvailable() || this._cur_obj || this._cur_mat) {\r\n\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t} else {\r\n\t\t\tvar name:string;\r\n\r\n\t\t\t// Finalize any remaining objects before ending.\r\n\t\t\tfor (name in this._unfinalized_objects) {\r\n\t\t\t\tvar obj:DisplayObjectContainer;\r\n\t\t\t\tobj = this.constructObject(this._unfinalized_objects[name]);\r\n\t\t\t\tif (obj) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(obj, name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\t}\r\n\r\n\tprivate parseMaterial():MaterialVO\r\n\t{\r\n\t\tvar mat:MaterialVO;\r\n\r\n\t\tmat = new MaterialVO();\r\n\r\n\t\twhile (this._byteData.position < this._cur_mat_end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA000: // Material name\r\n\t\t\t\t\tmat.name = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA010: // Ambient color\r\n\t\t\t\t\tmat.ambientColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA020: // Diffuse color\r\n\t\t\t\t\tmat.diffuseColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA030: // Specular color\r\n\t\t\t\t\tmat.specularColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA081: // Two-sided, existence indicates \"true\"\r\n\t\t\t\t\tmat.twoSided = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA200: // Main (color) texture\r\n\t\t\t\t\tmat.colorMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA204: // Specular map\r\n\t\t\t\t\tmat.specularMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position = end;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mat;\r\n\t}\r\n\r\n\tprivate parseTexture(end:number /*uint*/):TextureVO\r\n\t{\r\n\t\tvar tex:TextureVO;\r\n\r\n\t\ttex = new TextureVO();\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA300:\r\n\t\t\t\t\ttex.url = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// Skip this unknown texture sub-chunk\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._textures[tex.url] = tex;\r\n\t\tthis._pAddDependency(tex.url, new URLRequest(tex.url));\r\n\r\n\t\treturn tex;\r\n\t}\r\n\r\n\tprivate parseVertexList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.verts = new Array<number>(count*3);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.verts.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\tx = this._byteData.readFloat();\r\n\t\t\ty = this._byteData.readFloat();\r\n\t\t\tz = this._byteData.readFloat();\r\n\r\n\t\t\tthis._cur_obj.verts[i++] = x;\r\n\t\t\tthis._cur_obj.verts[i++] = z;\r\n\t\t\tthis._cur_obj.verts[i++] = y;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.indices = new Array<number>(count*3) /*uint*/;\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.indices.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar i0:number /*uint*/, i1:number /*uint*/, i2:number /*uint*/;\r\n\r\n\t\t\ti0 = this._byteData.readUnsignedShort();\r\n\t\t\ti1 = this._byteData.readUnsignedShort();\r\n\t\t\ti2 = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis._cur_obj.indices[i++] = i0;\r\n\t\t\tthis._cur_obj.indices[i++] = i2;\r\n\t\t\tthis._cur_obj.indices[i++] = i1;\r\n\r\n\t\t\t// Skip \"face info\", irrelevant in Away3D\r\n\t\t\tthis._byteData.position += 2;\r\n\t\t}\r\n\r\n\t\tthis._cur_obj.smoothingGroups = new Array<number>(count) /*uint*/;\r\n\t}\r\n\r\n\tprivate parseSmoothingGroups():void\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._cur_obj.indices.length/3;\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.smoothingGroups[i] = this._byteData.readUnsignedInt();\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseUVList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.uvs = new Array<number>(count*2);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.uvs.length;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.uvs[i++] = this._byteData.readFloat();\r\n\t\t\tthis._cur_obj.uvs[i++] = 1.0 - this._byteData.readFloat();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceMaterialList():void\r\n\t{\r\n\t\tvar mat:string;\r\n\t\tvar count:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar faces:Array<number> /*uint*/;\r\n\r\n\t\tmat = this.readNulTermstring();\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\r\n\t\tfaces = new Array<number>(count) /*uint*/;\r\n\t\ti = 0;\r\n\t\twhile (i < faces.length)\r\n\t\t\tfaces[i++] = this._byteData.readUnsignedShort();\r\n\r\n\t\tthis._cur_obj.materials.push(mat);\r\n\t\tthis._cur_obj.materialFaces[mat] = faces;\r\n\t}\r\n\r\n\tprivate parseObjectAnimation(end:number):void\r\n\t{\r\n\t\tvar vo:ObjectVO;\r\n\t\tvar obj:DisplayObjectContainer;\r\n\t\tvar pivot:Vector3D;\r\n\t\tvar name:string;\r\n\t\tvar hier:number /*uint*/;\r\n\r\n\t\t// Pivot defaults to origin\r\n\t\tpivot = new Vector3D;\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xb010: // Name/hierarchy\r\n\t\t\t\t\tname = this.readNulTermstring();\r\n\t\t\t\t\tthis._byteData.position += 4;\r\n\t\t\t\t\thier = this._byteData.readShort();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xb013: // Pivot\r\n\t\t\t\t\tpivot.x = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.z = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.y = this._byteData.readFloat();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If name is \"$$$DUMMY\" this is an empty object (e.g. a container)\r\n\t\t// and will be ignored in this version of the parser\r\n\t\t// TODO: Implement containers in 3DS parser.\r\n\t\tif (name != '$$$DUMMY' && this._unfinalized_objects.hasOwnProperty(name)) {\r\n\t\t\tvo = this._unfinalized_objects[name];\r\n\t\t\tobj = this.constructObject(vo, pivot);\r\n\r\n\t\t\tif (obj) {\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(obj, vo.name);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tdelete this._unfinalized_objects[name];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate constructObject(obj:ObjectVO, pivot:Vector3D = null):DisplayObjectContainer\r\n\t{\r\n\t\tif (obj.type == Mesh.assetType) {\r\n\t\t\tvar i:number /*uint*/;\r\n\t\t\tvar sub:TriangleSubGeometry;\r\n\t\t\tvar geom:Geometry;\r\n\t\t\tvar mat:MaterialBase;\r\n\t\t\tvar mesh:Mesh;\r\n\t\t\tvar mtx:Matrix3D;\r\n\t\t\tvar vertices:Array<VertexVO>;\r\n\t\t\tvar faces:Array<FaceVO>;\r\n\r\n\t\t\tif (obj.materials.length > 1)\r\n\t\t\t\tconsole.log(\"The Away3D 3DS parser does not support multiple materials per mesh at this point.\");\r\n\r\n\t\t\t// Ignore empty objects\r\n\t\t\tif (!obj.indices || obj.indices.length == 0)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvertices = new Array<VertexVO>(obj.verts.length/3);\r\n\t\t\tfaces = new Array<FaceVO>(obj.indices.length/3);\r\n\r\n\t\t\tthis.prepareData(vertices, faces, obj);\r\n\r\n\t\t\tif (this._useSmoothingGroups)\r\n\t\t\t\tthis.applySmoothGroups(vertices, faces);\r\n\r\n\t\t\tobj.verts = new Array<number>(vertices.length*3);\r\n\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\tobj.verts[i*3] = vertices[i].x;\r\n\t\t\t\tobj.verts[i*3 + 1] = vertices[i].y;\r\n\t\t\t\tobj.verts[i*3 + 2] = vertices[i].z;\r\n\t\t\t}\r\n\t\t\tobj.indices = new Array<number>(faces.length*3) /*uint*/;\r\n\r\n\t\t\tfor (i = 0; i < faces.length; i++) {\r\n\t\t\t\tobj.indices[i*3] = faces[i].a;\r\n\t\t\t\tobj.indices[i*3 + 1] = faces[i].b;\r\n\t\t\t\tobj.indices[i*3 + 2] = faces[i].c;\r\n\t\t\t}\r\n\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\t// If the object had UVs to start with, use UVs generated by\r\n\t\t\t\t// smoothing group splitting algorithm. Otherwise those UVs\r\n\t\t\t\t// will be nonsense and should be skipped.\r\n\t\t\t\tobj.uvs = new Array<number>(vertices.length*2);\r\n\t\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\t\tobj.uvs[i*2] = vertices[i].u;\r\n\t\t\t\t\tobj.uvs[i*2 + 1] = vertices[i].v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgeom = new Geometry();\r\n\r\n\t\t\t// Construct sub-geometries (potentially splitting buffers)\r\n\t\t\t// and add them to geometry.\r\n\t\t\tsub = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\tsub.setIndices(obj.indices);\r\n\t\t\tsub.setPositions(obj.verts);\r\n\t\t\tsub.setUVs(obj.uvs);\r\n\r\n\t\t\tgeom.addSubGeometry(sub);\r\n\r\n\t\t\tif (obj.materials.length > 0) {\r\n\t\t\t\tvar mname:string;\r\n\t\t\t\tmname = obj.materials[0];\r\n\t\t\t\tmat = this._materials[mname].material;\r\n\t\t\t}\r\n\r\n\t\t\t// Apply pivot translation to geometry if a pivot was\r\n\t\t\t// found while parsing the keyframe chunk earlier.\r\n\t\t\tif (pivot) {\r\n\t\t\t\tif (obj.transform) {\r\n\t\t\t\t\t// If a transform was found while parsing the\r\n\t\t\t\t\t// object chunk, use it to find the local pivot vector\r\n\t\t\t\t\tmtx = new Matrix3D(obj.transform);\r\n\t\t\t\t\tmtx.rawData[12] = 0;\r\n\t\t\t\t\tmtx.rawData[13] = 0;\r\n\t\t\t\t\tmtx.rawData[14] = 0;\r\n\t\t\t\t\tpivot = mtx.transformVector(pivot);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpivot.scaleBy(-1);\r\n\r\n\t\t\t\tmtx = new Matrix3D();\r\n\t\t\t\tmtx.appendTranslation(pivot.x, pivot.y, pivot.z);\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Apply transformation to geometry if a transformation\r\n\t\t\t// was found while parsing the object chunk earlier.\r\n\t\t\tif (obj.transform) {\r\n\t\t\t\tmtx = new Matrix3D(obj.transform);\r\n\t\t\t\tmtx.invert();\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Final transform applied to geometry. Finalize the geometry,\r\n\t\t\t// which will no longer be modified after this point.\r\n\t\t\tthis._pFinalizeAsset(geom, obj.name.concat('_geom'));\r\n\r\n\t\t\t// Build mesh and return it\r\n\t\t\tmesh = new Mesh(geom, mat);\r\n\t\t\tmesh.transform.matrix3D = new Matrix3D(obj.transform);\r\n\t\t\treturn mesh;\r\n\t\t}\r\n\r\n\t\t// If reached, unknown\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate prepareData(vertices:Array<VertexVO>, faces:Array<FaceVO>, obj:ObjectVO):void\r\n\t{\r\n\t\t// convert raw ObjectVO's data to structured VertexVO and FaceVO\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar len:number /*int*/ = obj.verts.length;\r\n\t\tfor (i = 0, j = 0, k = 0; i < len;) {\r\n\t\t\tvar v:VertexVO = new VertexVO;\r\n\t\t\tv.x = obj.verts[i++];\r\n\t\t\tv.y = obj.verts[i++];\r\n\t\t\tv.z = obj.verts[i++];\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\tv.u = obj.uvs[j++];\r\n\t\t\t\tv.v = obj.uvs[j++];\r\n\t\t\t}\r\n\t\t\tvertices[k++] = v;\r\n\t\t}\r\n\t\tlen = obj.indices.length;\r\n\t\tfor (i = 0, k = 0; i < len;) {\r\n\t\t\tvar f:FaceVO = new FaceVO();\r\n\t\t\tf.a = obj.indices[i++];\r\n\t\t\tf.b = obj.indices[i++];\r\n\t\t\tf.c = obj.indices[i++];\r\n\t\t\tf.smoothGroup = obj.smoothingGroups[k] || 0;\r\n\t\t\tfaces[k++] = f;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate applySmoothGroups(vertices:Array<VertexVO>, faces:Array<FaceVO>):void\r\n\t{\r\n\t\t// clone vertices according to following rule:\r\n\t\t// clone if vertex's in faces from groups 1+2 and 3\r\n\t\t// don't clone if vertex's in faces from groups 1+2, 3 and 1+3\r\n\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar l:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar numVerts:number /*uint*/ = vertices.length;\r\n\t\tvar numFaces:number /*uint*/ = faces.length;\r\n\r\n\t\t// extract groups data for vertices\r\n\t\tvar vGroups:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++)\r\n\t\t\tvGroups[i] = new Array<number>() /*uint*/;\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tvar face:FaceVO = faces[i];\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tvar groups:Array<number> /*uint*/ = vGroups[(j == 0)? face.a : ((j == 1)? face.b : face.c)];\r\n\t\t\t\tvar group:number /*uint*/ = face.smoothGroup;\r\n\t\t\t\tfor (k = groups.length - 1; k >= 0; k--) {\r\n\t\t\t\t\tif ((group & groups[k]) > 0) {\r\n\t\t\t\t\t\tgroup |= groups[k];\r\n\t\t\t\t\t\tgroups.splice(k, 1);\r\n\t\t\t\t\t\tk = groups.length - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgroups.push(group);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// clone vertices\r\n\t\tvar vClones:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++) {\r\n\t\t\tif ((len = vGroups[i].length) < 1)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar clones:Array<number> /*uint*/ = new Array<number>(len) /*uint*/;\r\n\t\t\tvClones[i] = clones;\r\n\t\t\tclones[0] = i;\r\n\t\t\tvar v0:VertexVO = vertices[i];\r\n\t\t\tfor (j = 1; j < len; j++) {\r\n\t\t\t\tvar v1:VertexVO = new VertexVO;\r\n\t\t\t\tv1.x = v0.x;\r\n\t\t\t\tv1.y = v0.y;\r\n\t\t\t\tv1.z = v0.z;\r\n\t\t\t\tv1.u = v0.u;\r\n\t\t\t\tv1.v = v0.v;\r\n\t\t\t\tclones[j] = vertices.length;\r\n\t\t\t\tvertices.push(v1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tnumVerts = vertices.length;\r\n\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tface = faces[i];\r\n\t\t\tgroup = face.smoothGroup;\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tk = (j == 0)? face.a : ((j == 1)? face.b : face.c);\r\n\t\t\t\tgroups = vGroups[k];\r\n\t\t\t\tlen = groups.length;\r\n\t\t\t\tclones = vClones[k];\r\n\t\t\t\tfor (l = 0; l < len; l++) {\r\n\t\t\t\t\tif (((group == 0) && (groups[l] == 0)) || ((group & groups[l]) > 0)) {\r\n\t\t\t\t\t\tvar index:number /*uint*/ = clones[l];\r\n\t\t\t\t\t\tif (group == 0) {\r\n\t\t\t\t\t\t\t// vertex is unique if no smoothGroup found\r\n\t\t\t\t\t\t\tgroups.splice(l, 1);\r\n\t\t\t\t\t\t\tclones.splice(l, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (j == 0)\r\n\t\t\t\t\t\t\tface.a = index; else if (j == 1)\r\n\t\t\t\t\t\t\tface.b = index; else\r\n\t\t\t\t\t\t\tface.c = index;\r\n\t\t\t\t\t\tl = len;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate finalizeCurrentMaterial():void\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\r\n\t\tif (this._cur_mat.colorMap)\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.colorMap.texture || DefaultMaterialManager.getDefaultTexture());\r\n\t\telse\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.ambientColor);\r\n\r\n\t\tmat.diffuseColor = this._cur_mat.diffuseColor;\r\n\t\tmat.specularColor = this._cur_mat.specularColor;\r\n\r\n\t\tif (this.materialMode >= 2)\r\n\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS\r\n\r\n\t\tmat.bothSides = this._cur_mat.twoSided;\r\n\r\n\t\tthis._pFinalizeAsset(mat, this._cur_mat.name);\r\n\r\n\t\tthis._materials[this._cur_mat.name] = this._cur_mat;\r\n\t\tthis._cur_mat.material = mat;\r\n\r\n\t\tthis._cur_mat = null;\r\n\t}\r\n\r\n\tprivate readNulTermstring():string\r\n\t{\r\n\t\tvar chr:number /*int*/;\r\n\t\tvar str:string = \"\";\r\n\r\n\t\twhile ((chr = this._byteData.readUnsignedByte()) > 0)\r\n\t\t\tstr += String.fromCharCode(chr);\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\tprivate readTransform():Float32Array\r\n\t{\r\n\t\tvar data:Float32Array = new Float32Array(16);\r\n\r\n\t\t// X axis\r\n\t\tdata[0] = this._byteData.readFloat(); // X\r\n\t\tdata[2] = this._byteData.readFloat(); // Z\r\n\t\tdata[1] = this._byteData.readFloat(); // Y\r\n\t\tdata[3] = 0;\r\n\r\n\t\t// Z axis\r\n\t\tdata[8] = this._byteData.readFloat(); // X\r\n\t\tdata[10] = this._byteData.readFloat(); // Z\r\n\t\tdata[9] = this._byteData.readFloat(); // Y\r\n\t\tdata[11] = 0;\r\n\r\n\t\t// Y Axis\r\n\t\tdata[4] = this._byteData.readFloat(); // X\r\n\t\tdata[6] = this._byteData.readFloat(); // Z\r\n\t\tdata[5] = this._byteData.readFloat(); // Y\r\n\t\tdata[7] = 0;\r\n\r\n\t\t// Translation\r\n\t\tdata[12] = this._byteData.readFloat(); // X\r\n\t\tdata[14] = this._byteData.readFloat(); // Z\r\n\t\tdata[13] = this._byteData.readFloat(); // Y\r\n\t\tdata[15] = 1;\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate readColor():number /*int*/\r\n\t{\r\n\t\tvar cid:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar r:number /*int*/, g:number /*int*/, b:number /*int*/;\r\n\r\n\t\tcid = this._byteData.readUnsignedShort();\r\n\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\tswitch (cid) {\r\n\t\t\tcase 0x0010: // Floats\r\n\t\t\t\tr = this._byteData.readFloat()*255;\r\n\t\t\t\tg = this._byteData.readFloat()*255;\r\n\t\t\t\tb = this._byteData.readFloat()*255;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 0x0011: // 24-bit color\r\n\t\t\t\tr = this._byteData.readUnsignedByte();\r\n\t\t\t\tg = this._byteData.readUnsignedByte();\r\n\t\t\t\tb = this._byteData.readUnsignedByte();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn (r << 16) | (g << 8) | b;\r\n\t}\r\n}\r\n\r\nexport = Max3DSParser;\r\n\r\n/**\r\n *\r\n */\r\nclass FaceVO\r\n{\r\n\tpublic a:number /*int*/;\r\n\tpublic b:number /*int*/;\r\n\tpublic c:number /*int*/;\r\n\tpublic smoothGroup:number /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass MaterialVO\r\n{\r\n\tpublic name:string;\r\n\tpublic ambientColor:number /*int*/;\r\n\tpublic diffuseColor:number /*int*/;\r\n\tpublic specularColor:number /*int*/;\r\n\tpublic twoSided:boolean;\r\n\tpublic colorMap:TextureVO;\r\n\tpublic specularMap:TextureVO;\r\n\tpublic material:MaterialBase;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass ObjectVO\r\n{\r\n\tpublic name:string;\r\n\tpublic type:string;\r\n\tpublic pivotX:number;\r\n\tpublic pivotY:number;\r\n\tpublic pivotZ:number;\r\n\tpublic transform:Float32Array;\r\n\tpublic verts:Array<number>;\r\n\tpublic indices:Array<number> /*int*/;\r\n\tpublic uvs:Array<number>;\r\n\tpublic materialFaces:Object;\r\n\tpublic materials:Array<string>;\r\n\tpublic smoothingGroups:Array<number> /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass TextureVO\r\n{\r\n\tpublic url:string;\r\n\tpublic texture:Single2DTexture;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass VertexVO\r\n{\r\n\tpublic x:number;\r\n\tpublic y:number;\r\n\tpublic z:number;\r\n\tpublic u:number;\r\n\tpublic v:number;\r\n\tpublic normal:Vector3D;\r\n\tpublic tangent:Vector3D;\r\n}",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Single2DTexture\t\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\r\n\r\n/**\r\n * OBJParser provides a parser for the OBJ data type.\r\n */\r\nclass OBJParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _charIndex:number;\r\n\tprivate _oldIndex:number;\r\n\tprivate _stringLength:number;\r\n\tprivate _currentObject:ObjectGroup;\r\n\tprivate _currentGroup:Group;\r\n\tprivate _currentMaterialGroup:MaterialGroup;\r\n\tprivate _objects:Array<ObjectGroup>;\r\n\tprivate _materialIDs:string[];\r\n\tprivate _materialLoaded:Array<LoadedMaterial>;\r\n\tprivate _materialSpecularData:Array<SpecularData>;\r\n\tprivate _meshes:Array<Mesh>;\r\n\tprivate _lastMtlID:string;\r\n\tprivate _objectIndex:number;\r\n\tprivate _realIndices;\r\n\tprivate _vertexIndex:number;\r\n\tprivate _vertices:Array<Vertex>;\r\n\tprivate _vertexNormals:Array<Vertex>;\r\n\tprivate _uvs:Array<UV>;\r\n\tprivate _scale:number;\r\n\tprivate _mtlLib:boolean;\r\n\tprivate _mtlLibLoaded:boolean = true;\r\n\tprivate _activeMaterialID:string = \"\";\r\n\r\n\t/**\r\n\t * Creates a new OBJParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(scale:number = 1)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._scale = scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Scaling factor applied directly to vertices data\r\n\t * @param value The scaling factor.\r\n\t */\r\n\tpublic set scale(value:number)\r\n\t{\r\n\t\tthis._scale = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"obj\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar content:string = ParserUtils.toString(data);\r\n\t\tvar hasV:boolean = false;\r\n\t\tvar hasF:boolean = false;\r\n\r\n\t\tif (content) {\r\n\t\t\thasV = content.indexOf(\"\\nv \") != -1;\r\n\t\t\thasF = content.indexOf(\"\\nf \") != -1;\r\n\t\t}\r\n\r\n\t\treturn hasV && hasF;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == 'mtl') {\r\n\t\t\tvar str:string = ParserUtils.toString(resourceDependency.data);\r\n\t\t\tthis.parseMtl(str);\r\n\r\n\t\t} else {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tif (resourceDependency.assets.length != 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\r\n\t\t\tif (asset.isAsset(BitmapImage2D)) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\t\tlm.texture = new Single2DTexture(<BitmapImage2D> asset);\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0) {\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == \"mtl\") {\r\n\t\t\tthis._mtlLib = false;\r\n\t\t\tthis._mtlLibLoaded = false;\r\n\t\t} else {\r\n\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\tthis._materialLoaded.push(lm);\r\n\t\t}\r\n\r\n\t\tif (this._meshes.length > 0)\r\n\t\t\tthis.applyMaterial(lm);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar line:string;\r\n\t\tvar creturn:string = String.fromCharCode(10);\r\n\t\tvar trunk;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\t// Merge linebreaks that are immediately preceeded by\r\n\t\t\t// the \"escape\" backward slash into single lines.\r\n\t\t\tthis._textData = this._textData.replace(/\\\\[\\r\\n]+\\s*/gm, ' ');\r\n\t\t}\r\n\r\n\t\tif (this._textData.indexOf(creturn) == -1)\r\n\t\t\tcreturn = String.fromCharCode(13);\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._startedParsing = true;\r\n\t\t\tthis._vertices = new Array<Vertex>();\r\n\t\t\tthis._vertexNormals = new Array<Vertex>();\r\n\t\t\tthis._materialIDs = new Array<string>();\r\n\t\t\tthis._materialLoaded = new Array<LoadedMaterial>();\r\n\t\t\tthis._meshes = new Array<Mesh>();\r\n\t\t\tthis._uvs = new Array<UV>();\r\n\t\t\tthis._stringLength = this._textData.length;\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, 0);\r\n\t\t\tthis._oldIndex = 0;\r\n\t\t\tthis._objects = new Array<ObjectGroup>();\r\n\t\t\tthis._objectIndex = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._charIndex < this._stringLength && this._pHasTime()) {\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, this._oldIndex);\r\n\r\n\t\t\tif (this._charIndex == -1)\r\n\t\t\t\tthis._charIndex = this._stringLength;\r\n\r\n\t\t\tline = this._textData.substring(this._oldIndex, this._charIndex);\r\n\t\t\tline = line.split('\\r').join(\"\");\r\n\t\t\tline = line.replace(\"  \", \" \");\r\n\t\t\ttrunk = line.split(\" \");\r\n\t\t\tthis._oldIndex = this._charIndex + 1;\r\n\t\t\tthis.parseLine(trunk);\r\n\r\n\t\t\t// If whatever was parsed on this line resulted in the\r\n\t\t\t// parsing being paused to retrieve dependencies, break\r\n\t\t\t// here and do not continue parsing until un-paused.\r\n\t\t\tif (this.parsingPaused) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._charIndex >= this._stringLength) {\r\n\r\n\t\t\tif (this._mtlLib && !this._mtlLibLoaded) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t\tthis.translate();\r\n\t\t\tthis.applyMaterials();\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single line in the OBJ file.\r\n\t */\r\n\tprivate parseLine(trunk)\r\n\t{\r\n\t\tswitch (trunk[0]) {\r\n\r\n\t\t\tcase \"mtllib\":\r\n\r\n\t\t\t\tthis._mtlLib = true;\r\n\t\t\t\tthis._mtlLibLoaded = false;\r\n\t\t\t\tthis.loadMtl(trunk[1]);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"g\":\r\n\r\n\t\t\t\tthis.createGroup(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"o\":\r\n\r\n\t\t\t\tthis.createObject(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"usemtl\":\r\n\r\n\t\t\t\tif (this._mtlLib) {\r\n\r\n\t\t\t\t\tif (!trunk[1])\r\n\t\t\t\t\t\ttrunk[1] = \"def000\";\r\n\r\n\t\t\t\t\tthis._materialIDs.push(trunk[1]);\r\n\t\t\t\t\tthis._activeMaterialID = trunk[1];\r\n\r\n\t\t\t\t\tif (this._currentGroup)\r\n\t\t\t\t\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"v\":\r\n\r\n\t\t\t\tthis.parseVertex(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vt\":\r\n\r\n\t\t\t\tthis.parseUV(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vn\":\r\n\r\n\t\t\t\tthis.parseVertexNormal(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"f\":\r\n\r\n\t\t\t\tthis.parseFace(trunk);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the parsed data into an Away3D scenegraph structure\r\n\t */\r\n\tprivate translate()\r\n\t{\r\n\t\tfor (var objIndex:number = 0; objIndex < this._objects.length; ++objIndex) {\r\n\t\t\tvar groups:Array<Group> = this._objects[objIndex].groups;\r\n\t\t\tvar numGroups:number = groups.length;\r\n\t\t\tvar materialGroups:Array<MaterialGroup>;\r\n\t\t\tvar numMaterialGroups:number;\r\n\t\t\tvar geometry:Geometry;\r\n\t\t\tvar mesh:Mesh;\r\n\r\n\t\t\tvar m:number;\r\n\t\t\tvar sm:number;\r\n\t\t\tvar bmMaterial:MethodMaterial;\r\n\r\n\t\t\tfor (var g:number = 0; g < numGroups; ++g) {\r\n\t\t\t\tgeometry = new Geometry();\r\n\t\t\t\tmaterialGroups = groups[g].materialGroups;\r\n\t\t\t\tnumMaterialGroups = materialGroups.length;\r\n\r\n\t\t\t\tfor (m = 0; m < numMaterialGroups; ++m)\r\n\t\t\t\t\tthis.translateMaterialGroup(materialGroups[m], geometry);\r\n\r\n\t\t\t\tif (geometry.subGeometries.length == 0)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Finalize and force type-based name\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> geometry);//, \"\");\r\n\r\n\t\t\t\tbmMaterial = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\r\n\t\t\t\t//check for multipass\r\n\t\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\t\tbmMaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\tmesh = new Mesh(geometry, bmMaterial);\r\n\r\n\t\t\t\tif (this._objects[objIndex].name) {\r\n\t\t\t\t\t// this is a full independent object ('o' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = this._objects[objIndex].name;\r\n\r\n\t\t\t\t} else if (groups[g].name) {\r\n\r\n\t\t\t\t\t// this is a group so the sub groups contain the actual mesh object names ('g' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = groups[g].name;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No name stored. Use empty string which will force it\r\n\t\t\t\t\t// to be overridden by finalizeAsset() to type default.\r\n\t\t\t\t\tmesh.name = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._meshes.push(mesh);\r\n\r\n\t\t\t\tif (groups[g].materialID != \"\")\r\n\t\t\t\t\tbmMaterial.name = groups[g].materialID + \"~\" + mesh.name; else\r\n\t\t\t\t\tbmMaterial.name = this._lastMtlID + \"~\" + mesh.name;\r\n\r\n\t\t\t\tif (mesh.subMeshes.length > 1) {\r\n\t\t\t\t\tfor (sm = 1; sm < mesh.subMeshes.length; ++sm)\r\n\t\t\t\t\t\tmesh.subMeshes[sm].material = bmMaterial;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> mesh);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Translates an obj's material group to a subgeometry.\r\n\t * @param materialGroup The material group data to convert.\r\n\t * @param geometry The Geometry to contain the converted SubGeometry.\r\n\t */\r\n\tprivate translateMaterialGroup(materialGroup:MaterialGroup, geometry:Geometry)\r\n\t{\r\n\t\tvar faces:Array<FaceData> = materialGroup.faces;\r\n\t\tvar face:FaceData;\r\n\t\tvar numFaces:number = faces.length;\r\n\t\tvar numVerts:number;\r\n\t\tvar sub:TriangleSubGeometry;\r\n\r\n\t\tvar vertices:Array<number> = new Array<number>();\r\n\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\tvar normals:Array<number> = new Array<number>();\r\n\t\tvar indices:Array<number> /*uint*/ = new Array<number>();\r\n\r\n\t\tthis._realIndices = [];\r\n\t\tthis._vertexIndex = 0;\r\n\r\n\t\tvar j:number;\r\n\t\tfor (var i:number = 0; i < numFaces; ++i) {\r\n\r\n\t\t\tface = faces[i];\r\n\t\t\tnumVerts = face.indexIds.length - 1;\r\n\r\n\t\t\tfor (j = 1; j < numVerts; ++j) {\r\n\r\n\t\t\t\tthis.translateVertexData(face, j, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, 0, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, j + 1, vertices, uvs, indices, normals);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (vertices.length > 0) {\r\n\t\t\tsub = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\tsub.autoDeriveNormals = normals.length? false : true;\r\n\t\t\tsub.setIndices(indices);\r\n\t\t\tsub.setPositions(vertices);\r\n\t\t\tsub.setNormals(normals);\r\n\t\t\tsub.setUVs(uvs);\r\n\r\n\t\t\tgeometry.addSubGeometry(sub);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate translateVertexData(face:FaceData, vertexIndex:number, vertices:Array<number>, uvs:Array<number>, indices:Array<number> /*uint*/, normals:Array<number>)\r\n\t{\r\n\t\tvar index:number;\r\n\t\tvar vertex:Vertex;\r\n\t\tvar vertexNormal:Vertex;\r\n\t\tvar uv:UV;\r\n\r\n\t\tif (!this._realIndices[face.indexIds[vertexIndex]]) {\r\n\r\n\t\t\tindex = this._vertexIndex;\r\n\t\t\tthis._realIndices[face.indexIds[vertexIndex]] = ++this._vertexIndex;\r\n\t\t\tvertex = this._vertices[face.vertexIndices[vertexIndex] - 1];\r\n\t\t\tvertices.push(vertex.x*this._scale, vertex.y*this._scale, vertex.z*this._scale);\r\n\r\n\t\t\tif (face.normalIndices.length > 0) {\r\n\t\t\t\tvertexNormal = this._vertexNormals[face.normalIndices[vertexIndex] - 1];\r\n\t\t\t\tnormals.push(vertexNormal.x, vertexNormal.y, vertexNormal.z);\r\n\t\t\t}\r\n\r\n\t\t\tif (face.uvIndices.length > 0) {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuv = this._uvs[face.uvIndices[vertexIndex] - 1];\r\n\t\t\t\t\tuvs.push(uv.u, uv.v);\r\n\r\n\t\t\t\t} catch (e) {\r\n\r\n\t\t\t\t\tswitch (vertexIndex) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tuvs.push(0, 1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tuvs.push(.5, 0);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tuvs.push(1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tindex = this._realIndices[face.indexIds[vertexIndex]] - 1;\r\n\t\t}\r\n\r\n\t\tindices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new object group.\r\n\t * @param trunk The data block containing the object tag and its parameters\r\n\t */\r\n\tprivate createObject(trunk)\r\n\t{\r\n\t\tthis._currentGroup = null;\r\n\t\tthis._currentMaterialGroup = null;\r\n\t\tthis._objects.push(this._currentObject = new ObjectGroup());\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentObject.name = trunk[1];\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new group.\r\n\t * @param trunk The data block containing the group tag and its parameters\r\n\t */\r\n\tprivate createGroup(trunk)\r\n\t{\r\n\t\tif (!this._currentObject)\r\n\t\t\tthis.createObject(null);\r\n\t\tthis._currentGroup = new Group();\r\n\r\n\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentGroup.name = trunk[1];\r\n\t\tthis._currentObject.groups.push(this._currentGroup);\r\n\r\n\t\tthis.createMaterialGroup(null);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new material group.\r\n\t * @param trunk The data block containing the material tag and its parameters\r\n\t */\r\n\tprivate createMaterialGroup(trunk)\r\n\t{\r\n\t\tthis._currentMaterialGroup = new MaterialGroup();\r\n\t\tif (trunk)\r\n\t\t\tthis._currentMaterialGroup.url = trunk[1];\r\n\t\tthis._currentGroup.materialGroups.push(this._currentMaterialGroup);\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex coordinates.\r\n\t * @param trunk The data block containing the vertex tag and its parameters\r\n\t */\r\n\tprivate parseVertex(trunk)\r\n\t{\r\n\t\t//for the very rare cases of other delimiters/charcodes seen in some obj files\r\n\r\n\t\tvar v1:number, v2:number , v3:number;\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\r\n\t\t\tv1 = <number> nTrunk[0];\r\n\t\t\tv2 = <number> nTrunk[1];\r\n\t\t\tv3 = <number> -nTrunk[2];\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\r\n\t\t} else {\r\n\t\t\tv1 = <number> parseFloat(trunk[1]);\r\n\t\t\tv2 = <number> parseFloat(trunk[2]);\r\n\t\t\tv3 = <number> -parseFloat(trunk[3]);\r\n\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinates.\r\n\t * @param trunk The data block containing the uv tag and its parameters\r\n\t */\r\n\tprivate parseUV(trunk)\r\n\t{\r\n\t\tif (trunk.length > 3) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._uvs.push(new UV(nTrunk[0], 1 - nTrunk[1]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._uvs.push(new UV(parseFloat(trunk[1]), 1 - parseFloat(trunk[2])));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex normal coordinates.\r\n\t * @param trunk The data block containing the vertex normal tag and its parameters\r\n\t */\r\n\tprivate parseVertexNormal(trunk)\r\n\t{\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._vertexNormals.push(new Vertex(nTrunk[0], nTrunk[1], -nTrunk[2]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._vertexNormals.push(new Vertex(parseFloat(trunk[1]), parseFloat(trunk[2]), -parseFloat(trunk[3])));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next face's indices.\r\n\t * @param trunk The data block containing the face tag and its parameters\r\n\t */\r\n\tprivate parseFace(trunk)\r\n\t{\r\n\t\tvar len:number = trunk.length;\r\n\t\tvar face:FaceData = new FaceData();\r\n\r\n\t\tif (!this._currentGroup) {\r\n\t\t\tthis.createGroup(null);\r\n\t\t}\r\n\r\n\t\tvar indices;\r\n\t\tfor (var i:number = 1; i < len; ++i) {\r\n\r\n\t\t\tif (trunk[i] == \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tindices = trunk[i].split(\"/\");\r\n\t\t\tface.vertexIndices.push(this.parseIndex(parseInt(indices[0]), this._vertices.length));\r\n\r\n\t\t\tif (indices[1] && String(indices[1]).length > 0)\r\n\t\t\t\tface.uvIndices.push(this.parseIndex(parseInt(indices[1]), this._uvs.length));\r\n\r\n\t\t\tif (indices[2] && String(indices[2]).length > 0)\r\n\t\t\t\tface.normalIndices.push(this.parseIndex(parseInt(indices[2]), this._vertexNormals.length));\r\n\r\n\t\t\tface.indexIds.push(trunk[i]);\r\n\t\t}\r\n\r\n\t\tthis._currentMaterialGroup.faces.push(face);\r\n\t}\r\n\r\n\t/**\r\n\t * This is a hack around negative face coords\r\n\t */\r\n\tprivate parseIndex(index:number, length:number):number\r\n\t{\r\n\t\tif (index < 0)\r\n\t\t\treturn index + length + 1; else\r\n\t\t\treturn index;\r\n\t}\r\n\r\n\tprivate parseMtl(data:string)\r\n\t{\r\n\t\tvar materialDefinitions = data.split('newmtl');\r\n\t\tvar lines;\r\n\t\tvar trunk;\r\n\t\tvar j:number;\r\n\r\n\t\tvar basicSpecularMethod:SpecularBasicMethod;\r\n\t\tvar useSpecular:boolean;\r\n\t\tvar useColor:boolean;\r\n\t\tvar diffuseColor:number;\r\n\t\tvar color:number;\r\n\t\tvar specularColor:number;\r\n\t\tvar specular:number;\r\n\t\tvar alpha:number;\r\n\t\tvar mapkd:string;\r\n\r\n\t\tfor (var i:number = 0; i < materialDefinitions.length; ++i) {\r\n\r\n\r\n\t\t\tlines = (materialDefinitions[i].split('\\r')).join(\"\").split('\\n');\r\n\t\t\t//lines = (materialDefinitions[i].split('\\r') as Array).join(\"\").split('\\n');\r\n\r\n\t\t\tif (lines.length == 1)\r\n\t\t\t\tlines = materialDefinitions[i].split(String.fromCharCode(13));\r\n\r\n\t\t\tdiffuseColor = color = specularColor = 0xFFFFFF;\r\n\t\t\tspecular = 0;\r\n\t\t\tuseSpecular = false;\r\n\t\t\tuseColor = false;\r\n\t\t\talpha = 1;\r\n\t\t\tmapkd = \"\";\r\n\r\n\t\t\tfor (j = 0; j < lines.length; ++j) {\r\n\r\n\t\t\t\tlines[j] = lines[j].replace(/\\s+$/, \"\");\r\n\r\n\t\t\t\tif (lines[j].substring(0, 1) != \"#\" && (j == 0 || lines[j] != \"\")) {\r\n\t\t\t\t\ttrunk = lines[j].split(\" \");\r\n\r\n\t\t\t\t\tif (String(trunk[0]).charCodeAt(0) == 9 || String(trunk[0]).charCodeAt(0) == 32)\r\n\t\t\t\t\t\ttrunk[0] = trunk[0].substring(1, trunk[0].length);\r\n\r\n\t\t\t\t\tif (j == 0) {\r\n\t\t\t\t\t\tthis._lastMtlID = trunk.join(\"\");\r\n\t\t\t\t\t\tthis._lastMtlID = (this._lastMtlID == \"\")? \"def000\" : this._lastMtlID;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tswitch (trunk[0]) {\r\n\r\n\t\t\t\t\t\t\tcase \"Ka\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3])))\r\n\t\t\t\t\t\t\t\t\tcolor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ks\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tspecularColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseSpecular = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ns\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\tspecular = Number(trunk[1])*0.001;\r\n\t\t\t\t\t\t\t\tif (specular == 0)\r\n\t\t\t\t\t\t\t\t\tuseSpecular = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Kd\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tdiffuseColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseColor = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"tr\":\r\n\t\t\t\t\t\t\tcase \"d\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\talpha = Number(trunk[1]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"map_Kd\":\r\n\t\t\t\t\t\t\t\tmapkd = this.parseMapKdString(trunk);\r\n\t\t\t\t\t\t\t\tmapkd = mapkd.replace(/\\\\/g, \"/\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (mapkd != \"\") {\r\n\r\n\t\t\t\tif (useSpecular) {\r\n\r\n\t\t\t\t\tbasicSpecularMethod = new SpecularBasicMethod();\r\n\t\t\t\t\tbasicSpecularMethod.specularColor = specularColor;\r\n\t\t\t\t\tbasicSpecularMethod.specular = specular;\r\n\r\n\t\t\t\t\tvar specularData:SpecularData = new SpecularData();\r\n\t\t\t\t\tspecularData.alpha = alpha;\r\n\t\t\t\t\tspecularData.basicSpecularMethod = basicSpecularMethod;\r\n\t\t\t\t\tspecularData.materialID = this._lastMtlID;\r\n\r\n\t\t\t\t\tif (!this._materialSpecularData)\r\n\t\t\t\t\t\tthis._materialSpecularData = new Array<SpecularData>();\r\n\r\n\t\t\t\t\tthis._materialSpecularData.push(specularData);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pAddDependency(this._lastMtlID, new URLRequest(mapkd));\r\n\r\n\t\t\t} else if (useColor && !isNaN(color)) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = this._lastMtlID;\r\n\r\n\t\t\t\tif (alpha == 0)\r\n\t\t\t\t\tconsole.log(\"Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:\" + this._lastMtlID + \", mesh(es) using it will be invisible!\");\r\n\r\n\t\t\t\tvar cm:MethodMaterial;\r\n\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\r\n\t\t\t\t\tvar colorMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\t\t\t\t\tcolorMat.alpha = alpha;\r\n\t\t\t\t\tcolorMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMat.specular = specular;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\t\t\t\t\tcm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\tvar colorMultiMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\r\n\t\t\t\t\tcolorMultiMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMultiMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMultiMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMultiMat.specular = specular;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlm.cm = cm;\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0)\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mtlLibLoaded = true;\r\n\t}\r\n\r\n\tprivate parseMapKdString(trunk):string\r\n\t{\r\n\t\tvar url:string = \"\";\r\n\t\tvar i:number;\r\n\t\tvar breakflag:boolean;\r\n\r\n\t\tfor (i = 1; i < trunk.length;) {\r\n\t\t\tswitch (trunk[i]) {\r\n\t\t\t\tcase \"-blendu\":\r\n\t\t\t\tcase \"-blendv\":\r\n\t\t\t\tcase \"-cc\":\r\n\t\t\t\tcase \"-clamp\":\r\n\t\t\t\tcase \"-texres\":\r\n\t\t\t\t\ti += 2; //Skip ahead 1 attribute\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-mm\":\r\n\t\t\t\t\ti += 3; //Skip ahead 2 attributes\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-o\":\r\n\t\t\t\tcase \"-s\":\r\n\t\t\t\tcase \"-t\":\r\n\t\t\t\t\ti += 4; //Skip ahead 3 attributes\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreakflag = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (breakflag)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t//Reconstruct URL/filename\r\n\t\tfor (i; i < trunk.length; i++) {\r\n\t\t\turl += trunk[i];\r\n\t\t\turl += \" \";\r\n\t\t}\r\n\r\n\t\t//Remove the extraneous space and/or newline from the right side\r\n\t\turl = url.replace(/\\s+$/, \"\");\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\tprivate loadMtl(mtlurl:string)\r\n\t{\r\n\t\t// Add raw-data dependency to queue and load dependencies now,\r\n\t\t// which will pause the parsing in the meantime.\r\n\t\tthis._pAddDependency('mtl', new URLRequest(mtlurl), true);\r\n\t\tthis._pPauseAndRetrieveDependencies();//\r\n\t}\r\n\r\n\tprivate applyMaterial(lm:LoadedMaterial)\r\n\t{\r\n\t\tvar decomposeID;\r\n\t\tvar mesh:Mesh;\r\n\t\tvar tm:MethodMaterial;\r\n\t\tvar j:number;\r\n\t\tvar specularData:SpecularData;\r\n\r\n\t\tfor (var i:number = 0; i < this._meshes.length; ++i) {\r\n\t\t\tmesh = this._meshes[i];\r\n\t\t\tdecomposeID = mesh.material.name.split(\"~\");\r\n\r\n\t\t\tif (decomposeID[0] == lm.materialID) {\r\n\r\n\t\t\t\tif (lm.cm) {\r\n\t\t\t\t\tif (mesh.material)\r\n\t\t\t\t\t\tmesh.material = null;\r\n\t\t\t\t\tmesh.material = lm.cm;\r\n\r\n\t\t\t\t} else if (lm.texture) {\r\n\t\t\t\t\tif (this.materialMode < 2) { // if materialMode is 0 or 1, we create a SinglePass\r\n\t\t\t\t\t\ttm = <MethodMaterial > mesh.material;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.alpha = lm.alpha;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\t\t\t\t\t\t\t\t\ttm.alpha = specularData.alpha;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else { //if materialMode==2 this is a MultiPassTexture\r\n\t\t\t\t\t\ttm = <MethodMaterial> mesh.material;\r\n\t\t\t\t\t\ttm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.material.name = decomposeID[1]? decomposeID[1] : decomposeID[0];\r\n\t\t\t\tthis._meshes.splice(i, 1);\r\n\t\t\t\t--i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lm.cm || tm)\r\n\t\t\tthis._pFinalizeAsset(lm.cm || tm);\r\n\t}\r\n\r\n\tprivate applyMaterials()\r\n\t{\r\n\t\tif (this._materialLoaded.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tfor (var i:number = 0; i < this._materialLoaded.length; ++i)\r\n\t\t\tthis.applyMaterial(this._materialLoaded[i]);\r\n\t}\r\n}\r\n\r\nexport = OBJParser;\r\n\r\nclass ObjectGroup\r\n{\r\n\tpublic name:string;\r\n\tpublic groups:Group[] = new Array<Group>();\r\n}\r\n\r\nclass Group\r\n{\r\n\tpublic name:string;\r\n\tpublic materialID:string;\r\n\tpublic materialGroups:MaterialGroup[] = new Array<MaterialGroup>();\r\n}\r\n\r\nclass MaterialGroup\r\n{\r\n\tpublic url:string;\r\n\tpublic faces:FaceData[] = new Array<FaceData>();\r\n}\r\n\r\nclass SpecularData\r\n{\r\n\tpublic materialID:string;\r\n\tpublic basicSpecularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass LoadedMaterial\r\n{\r\n\tpublic materialID:string;\r\n\tpublic texture:Single2DTexture;\r\n\tpublic cm:MaterialBase;\r\n\tpublic specularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass FaceData\r\n{\r\n\tpublic vertexIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic uvIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic normalIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic indexIds:string[] = new Array<string>(); // used for real index lookups\r\n}\r\n\r\n/**\r\n* Texture coordinates value object.\r\n*/\r\nclass UV\r\n{\r\n\tprivate _u:number;\r\n\tprivate _v:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>UV</code> object.\r\n\t *\r\n\t * @param    u        [optional]    The horizontal coordinate of the texture value. Defaults to 0.\r\n\t * @param    v        [optional]    The vertical coordinate of the texture value. Defaults to 0.\r\n\t */\r\n\tconstructor(u:number = 0, v:number = 0)\r\n\t{\r\n\t\tthis._u = u;\r\n\t\tthis._v = v;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the vertical coordinate of the texture value.\r\n\t */\r\n\tpublic get v():number\r\n\t{\r\n\t\treturn this._v;\r\n\t}\r\n\r\n\tpublic set v(value:number)\r\n\t{\r\n\t\tthis._v = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the horizontal coordinate of the texture value.\r\n\t */\r\n\tpublic get u():number\r\n\t{\r\n\t\treturn this._u;\r\n\t}\r\n\r\n\tpublic set u(value:number)\r\n\t{\r\n\t\tthis._u = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new UV value Object\r\n\t */\r\n\tpublic clone():UV\r\n\t{\r\n\t\treturn new UV(this._u, this._v);\r\n\t}\r\n\r\n\t/**\r\n\t * returns the value object as a string for trace/debug purpose\r\n\t */\r\n\tpublic toString():string\r\n\t{\r\n\t\treturn this._u + \",\" + this._v;\r\n\t}\r\n}\r\n\r\nclass Vertex\r\n{\r\n\tprivate _x:number;\r\n\tprivate _y:number;\r\n\tprivate _z:number;\r\n\tprivate _index:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>Vertex</code> value object.\r\n\t *\r\n\t * @param    x            [optional]    The x value. Defaults to 0.\r\n\t * @param    y            [optional]    The y value. Defaults to 0.\r\n\t * @param    z            [optional]    The z value. Defaults to 0.\r\n\t * @param    index        [optional]    The index value. Defaults is NaN.\r\n\t */\r\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, index:number = 0)\r\n\t{\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._index = index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the index of value object\r\n\t * @param    ind        The index\r\n\t */\r\n\tpublic set index(ind:number)\r\n\t{\r\n\t\tthis._index = ind;\r\n\t}\r\n\r\n\tpublic get index():number\r\n\t{\r\n\t\treturn this._index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the x value of the value object\r\n\t * @param    value        The x value\r\n\t */\r\n\tpublic get x():number\r\n\t{\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tpublic set x(value:number)\r\n\t{\r\n\t\tthis._x = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the y value of the value object\r\n\t * @param    value        The y value\r\n\t */\r\n\tpublic get y():number\r\n\t{\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tpublic set y(value:number)\r\n\t{\r\n\t\tthis._y = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the z value of the value object\r\n\t * @param    value        The z value\r\n\t */\r\n\tpublic get z():number\r\n\t{\r\n\t\treturn this._z;\r\n\t}\r\n\r\n\tpublic set z(value:number)\r\n\t{\r\n\t\tthis._z = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new Vertex value Object\r\n\t */\r\n\tpublic clone():Vertex\r\n\t{\r\n\t\treturn new Vertex(this._x, this._y, this._z);\r\n\t}\r\n}",
    "import LoaderSession\t\t\t\t\t\t= require(\"awayjs-core/lib/library/LoaderSession\");\r\n\r\nimport AWDParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWDParser\");\r\nimport Max3DSParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/Max3DSParser\");\r\nimport MD2Parser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/MD2Parser\");\r\nimport OBJParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/OBJParser\");\r\n\r\n/**\r\n *\r\n */\r\nclass Parsers\r\n{\r\n\t/**\r\n\t * A list of all parsers that come bundled with Away3D. Use this to quickly\r\n\t * enable support for all bundled parsers to the file format auto-detection\r\n\t * feature, using any of the enableParsers() methods on loaders, e.g.:\r\n\t *\r\n\t * <code>AssetLibrary.enableParsers(Parsers.ALL_BUNDLED);</code>\r\n\t *\r\n\t * Beware however that this requires all parser classes to be included in the\r\n\t * SWF file, which will add 50-100 kb to the file. When only a limited set of\r\n\t * file formats are used, SWF file size can be saved by adding the parsers\r\n\t * individually using AssetLibrary.enableParser()\r\n\t *\r\n\t * A third way is to specify a parser for each loaded file, thereby bypassing\r\n\t * the auto-detection mechanisms altogether, while at the same time allowing\r\n\t * any properties that are unique to that parser to be set for that load.\r\n\t *\r\n\t * The bundled parsers are:\r\n\t *\r\n\t * <ul>\r\n\t * <li>AC3D (.ac)</li>\r\n\t * <li>Away Data version 1 ASCII and version 2 binary (.awd). AWD1 BSP unsupported</li>\r\n\t * <li>3DMax (.3ds)</li>\r\n\t * <li>DXF (.dxf)</li>\r\n\t * <li>Quake 2 MD2 models (.md2)</li>\r\n\t * <li>Doom 3 MD5 animation clips (.md5anim)</li>\r\n\t * <li>Doom 3 MD5 meshes (.md5mesh)</li>\r\n\t * <li>Wavefront OBJ (.obj)</li>\r\n\t * <li>Collada (.dae)</li>\r\n\t * <li>Images (.jpg, .png)</li>\r\n\t * </ul>\r\n\t *\r\n\t * @see away.library.AssetLibrary.enableParser\r\n\t */\r\n\tpublic static ALL_BUNDLED:Array<Object> = Array<Object>(AWDParser, Max3DSParser, MD2Parser, OBJParser);\r\n\r\n\t/**\r\n\t * Short-hand function to enable all bundled parsers for auto-detection. In practice,\r\n\t * this is the same as invoking enableParsers(Parsers.ALL_BUNDLED) on any of the\r\n\t * loader classes SingleFileLoader, LoaderSession, AssetLibrary or Loader3D.\r\n\t *\r\n\t * See notes about file size in the documentation for the ALL_BUNDLED constant.\r\n\t *\r\n\t * @see away.parsers.Parsers.ALL_BUNDLED\r\n\t */\r\n\tpublic static enableAllBundled():void\r\n\t{\r\n\t\tLoaderSession.enableParsers(Parsers.ALL_BUNDLED);\r\n\t}\r\n}\r\n\r\nexport = Parsers;"
  ],
  "sourceRoot": ""
}